<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è Familien-Wochenessensplaner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #764ba2;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .week-date {
            color: #764ba2;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .pizza-indicator {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .main-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(118,75,162,0.3);
        }

        .btn-secondary {
            background: white;
            color: #764ba2;
            border: 2px solid #764ba2;
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .btn-github {
            background: linear-gradient(135deg, #24292e 0%, #0366d6 100%);
            color: white;
        }

        .btn-github:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(3,102,214,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #f8f8f8;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .week-overview {
            display: grid;
            gap: 15px;
        }

        .day-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #764ba2;
            transition: all 0.3s;
            position: relative;
        }

        .day-card.pizza-day {
            background: linear-gradient(135deg, #fff5f5 0%, #ffeaa7 100%);
            border-left: 5px solid #ff6b6b;
        }

        .day-card.with-leftover {
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e9 100%);
            border-left: 5px solid #4CAF50;
        }

        .leftover-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .day-card .swap-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .day-card .swap-btn:hover {
            background: #764ba2;
            transform: rotate(180deg);
        }

        .day-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #764ba2;
        }

        .price-tag {
            background: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }

        .meal-info {
            margin: 10px 0;
        }

        .meal-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .meal-details {
            color: #666;
            font-size: 0.9em;
        }

        .portion-info {
            background: #e3f2fd;
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 0.85em;
            color: #1976D2;
        }

        .shopping-list {
            columns: 2;
            column-gap: 30px;
        }

        .shopping-category {
            break-inside: avoid;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .shopping-category h3 {
            color: #764ba2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shopping-item {
            display: flex;
            align-items: center;
            padding: 5px 0;
        }

        .shopping-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .recipe-details {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .recipe-details h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .ingredients-list {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .ingredients-list ul {
            list-style-type: none;
            padding-left: 0;
        }

        .ingredients-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .ingredients-list li:last-child {
            border-bottom: none;
        }

        .instructions {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 10px;
            line-height: 1.8;
        }

        .tips-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .tips-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-group {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }

        .setting-group h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 10px;
            color: #666;
        }

        .setting-group input[type="number"],
        .setting-group select,
        .setting-group input[type="password"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }

        .setting-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .portion-settings {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .portion-settings h4 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .person-portion {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }

        .person-portion label {
            flex: 1;
            margin: 0;
        }

        .person-portion input {
            width: 80px;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .budget-display {
            font-size: 1.2em;
            color: #4CAF50;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: #f0fff4;
            border-radius: 10px;
            margin: 20px 0;
        }

        .stats-box {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-box h3 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .saved-weeks-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .saved-week-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .saved-week-info {
            flex: 1;
        }

        .saved-week-date {
            font-weight: bold;
            color: #764ba2;
            font-size: 1.1em;
        }

        .saved-week-summary {
            font-size: 0.95em;
            color: #666;
            margin-top: 5px;
        }

        .saved-week-actions {
            display: flex;
            gap: 8px;
        }

        .mini-btn {
            padding: 8px 15px;
            font-size: 0.95em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .mini-btn-load {
            background: #4CAF50;
            color: white;
        }

        .mini-btn-load:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .mini-btn-delete {
            background: #f44336;
            color: white;
        }

        .mini-btn-delete:hover {
            background: #da190b;
            transform: translateY(-1px);
        }

        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 450px;
            display: none;
        }

        .confirm-dialog.active {
            display: block;
        }

        .confirm-dialog h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .confirm-dialog p {
            margin-bottom: 15px;
            color: #666;
            line-height: 1.5;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #764ba2;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #333;
        }

        .github-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .github-section h3 {
            color: #24292e;
            margin-bottom: 15px;
        }

        .github-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
        }

        .github-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .github-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .github-btn-primary {
            background: #24292e;
            color: white;
        }

        .github-btn-primary:hover {
            background: #0366d6;
            transform: translateY(-2px);
        }

        .github-btn-secondary {
            background: white;
            color: #24292e;
            border: 2px solid #24292e;
        }

        .github-btn-secondary:hover {
            background: #f6f8fa;
        }

        .status-message {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            color: #4CAF50;
            background: #f0fff4;
        }

        .status-error {
            color: #f44336;
            background: #ffebee;
        }

        .status-info {
            color: #2196F3;
            background: #e3f2fd;
        }

        .gist-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
        }

        .gist-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }

        .gist-item:hover {
            background: #f6f8fa;
        }

        .gist-item:last-child {
            border-bottom: none;
        }

        .gist-title {
            font-weight: bold;
            color: #24292e;
        }

        .gist-date {
            font-size: 0.9em;
            color: #666;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #764ba2;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .sync-status {
            background: #e3f2fd;
            color: #1976D2;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
        }

        .sync-status.synced {
            background: #e8f5e9;
            color: #388E3C;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .shopping-list {
                columns: 1;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .filter-group {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            .btn, .tabs, .main-controls, .swap-btn {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
                box-shadow: none;
                border: 1px solid #ddd;
                margin-bottom: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Familien-Wochenessensplaner</h1>
            <p>Intelligente Wochenplanung mit individuellen Portionen</p>
            <p>Budget: <span id="budgetDisplay">175 CHF</span> pro Woche (25 CHF/Tag)</p>
            <p class="week-date" id="weekDateDisplay">Woche vom ... bis ...</p>
            <div id="pizzaIndicator" style="display:none;">
                <span class="pizza-indicator">üçï Pizza-Wochenende! üçï</span>
            </div>
            <div id="syncStatusBar" class="sync-status" style="display: none;">
                <span id="syncStatusText">Synchronisiere...</span>
            </div>
        </div>

        <div class="stats-box">
            <h3>üìö Rezept-Datenbank</h3>
            <p><strong id="totalRecipes">0</strong> Rezepte verf√ºgbar | <strong id="meatCount">0</strong> Fleisch | <strong id="vegCount">0</strong> Vegetarisch | <strong id="kidsCount">0</strong> Kinder</p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                N√§chstes Pizza-Wochenende in <strong id="pizzaCountdown">...</strong> Woche(n)
            </p>
        </div>

        <div class="main-controls">
            <button class="btn btn-primary" onclick="confirmGenerateNewPlan()">
                üé≤ Neuen Plan generieren
            </button>
            <button class="btn btn-secondary" onclick="saveCurrentWeek()">
                üíæ Woche speichern
            </button>
            <button class="btn btn-secondary" onclick="showSavedWeeks()">
                üìÇ Gespeicherte Wochen
            </button>
            <button class="btn btn-secondary" onclick="exportToPDF()">
                üìÑ Als PDF exportieren
            </button>
            <button class="btn btn-github" onclick="showGitHubSync()">
                <svg style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;" fill="white" viewBox="0 0 16 16">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub Sync
            </button>
            <button class="btn btn-secondary" onclick="savePreferences()">
                ‚öôÔ∏è Einstellungen speichern
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'overview')">üìÖ Wochen√ºbersicht</button>
            <button class="tab" onclick="switchTab(event, 'shopping')">üõí Einkaufsliste</button>
            <button class="tab" onclick="switchTab(event, 'recipes')">üìñ Rezepte</button>
            <button class="tab" onclick="switchTab(event, 'settings')">‚öôÔ∏è Einstellungen</button>
        </div>

        <div id="overview" class="tab-content active">
            <div class="loading" id="loadingOverview">
                <div class="spinner"></div>
                <p>Generiere Wochenplan...</p>
            </div>
            <div class="week-overview" id="weekOverview"></div>
            <div class="budget-display">
                Gesamtkosten der Woche: <span id="totalCost">0</span> CHF
            </div>
        </div>

        <div id="shopping" class="tab-content">
            <h2>üõí Einkaufsliste</h2>
            <div class="shopping-list" id="shoppingList"></div>
        </div>

        <div id="recipes" class="tab-content">
            <h2>üìñ Detaillierte Rezepte</h2>
            <div id="recipesList"></div>
        </div>

        <div id="settings" class="tab-content">
            <h2>‚öôÔ∏è Einstellungen</h2>
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie</h3>
                    <label>
                        Anzahl Erwachsene:
                        <input type="number" id="adultsCount" value="2" min="1" max="4" onchange="updatePersonPortions()">
                    </label>
                    <label>
                        Anzahl Kinder:
                        <input type="number" id="childrenCount" value="2" min="0" max="6" onchange="updatePersonPortions()">
                    </label>
                    
                    <div class="portion-settings">
                        <h4>üìä Individuelle Portionsfaktoren</h4>
                        <div id="portionSettings"></div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>üí∞ Budget</h3>
                    <label>
                        Tagesbudget (CHF):
                        <input type="number" id="dailyBudget" value="25" min="10" max="50" onchange="updateBudgetDisplay()">
                    </label>
                </div>
                
                <div class="setting-group">
                    <h3>ü•ó Ern√§hrung</h3>
                    <label>
                        Vegetarische Tage pro Woche:
                        <input type="number" id="vegDays" value="3" min="0" max="7">
                    </label>
                    <label>
                        Pizza-Wochenende alle:
                        <select id="pizzaFrequency">
                            <option value="2">2 Wochen</option>
                            <option value="3" selected>2-3 Wochen (Zufall)</option>
                            <option value="4">3-4 Wochen</option>
                            <option value="0">Nie</option>
                        </select>
                    </label>
                </div>

                <div class="setting-group">
                    <h3>üö´ Ausschl√ºsse - Fleisch</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="noLamb"> Kein Lamm
                        </label>
                        <label>
                            <input type="checkbox" id="noPork"> Kein Schwein
                        </label>
                        <label>
                            <input type="checkbox" id="noBeef"> Kein Rind
                        </label>
                        <label>
                            <input type="checkbox" id="noDuck"> Keine Ente
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>üßÄ Ausschl√ºsse - Milchprodukte</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="noCottageCheese"> Kein H√ºttenk√§se
                        </label>
                        <label>
                            <input type="checkbox" id="noGorgonzola"> Kein Gorgonzola
                        </label>
                        <label>
                            <input type="checkbox" id="noFeta"> Kein Feta
                        </label>
                        <label>
                            <input type="checkbox" id="noCheese"> Kein nicht-√ºberbackener K√§se
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ü•ò Weitere Ausschl√ºsse</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="noFish"> Keine Fischgerichte
                        </label>
                        <label>
                            <input type="checkbox" id="noMushrooms"> Keine Pilze
                        </label>
                        <label>
                            <input type="checkbox" id="noNuts"> Keine N√ºsse
                        </label>
                        <label>
                            <input type="checkbox" id="noSpicy"> Nicht scharf
                        </label>
                        <label>
                            <input type="checkbox" id="noTofu"> Kein Tofu
                        </label>
                        <label>
                            <input type="checkbox" id="noEggplant"> Keine Aubergine
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>üîë GitHub Token</h3>
                    <label>
                        GitHub Personal Access Token:
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                    </label>
                    <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        F√ºr GitHub Sync. Token erstellen: 
                        <a href="https://github.com/settings/tokens/new" target="_blank" style="color: #0366d6;">
                            GitHub Settings ‚Üí Tokens
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHub Sync Modal -->
    <div id="githubModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîÑ GitHub Synchronisation</h2>
                <button class="close-modal" onclick="closeGitHubSync()">√ó</button>
            </div>
            
            <div class="github-section">
                <h3>üì§ Wochenplan auf GitHub speichern</h3>
                <p>Speichere deinen aktuellen Wochenplan als Gist auf GitHub:</p>
                <input type="text" class="github-input" id="gistName" placeholder="Name f√ºr den Gist (optional)">
                <div class="github-actions">
                    <button class="github-btn github-btn-primary" onclick="saveToGitHub()">
                        üì§ Als Gist speichern
                    </button>
                    <button class="github-btn github-btn-secondary" onclick="updateExistingGist()">
                        üîÑ Bestehenden Gist aktualisieren
                    </button>
                </div>
                <div id="saveStatus"></div>
            </div>
            
            <div class="github-section">
                <h3>üì• Wochenplan von GitHub laden</h3>
                <p>Lade einen gespeicherten Wochenplan von GitHub:</p>
                <button class="github-btn github-btn-primary" onclick="loadGists()">
                    üìã Meine Gists anzeigen
                </button>
                <div id="gistList" class="gist-list" style="display:none;"></div>
                
                <p style="margin-top: 15px;">Oder gib eine Gist-ID direkt ein:</p>
                <input type="text" class="github-input" id="gistId" placeholder="Gist ID oder URL">
                <button class="github-btn github-btn-secondary" onclick="loadFromGitHub()">
                    üì• Von Gist laden
                </button>
                <div id="loadStatus"></div>
            </div>

            <div class="github-section">
                <h3>‚ÑπÔ∏è Anleitung</h3>
                <ol style="color: #666; font-size: 0.95em; line-height: 1.8;">
                    <li>Erstelle einen GitHub Personal Access Token mit "gist" Berechtigung</li>
                    <li>F√ºge den Token in den Einstellungen ein</li>
                    <li>Speichere deine Wochenpl√§ne als private Gists</li>
                    <li>Teile Gist-URLs mit Familie/Freunden zum gemeinsamen Nutzen</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Erweiterte Rezept-Datenbank mit Base-Portionen (f√ºr 4 Personen)
        let recipes = {};
        
        // Rezepte laden mit erweiterten Rezepten
        function loadRecipes() {
            recipes = {
                meat: [
                    // Original 10 Rezepte
                    {name:"Spaghetti Carbonara",category:"Fleisch",price:18,basePortions:4,ingredients:{"Spaghetti":"500g","Speck/Pancetta":"200g","Eier":"4 St√ºck","Parmesan":"150g","Knoblauch":"2 Zehen","Schwarzer Pfeffer":"nach Geschmack"},instructions:["Wasser f√ºr Nudeln aufsetzen und salzen","Speck in kleine W√ºrfel schneiden und knusprig braten","Spaghetti al dente kochen","Eier mit Parmesan verquirlen","Nudeln zum Speck geben, vom Herd nehmen","Ei-K√§se-Mischung unterr√ºhren"],childTip:"F√ºr Kinder weniger Pfeffer verwenden",workTip:"L√§sst sich gut erw√§rmen"},
                    {name:"H√§hnchenbrust mit R√∂sti",category:"Fleisch",price:22,basePortions:4,ingredients:{"H√§hnchenbrust":"600g","Kartoffeln":"800g","Gr√ºne Bohnen":"400g","Butter":"50g","Zwiebel":"1 St√ºck"},instructions:["Kartoffeln raspeln und ausdr√ºcken","H√§hnchen w√ºrzen und braten","R√∂sti goldbraun braten","Bohnen bissfest kochen","Alles zusammen anrichten"],childTip:"H√§hnchen in kleine St√ºcke schneiden",workTip:"R√∂sti werden beim Erw√§rmen wieder knusprig"},
                    {name:"Rindergulasch mit Sp√§tzle",category:"Fleisch",price:28,basePortions:4,ingredients:{"Rindergulasch":"700g","Sp√§tzle":"500g","Zwiebeln":"3 gro√üe","Paprika":"2 St√ºck","Tomatenmark":"3 EL","Paprikapulver":"2 EL"},instructions:["Fleisch scharf anbraten","Zwiebeln und Paprika zugeben","Mit Fond abl√∂schen","1,5 Std k√∂cheln lassen","Sp√§tzle kochen","Mit Sp√§tzle servieren"],childTip:"Weniger Paprika f√ºr Kinder",workTip:"Wird beim Erw√§rmen noch besser"},
                    {name:"Schweinemedaillons mit Champignonsauce",category:"Fleisch",price:26,basePortions:4,ingredients:{"Schweinefilet":"600g","Champignons":"400g","Sahne":"250ml","Kartoffeln":"1kg","Brokkoli":"500g"},instructions:["Medaillons braten","Champignons anbraten","Mit Sahne abl√∂schen","Kartoffeln kochen","Brokkoli d√§mpfen","Zusammen servieren"],childTip:"Sauce separat servieren",workTip:"Fleisch und Sauce getrennt erw√§rmen"},
                    {name:"Hackfleisch-Kartoffel-Auflauf",category:"Fleisch",price:20,basePortions:4,ingredients:{"Hackfleisch":"500g","Kartoffeln":"1kg","Zwiebeln":"2 St√ºck","K√§se":"200g","Milch":"300ml"},instructions:["Kartoffeln in Scheiben schneiden","Hackfleisch anbraten","Schichten und √ºberbacken","45 Min bei 180¬∞C backen"],childTip:"Perfekt f√ºr Kinder",workTip:"Portionsweise einfrieren m√∂glich"},
                    {name:"H√§hnchen-Curry",category:"Fleisch",price:24,basePortions:4,ingredients:{"H√§hnchenbrust":"600g","Kokosmilch":"400ml","Currypaste":"2 EL","Reis":"400g","Gem√ºse":"400g"},instructions:["H√§hnchen anbraten","Currypaste einr√ºhren","Mit Kokosmilch abl√∂schen","Gem√ºse zugeben","Mit Reis servieren"],childTip:"Sehr milde Currypaste verwenden",workTip:"Curry schmeckt aufgew√§rmt noch besser"},
                    {name:"Bolognese mit Penne",category:"Fleisch",price:19,basePortions:4,ingredients:{"Rinderhack":"500g","Penne":"500g","Dosentomaten":"800g","Zwiebeln":"2 St√ºck","M√∂hren":"2 St√ºck"},instructions:["Gem√ºse w√ºrfeln und anschwitzen","Hackfleisch kr√ºmelig braten","Tomaten zugeben","2 Stunden k√∂cheln","Penne kochen","Mit Parmesan servieren"],childTip:"Gem√ºse sehr fein hacken",workTip:"Sauce einfrieren, Nudeln frisch"},
                    {name:"Gyros mit Tzatziki",category:"Fleisch",price:25,basePortions:4,ingredients:{"Schweinefleisch":"700g","Pita":"6 St√ºck","Joghurt":"300g","Gurke":"1 St√ºck","Pommes":"500g"},instructions:["Fleisch marinieren und braten","Tzatziki zubereiten","Pommes backen","Pita erw√§rmen","Alles zusammen servieren"],childTip:"Weniger Knoblauch",workTip:"Komponenten getrennt transportieren"},
                    {name:"Chili con Carne",category:"Fleisch",price:21,basePortions:4,ingredients:{"Rinderhack":"600g","Kidneybohnen":"2 Dosen","Mais":"1 Dose","Paprika":"2 St√ºck","Reis":"400g"},instructions:["Hackfleisch anbraten","Gem√ºse zugeben","Bohnen und Mais einr√ºhren","1 Stunde k√∂cheln","Mit Reis servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Perfekt zum Einfrieren"},
                    {name:"Schnitzel mit Kartoffelsalat",category:"Fleisch",price:25,basePortions:4,ingredients:{"Schnitzel":"600g","Paniermehl":"200g","Kartoffeln":"1kg","Mayonnaise":"150g","Gurken":"3 kleine"},instructions:["Kartoffelsalat vorbereiten","Schnitzel panieren","Goldbraun braten","Zusammen servieren"],childTip:"Schnitzel in Streifen schneiden",workTip:"Kalt auch lecker"},
                    // 30 neue Fleisch-Rezepte
                    {name:"Lammkoteletts mit Rosmarinkartoffeln",category:"Fleisch",price:32,basePortions:4,ingredients:{"Lammkoteletts":"800g","Kartoffeln":"1kg","Rosmarin":"3 Zweige","Knoblauch":"4 Zehen","Gr√ºner Salat":"200g"},instructions:["Kartoffeln w√ºrfeln und mit Rosmarin w√ºrzen","Im Ofen bei 200¬∞C r√∂sten","Lammkoteletts w√ºrzen","Scharf anbraten, medium garen","Mit Salat servieren"],childTip:"Fleisch gut durchbraten f√ºr Kinder",workTip:"Kartoffeln kalt als Salat"},
                    {name:"Entenbrust mit Rotkohl",category:"Fleisch",price:30,basePortions:4,ingredients:{"Entenbrust":"600g","Rotkohl":"800g","√Ñpfel":"2 St√ºck","Kl√∂√üe":"500g","Orangensaft":"200ml"},instructions:["Entenbrust einschneiden","Haut knusprig braten","Rotkohl schmoren","Kl√∂√üe zubereiten","Mit Orangensauce servieren"],childTip:"Haut entfernen f√ºr Kinder",workTip:"Sauce separat transportieren"},
                    {name:"Kalbsschnitzel Wiener Art",category:"Fleisch",price:34,basePortions:4,ingredients:{"Kalbsschnitzel":"600g","Semmelbr√∂sel":"200g","Eier":"3 St√ºck","Zitrone":"2 St√ºck","Preiselbeeren":"100g"},instructions:["Schnitzel klopfen","Panieren: Mehl, Ei, Br√∂sel","In Butterschmalz braten","Mit Zitrone garnieren","Preiselbeeren dazu"],childTip:"D√ºnner klopfen f√ºr Kinder",workTip:"Kalt im Br√∂tchen lecker"},
                    {name:"Rinderbraten mit Gem√ºse",category:"Fleisch",price:35,basePortions:4,ingredients:{"Rinderbraten":"1kg","M√∂hren":"400g","Sellerie":"200g","Rotwein":"300ml","Kartoffelp√ºree":"800g"},instructions:["Braten scharf anbraten","Mit Gem√ºse schmoren","Mit Rotwein abl√∂schen","2 Std im Ofen garen","P√ºree zubereiten"],childTip:"Fleisch klein schneiden",workTip:"Als Sandwich verwerten"},
                    {name:"H√§hnchen-Geschnetzeltes",category:"Fleisch",price:23,basePortions:4,ingredients:{"H√§hnchenbrust":"700g","Champignons":"300g","Sahne":"200ml","Reis":"400g","Petersilie":"1 Bund"},instructions:["H√§hnchen in Streifen schneiden","Anbraten und herausnehmen","Pilze braten","Mit Sahne abl√∂schen","Fleisch wieder zugeben"],childTip:"Mild w√ºrzen",workTip:"Mit Reis mischen und mitnehmen"},
                    {name:"Pulled Pork Burger",category:"Fleisch",price:26,basePortions:4,ingredients:{"Schweineschulter":"800g","Burger Buns":"8 St√ºck","BBQ-Sauce":"200ml","Coleslaw":"300g","Zwiebeln":"2 St√ºck"},instructions:["Fleisch 4 Std bei 120¬∞C garen","Zerfasern (pullen)","Mit BBQ-Sauce mischen","Auf Buns mit Coleslaw servieren"],childTip:"Weniger Sauce f√ºr Kinder",workTip:"Fleisch vorportionieren"},
                    {name:"K√∂nigsberger Klopse",category:"Fleisch",price:22,basePortions:4,ingredients:{"Hackfleisch gemischt":"600g","Kapern":"50g","Sardellen":"4 St√ºck","Kartoffeln":"1kg","Sahne":"200ml"},instructions:["Klopse formen und kochen","Sauce mit Kapern zubereiten","Kartoffeln kochen","Alles zusammen anrichten"],childTip:"Ohne Sardellen f√ºr Kinder",workTip:"Komplett einfrieren"},
                    {name:"Thai Beef Salat",category:"Fleisch",price:27,basePortions:4,ingredients:{"Rinderfilet":"500g","Reisnudeln":"300g","Limetten":"3 St√ºck","Minze":"1 Bund","Erdn√ºsse":"100g"},instructions:["Rindfleisch grillen","In Streifen schneiden","Reisnudeln kochen","Mit Limettendressing mischen","Mit Kr√§utern garnieren"],childTip:"Weniger scharf w√ºrzen",workTip:"Dressing separat"},
                    {name:"Moussaka",category:"Fleisch",price:24,basePortions:4,ingredients:{"Lammhack":"600g","Auberginen":"2 St√ºck","Kartoffeln":"500g","Bechamel":"400ml","Feta":"150g"},instructions:["Gem√ºse in Scheiben schneiden","Hackfleisch anbraten","Schichten und mit Bechamel √ºbergie√üen","45 Min backen"],childTip:"Mehr Kartoffeln, weniger Aubergine",workTip:"Portionsweise einfrieren"},
                    {name:"Schweinefilet im Bl√§tterteig",category:"Fleisch",price:28,basePortions:4,ingredients:{"Schweinefilet":"700g","Bl√§tterteig":"400g","Spinat":"300g","Pilze":"200g","Senf":"3 EL"},instructions:["Filet anbraten","Mit Senf bestreichen","In Bl√§tterteig wickeln","30 Min bei 180¬∞C backen"],childTip:"Ohne Pilze f√ºr Kinder",workTip:"Kalt aufschneiden"},
                    {name:"Coq au Vin",category:"Fleisch",price:29,basePortions:4,ingredients:{"H√§hnchenschenkel":"8 St√ºck","Rotwein":"500ml","Speck":"150g","Perlzwiebeln":"200g","Champignons":"300g"},instructions:["H√§hnchen anbraten","Mit Rotwein abl√∂schen","1,5 Std schmoren","Gem√ºse zugeben","Mit Baguette servieren"],childTip:"Alkohol verkocht",workTip:"Wird besser beim Aufw√§rmen"},
                    {name:"Boeuf Stroganoff",category:"Fleisch",price:31,basePortions:4,ingredients:{"Rinderfilet":"600g","Saure Sahne":"200ml","Gew√ºrzgurken":"100g","Zwiebeln":"2 St√ºck","Nudeln":"500g"},instructions:["Fleisch in Streifen schneiden","Kurz anbraten","Sauce zubereiten","Mit saurer Sahne verfeinern","√úber Nudeln servieren"],childTip:"Gurken weglassen f√ºr Kinder",workTip:"Sauce und Nudeln trennen"},
                    {name:"Cevapcici mit Ajvar",category:"Fleisch",price:23,basePortions:4,ingredients:{"Hackfleisch gemischt":"700g","Ajvar":"200g","Fladenbrot":"4 St√ºck","Zwiebeln":"2 St√ºck","Joghurt":"200ml"},instructions:["Cevapcici formen","Grillen oder braten","Fladenbrot erw√§rmen","Mit Ajvar und Zwiebeln servieren"],childTip:"Milderes Ajvar nehmen",workTip:"Kalt auch gut"},
                    {name:"Saltimbocca alla Romana",category:"Fleisch",price:32,basePortions:4,ingredients:{"Kalbsschnitzel":"600g","Parmaschinken":"150g","Salbei":"20 Bl√§tter","Wei√üwein":"200ml","Risotto":"400g"},instructions:["Schnitzel mit Schinken belegen","Mit Salbei und Zahnstocher fixieren","Kurz braten","Mit Wei√üwein abl√∂schen","Mit Risotto servieren"],childTip:"Ohne Wein f√ºr Kinder",workTip:"Einzeln verpacken"},
                    {name:"Hackbraten mit Ei",category:"Fleisch",price:21,basePortions:4,ingredients:{"Hackfleisch":"800g","Eier":"6 St√ºck","Kartoffelp√ºree":"800g","Erbsen":"300g","Zwiebeln":"2 St√ºck"},instructions:["Hackfleisch w√ºrzen","Eier hart kochen","Hackbraten mit Ei f√ºllen","1 Std backen","Mit P√ºree servieren"],childTip:"Kinderklassiker",workTip:"In Scheiben kalt aufs Brot"},
                    {name:"Rindersteak mit Kr√§uterbutter",category:"Fleisch",price:36,basePortions:4,ingredients:{"Rindersteaks":"800g","Kr√§uterbutter":"150g","Ofenkartoffeln":"1kg","Gr√ºner Spargel":"500g","Tomaten":"4 St√ºck"},instructions:["Steaks auf Raumtemperatur bringen","Scharf anbraten","Nach Wunsch garen","Mit Kr√§uterbutter toppen","Mit Beilagen servieren"],childTip:"Durchbraten f√ºr Kinder",workTip:"Steak kalt aufschneiden"},
                    {name:"H√§hnchen-Sat√©-Spie√üe",category:"Fleisch",price:24,basePortions:4,ingredients:{"H√§hnchenbrust":"700g","Erdnussbutter":"150g","Kokosmilch":"200ml","Reis":"400g","Gurken":"2 St√ºck"},instructions:["H√§hnchen w√ºrfeln und aufspie√üen","Grillen oder braten","Erdnuss-Sauce zubereiten","Mit Reis und Gurken servieren"],childTip:"Milde Sauce",workTip:"Spie√üe einzeln verpacken"},
                    {name:"Kalbsleber Berliner Art",category:"Fleisch",price:26,basePortions:4,ingredients:{"Kalbsleber":"600g","√Ñpfel":"3 St√ºck","Zwiebeln":"3 St√ºck","Kartoffelp√ºree":"800g","Butter":"80g"},instructions:["Zwiebeln und Apfelringe braten","Leber kurz braten","Nicht zu lange, sonst z√§h","Mit P√ºree anrichten"],childTip:"Sehr d√ºnn schneiden",workTip:"Frisch zubereiten"},
                    {name:"Rinderragout mit Polenta",category:"Fleisch",price:27,basePortions:4,ingredients:{"Rindfleisch":"700g","Polenta":"300g","Tomaten":"400g","Rotwein":"200ml","Parmesan":"100g"},instructions:["Fleisch w√ºrfeln und anbraten","Mit Tomaten schmoren","2 Std k√∂cheln","Polenta kochen","Zusammen servieren"],childTip:"Ohne Wein kochen",workTip:"Ragout einfrieren"},
                    {name:"Putenschnitzel Hawaii",category:"Fleisch",price:25,basePortions:4,ingredients:{"Putenschnitzel":"600g","Ananas":"1 Dose","Curry":"2 EL","K√§se":"200g","Reis":"400g"},instructions:["Schnitzel w√ºrzen und braten","Mit Ananas und K√§se belegen","√úberbacken","Mit Curryreis servieren"],childTip:"Beliebtes Kindergericht",workTip:"Kalt im Sandwich"},
                    {name:"Lammcurry",category:"Fleisch",price:29,basePortions:4,ingredients:{"Lammfleisch":"700g","Kokosmilch":"400ml","Currypaste":"3 EL","Naan-Brot":"8 St√ºck","Joghurt":"200ml"},instructions:["Lamm w√ºrfeln und anbraten","Currypaste anschwitzen","Mit Kokosmilch abl√∂schen","1,5 Std k√∂cheln","Mit Naan servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Curry wird besser"},
                    {name:"Wiener Schnitzel vom Schwein",category:"Fleisch",price:23,basePortions:4,ingredients:{"Schweineschnitzel":"600g","Paniermehl":"200g","Eier":"3 St√ºck","Pommes":"600g","Salat":"300g"},instructions:["Schnitzel klopfen","Klassisch panieren","In viel Fett schwimmend backen","Mit Pommes und Salat"],childTip:"Kinder lieben es",workTip:"Kalt aufs Br√∂tchen"},
                    {name:"Szegediner Gulasch",category:"Fleisch",price:24,basePortions:4,ingredients:{"Schweinefleisch":"700g","Sauerkraut":"500g","Paprika":"3 EL","Saure Sahne":"200ml","Kartoffeln":"800g"},instructions:["Fleisch anbraten","Mit Sauerkraut schmoren","Paprika zugeben","Mit saurer Sahne verfeinern"],childTip:"Weniger Sauerkraut",workTip:"Wird immer besser"},
                    {name:"Rinderrouladen",category:"Fleisch",price:30,basePortions:4,ingredients:{"Rinderrouladen":"800g","Senf":"4 EL","Speck":"100g","Gew√ºrzgurken":"4 St√ºck","Rotkohl":"600g"},instructions:["Rouladen mit Senf bestreichen","F√ºllen und rollen","Anbraten und schmoren","2 Std garen","Mit Rotkohl servieren"],childTip:"F√ºllung anpassen",workTip:"Sauce einfrieren"},
                    {name:"H√§hnchen Teriyaki",category:"Fleisch",price:25,basePortions:4,ingredients:{"H√§hnchenschenkel":"800g","Teriyaki-Sauce":"200ml","Sesam":"30g","Reis":"400g","Brokkoli":"400g"},instructions:["H√§hnchen marinieren","Im Ofen garen","Mit Teriyaki glasieren","Sesam dr√ºber","Mit Reis servieren"],childTip:"S√º√ü-salzig, m√∂gen Kinder",workTip:"Kalt in Wraps"},
                    {name:"Z√ºrcher Geschnetzeltes",category:"Fleisch",price:33,basePortions:4,ingredients:{"Kalbfleisch":"600g","Champignons":"300g","Sahne":"250ml","Wei√üwein":"150ml","R√∂sti":"600g"},instructions:["Fleisch in Streifen schneiden","Kurz anbraten","Pilze zugeben","Mit Sahne und Wein abl√∂schen","Mit R√∂sti servieren"],childTip:"Ohne Wein zubereiten",workTip:"R√∂sti separat"},
                    {name:"Hackfleischb√§llchen s√º√ü-sauer",category:"Fleisch",price:22,basePortions:4,ingredients:{"Hackfleisch":"600g","Ananas":"1 Dose","Paprika":"2 St√ºck","S√º√ü-sauer-Sauce":"300ml","Reis":"400g"},instructions:["B√§llchen formen und braten","Gem√ºse anbraten","Mit Sauce abl√∂schen","Ananas zugeben","Mit Reis servieren"],childTip:"Kinder m√∂gen s√º√ü-sauer",workTip:"Gut aufw√§rmbar"},
                    {name:"Entrec√¥te mit Pfeffersauce",category:"Fleisch",price:38,basePortions:4,ingredients:{"Entrec√¥te":"800g","Gr√ºner Pfeffer":"30g","Cognac":"50ml","Sahne":"200ml","Pommes":"600g"},instructions:["Steaks auf Raumtemperatur","Scharf anbraten","Pfeffersauce zubereiten","Flambieren mit Cognac","Mit Pommes servieren"],childTip:"Ohne Alkohol und milder",workTip:"Steak kalt aufschneiden"},
                    {name:"Lamm-K√∂fte mit Joghurt",category:"Fleisch",price:26,basePortions:4,ingredients:{"Lammhack":"600g","Minze":"1 Bund","Pinienkerne":"50g","Fladenbrot":"4 St√ºck","Joghurt":"300ml"},instructions:["K√∂fte w√ºrzen und formen","Grillen oder braten","Joghurt-Minz-Sauce machen","Im Fladenbrot servieren"],childTip:"Milder w√ºrzen",workTip:"K√∂fte kalt auch gut"},
                    {name:"Schweinelende mit Pflaumen",category:"Fleisch",price:27,basePortions:4,ingredients:{"Schweinelende":"700g","Pflaumen":"300g","Rotwein":"200ml","Kartoffelkl√∂√üe":"500g","Rotkohl":"600g"},instructions:["Lende w√ºrzen und anbraten","Mit Pflaumen schmoren","Mit Rotwein abl√∂schen","Kl√∂√üe zubereiten","Mit Rotkohl servieren"],childTip:"S√º√ülich, m√∂gen viele Kinder",workTip:"Sauce separat"}
                ],
                vegetarian: [
                    // Original 5 Rezepte
                    {name:"Gem√ºse-Lasagne",category:"Vegetarisch",price:16,basePortions:4,ingredients:{"Lasagneplatten":"250g","Zucchini":"2 St√ºck","Aubergine":"1 St√ºck","Tomaten":"800g","Mozzarella":"250g"},instructions:["Gem√ºse in Scheiben schneiden","Anbraten und w√ºrzen","Lasagne schichten","45 Min backen"],childTip:"Viel K√§se macht es lecker",workTip:"Perfekt zum Aufw√§rmen"},
                    {name:"K√§sesp√§tzle",category:"Vegetarisch",price:14,basePortions:4,ingredients:{"Sp√§tzle":"600g","Emmentaler":"300g","Zwiebeln":"3 gro√üe","Butter":"50g","Salat":"1 Kopf"},instructions:["Sp√§tzle kochen","Zwiebeln r√∂sten","Mit K√§se schichten","√úberbacken","Mit Salat servieren"],childTip:"Kinder-Lieblingsgericht",workTip:"Mit Milch aufw√§rmen"},
                    {name:"Gem√ºse-Curry",category:"Vegetarisch",price:15,basePortions:4,ingredients:{"Kichererbsen":"2 Dosen","Kokosmilch":"400ml","Gem√ºse":"600g","Currypaste":"2 EL","Reis":"400g"},instructions:["Gem√ºse w√ºrfeln","Currypaste anr√∂sten","Gem√ºse zugeben","Mit Kokosmilch abl√∂schen","Mit Reis servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Wird aufgew√§rmt aromatischer"},
                    {name:"Pizza Margherita",category:"Vegetarisch",price:12,basePortions:4,ingredients:{"Pizzateig":"500g","Tomatensauce":"200ml","Mozzarella":"250g","Basilikum":"1 Bund","Oliven√∂l":"3 EL"},instructions:["Teig ausrollen","Mit Sauce bestreichen","Mozzarella verteilen","15 Min bei 220¬∞C backen","Mit Basilikum garnieren"],childTip:"Der Klassiker",workTip:"Kalt als Pizza-Schnitte"},
                    {name:"Risotto mit Pilzen",category:"Vegetarisch",price:18,basePortions:4,ingredients:{"Risottoreis":"400g","Pilze":"400g","Wei√üwein":"200ml","Parmesan":"150g","Br√ºhe":"1,5L"},instructions:["Pilze anbraten","Reis anschwitzen","Nach und nach Br√ºhe zugeben","St√§ndig r√ºhren","Mit Parmesan verfeinern"],childTip:"Weniger Wei√üwein",workTip:"Mit Br√ºhe aufw√§rmen"},
                    // 25 neue vegetarische Rezepte
                    {name:"Spinat-Ricotta-Cannelloni",category:"Vegetarisch",price:17,basePortions:4,ingredients:{"Cannelloni":"250g","Spinat":"500g","Ricotta":"400g","Tomatensauce":"400ml","Parmesan":"100g"},instructions:["Spinat blanchieren","Mit Ricotta mischen","Cannelloni f√ºllen","Mit Sauce √ºbergie√üen","30 Min backen"],childTip:"Mehr K√§se obendrauf",workTip:"Portionsweise einfrieren"},
                    {name:"Gem√ºse-Paella",category:"Vegetarisch",price:19,basePortions:4,ingredients:{"Paella-Reis":"400g","Paprika":"2 St√ºck","Artischocken":"1 Glas","Safran":"1 Prise","Erbsen":"200g"},instructions:["Gem√ºse anbraten","Reis zugeben","Mit Br√ºhe aufgie√üen","Safran zugeben","20 Min k√∂cheln"],childTip:"Bunt und lecker",workTip:"Kalt als Salat"},
                    {name:"Falafel mit Hummus",category:"Vegetarisch",price:13,basePortions:4,ingredients:{"Kichererbsen":"400g","Hummus":"300g","Pita":"8 St√ºck","Salat":"200g","Tahini":"100ml"},instructions:["Falafel formen","Frittieren oder backen","Pita erw√§rmen","Mit Hummus bestreichen","Mit Salat f√ºllen"],childTip:"Kinder lieben Falafel",workTip:"Falafel kalt mitnehmen"},
                    {name:"Gnocchi mit Tomatensauce",category:"Vegetarisch",price:14,basePortions:4,ingredients:{"Gnocchi":"800g","Tomaten":"600g","Basilikum":"1 Bund","Mozzarella":"200g","Knoblauch":"3 Zehen"},instructions:["Gnocchi kochen","Tomatensauce zubereiten","Gnocchi in Sauce schwenken","Mit Mozzarella √ºberbacken"],childTip:"Einfach und gut",workTip:"Schnell aufgew√§rmt"},
                    {name:"Pad Thai vegetarisch",category:"Vegetarisch",price:16,basePortions:4,ingredients:{"Reisnudeln":"400g","Tofu":"300g","Erdn√ºsse":"100g","Sojasprossen":"200g","Limetten":"3 St√ºck"},instructions:["Nudeln einweichen","Tofu anbraten","Alles im Wok schwenken","Mit Erdn√ºssen toppen"],childTip:"Ohne Chili f√ºr Kinder",workTip:"Kalt als Salat"},
                    {name:"Quiche Lorraine vegetarisch",category:"Vegetarisch",price:15,basePortions:4,ingredients:{"M√ºrbeteig":"300g","Lauch":"2 Stangen","Sahne":"300ml","Eier":"4 St√ºck","K√§se":"200g"},instructions:["Teig ausrollen","Lauch and√ºnsten","Eiermilch anr√ºhren","F√ºllen und backen","35 Min bei 180¬∞C"],childTip:"Mit extra K√§se",workTip:"Kalt oder warm gut"},
                    {name:"Auberginen-Parmigiana",category:"Vegetarisch",price:17,basePortions:4,ingredients:{"Auberginen":"3 St√ºck","Tomatensauce":"500ml","Mozzarella":"300g","Parmesan":"150g","Basilikum":"1 Bund"},instructions:["Auberginen in Scheiben","Anbraten oder grillen","Schichten mit Sauce","Mit K√§se √ºberbacken","40 Min backen"],childTip:"Viel K√§se hilft",workTip:"Wird besser durchgezogen"},
                    {name:"Linsen-Dal",category:"Vegetarisch",price:12,basePortions:4,ingredients:{"Rote Linsen":"400g","Kokosmilch":"400ml","Ingwer":"30g","Naan-Brot":"8 St√ºck","Koriander":"1 Bund"},instructions:["Linsen kochen","Gew√ºrze anr√∂sten","Mit Kokosmilch verfeinern","Mit Naan servieren"],childTip:"Mild w√ºrzen",workTip:"Wird besser aufgew√§rmt"},
                    {name:"Griechischer Bauernsalat XXL",category:"Vegetarisch",price:14,basePortions:4,ingredients:{"Tomaten":"600g","Gurken":"2 St√ºck","Feta":"300g","Oliven":"200g","Baguette":"1 St√ºck"},instructions:["Gem√ºse w√ºrfeln","Feta w√ºrfeln","Mit Dressing mischen","Mit Brot servieren"],childTip:"Feta separat",workTip:"Dressing separat"},
                    {name:"Shakshuka",category:"Vegetarisch",price:13,basePortions:4,ingredients:{"Eier":"8 St√ºck","Tomaten":"800g","Paprika":"2 St√ºck","Feta":"150g","Fladenbrot":"4 St√ºck"},instructions:["Tomatensauce kochen","Mulden formen","Eier hineinschlagen","Mit Feta bestreuen","Backen bis Eier fest"],childTip:"Eier durchgaren",workTip:"Frisch zubereiten"},
                    {name:"Vegetarische Burger",category:"Vegetarisch",price:16,basePortions:4,ingredients:{"Burger Buns":"8 St√ºck","Bohnen-Patties":"8 St√ºck","Salat":"200g","Tomaten":"4 St√ºck","Avocado":"2 St√ºck"},instructions:["Patties braten oder grillen","Buns toasten","Burger belegen","Mit Pommes servieren"],childTip:"Mit K√§se √ºberbacken",workTip:"Patties vorbraten"},
                    {name:"Sp√§tzle mit Pilzrahm",category:"Vegetarisch",price:15,basePortions:4,ingredients:{"Sp√§tzle":"600g","Mischpilze":"500g","Sahne":"300ml","Petersilie":"1 Bund","Wei√üwein":"100ml"},instructions:["Sp√§tzle kochen","Pilze anbraten","Mit Sahne abl√∂schen","Sp√§tzle untermischen"],childTip:"Ohne Wein",workTip:"Mit etwas Milch aufw√§rmen"},
                    {name:"Caprese-Auflauf",category:"Vegetarisch",price:18,basePortions:4,ingredients:{"Gnocchi":"800g","Tomaten":"500g","Mozzarella":"400g","Basilikum":"2 Bund","Balsamico":"50ml"},instructions:["Gnocchi anbraten","Mit Tomaten schichten","Mozzarella dar√ºber","20 Min √ºberbacken"],childTip:"Kinder lieben es",workTip:"Hei√ü oder kalt"},
                    {name:"Kartoffel-Gem√ºse-Gratin",category:"Vegetarisch",price:14,basePortions:4,ingredients:{"Kartoffeln":"1,2kg","Brokkoli":"400g","Sahne":"400ml","K√§se":"250g","Muskat":"1 Prise"},instructions:["Kartoffeln in Scheiben","Mit Gem√ºse schichten","Sahne dr√ºber","Mit K√§se backen"],childTip:"Extra k√§sig",workTip:"Aufw√§rmen im Ofen"},
                    {name:"Ratatouille mit Reis",category:"Vegetarisch",price:13,basePortions:4,ingredients:{"Zucchini":"2 St√ºck","Aubergine":"1 St√ºck","Paprika":"2 St√ºck","Tomaten":"400g","Reis":"400g"},instructions:["Gem√ºse w√ºrfeln","Schichtweise anbraten","Schmoren lassen","Mit Reis servieren"],childTip:"Gem√ºse weich kochen",workTip:"Wird besser durchgezogen"},
                    {name:"K√§se-Fondue",category:"Vegetarisch",price:22,basePortions:4,ingredients:{"K√§semischung":"600g","Wei√üwein":"300ml","Brot":"800g","Kartoffeln":"500g","Cornichons":"1 Glas"},instructions:["K√§se reiben","Mit Wein schmelzen","Brot w√ºrfeln","Kartoffeln kochen","Eintunken und genie√üen"],childTip:"Mit Traubensaft statt Wein",workTip:"Nicht geeignet"},
                    {name:"Pasta Arrabiata",category:"Vegetarisch",price:12,basePortions:4,ingredients:{"Penne":"500g","Tomaten":"800g","Chili":"2 St√ºck","Knoblauch":"4 Zehen","Pecorino":"100g"},instructions:["Scharfe Tomatensauce kochen","Pasta al dente","In Sauce schwenken","Mit Pecorino servieren"],childTip:"Ohne Chili",workTip:"Sauce einfrieren"},
                    {name:"Gem√ºse-Tempura",category:"Vegetarisch",price:17,basePortions:4,ingredients:{"Gem√ºse gemischt":"800g","Tempurateig":"300g","Sojasauce":"100ml","Reis":"400g","Ingwer":"20g"},instructions:["Teig anr√ºhren","Gem√ºse eintauchen","Frittieren","Mit Reis servieren"],childTip:"Beliebtes Fingerfood",workTip:"Frisch zubereiten"},
                    {name:"Tortilla Espa√±ola",category:"Vegetarisch",price:11,basePortions:4,ingredients:{"Kartoffeln":"1kg","Eier":"8 St√ºck","Zwiebeln":"2 St√ºck","Oliven√∂l":"150ml","Salat":"200g"},instructions:["Kartoffeln in √ñl garen","Mit Ei vermischen","In Pfanne stocken lassen","Wenden und fertig backen"],childTip:"Klassiker",workTip:"Kalt mitnehmen"},
                    {name:"S√º√ükartoffel-Curry",category:"Vegetarisch",price:14,basePortions:4,ingredients:{"S√º√ükartoffeln":"800g","Kokosmilch":"400ml","Spinat":"300g","Currypaste":"2 EL","Reis":"400g"},instructions:["S√º√ükartoffeln w√ºrfeln","In Curry k√∂cheln","Spinat zugeben","Mit Reis servieren"],childTip:"S√º√ü und mild",workTip:"Wird besser"},
                    {name:"Pilz-Stroganoff",category:"Vegetarisch",price:16,basePortions:4,ingredients:{"Champignons":"600g","Saure Sahne":"200ml","Zwiebeln":"2 St√ºck","Pasta":"500g","Petersilie":"1 Bund"},instructions:["Pilze anbraten","Zwiebeln zugeben","Mit saurer Sahne verfeinern","√úber Pasta servieren"],childTip:"Cremig und mild",workTip:"Sauce separat"},
                    {name:"Gem√ºse-Couscous",category:"Vegetarisch",price:13,basePortions:4,ingredients:{"Couscous":"400g","Gem√ºse":"600g","Rosinen":"100g","Mandeln":"100g","Harissa":"2 EL"},instructions:["Couscous quellen","Gem√ºse schmoren","Alles mischen","Mit Joghurt servieren"],childTip:"Ohne Harissa",workTip:"Kalt als Salat"},
                    {name:"Flammkuchen vegetarisch",category:"Vegetarisch",price:14,basePortions:4,ingredients:{"Flammkuchenteig":"400g","Cr√®me fra√Æche":"300ml","Lauch":"2 Stangen","K√§se":"200g","Pilze":"200g"},instructions:["Teig ausrollen","Mit Cr√®me bestreichen","Belegen","10 Min bei 250¬∞C"],childTip:"Mit extra K√§se",workTip:"Kalt auch gut"},
                    {name:"Burritos vegetarisch",category:"Vegetarisch",price:15,basePortions:4,ingredients:{"Tortillas":"8 St√ºck","Bohnen":"400g","Reis":"300g","K√§se":"200g","Salsa":"200ml"},instructions:["F√ºllung vorbereiten","Tortillas f√ºllen","Einrollen","Mit K√§se √ºberbacken"],childTip:"Mild w√ºrzen",workTip:"Einzeln einpacken"},
                    {name:"Brokkoli-K√§se-Suppe",category:"Vegetarisch",price:12,basePortions:4,ingredients:{"Brokkoli":"800g","Schmelzk√§se":"200g","Sahne":"200ml","Baguette":"1 St√ºck","Kartoffeln":"300g"},instructions:["Brokkoli kochen","P√ºrieren","K√§se einr√ºhren","Mit Brot servieren"],childTip:"Kinder m√∂gen K√§sesuppe",workTip:"In Thermoskanne"},
                    {name:"Gem√ºse-Quesadillas",category:"Vegetarisch",price:13,basePortions:4,ingredients:{"Tortillas":"8 St√ºck","K√§se":"300g","Paprika":"2 St√ºck","Mais":"200g","Guacamole":"200g"},instructions:["Tortillas belegen","Mit K√§se bestreuen","Zusammenklappen","In Pfanne braten"],childTip:"Viel K√§se",workTip:"Kalt mitnehmen"},
                    {name:"Pasta Primavera",category:"Vegetarisch",price:15,basePortions:4,ingredients:{"Pasta":"500g","Fr√ºhlingsgem√ºse":"600g","Sahne":"200ml","Parmesan":"100g","Basilikum":"1 Bund"},instructions:["Pasta kochen","Gem√ºse anbraten","Mit Sahne abl√∂schen","Pasta untermischen"],childTip:"Buntes Gem√ºse",workTip:"Mit etwas Milch aufw√§rmen"},
                    {name:"Indisches Thali",category:"Vegetarisch",price:18,basePortions:4,ingredients:{"Linsen-Dal":"400g","Reis":"400g","Naan":"8 St√ºck","Joghurt":"200ml","Chutney":"150ml"},instructions:["Verschiedene Currys kochen","Reis zubereiten","Naan erw√§rmen","Alles anrichten"],childTip:"Mild w√ºrzen",workTip:"Currys einzeln verpacken"},
                    {name:"Zucchini-Puffer",category:"Vegetarisch",price:11,basePortions:4,ingredients:{"Zucchini":"800g","Eier":"3 St√ºck","Mehl":"150g","Kr√§uterquark":"300g","Salat":"200g"},instructions:["Zucchini raspeln","Mit Ei und Mehl mischen","Puffer braten","Mit Quark servieren"],childTip:"Knusprig braten",workTip:"Kalt auch lecker"}
                ],
                kids: [
                    // Original 5 Rezepte
                    {name:"Mini-Frikadellen",category:"Kinder",price:8,basePortions:2,ingredients:{"Hackfleisch":"250g","Ei":"1 St√ºck","Semmelbr√∂sel":"3 EL","Kartoffelbrei":"500g"},instructions:["Hackfleisch mischen","Kleine Frikadellen formen","Braten","Mit Kartoffelbrei servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Nur f√ºr Kinder"},
                    {name:"Pfannkuchen",category:"Kinder",price:6,basePortions:2,ingredients:{"Mehl":"200g","Milch":"400ml","Eier":"3 St√ºck","Apfelmus":"400g"},instructions:["Teig anr√ºhren","D√ºnne Pfannkuchen backen","Mit Apfelmus servieren"],childTip:"Der Klassiker",workTip:"Nur f√ºr Kinder"},
                    {name:"Nudeln mit Butter",category:"Kinder",price:5,basePortions:2,ingredients:{"Nudeln":"200g","Butter":"50g","Parmesan":"50g","Erbsen":"100g"},instructions:["Nudeln kochen","Mit Butter mischen","Parmesan dr√ºber"],childTip:"Einfach und beliebt",workTip:"Nur f√ºr Kinder"},
                    {name:"Pizza-Schnecken",category:"Kinder",price:8,basePortions:2,ingredients:{"Pizzateig":"1 Rolle","Tomatensauce":"150ml","Salami":"100g","K√§se":"150g"},instructions:["Teig belegen","Aufrollen","In Scheiben schneiden","20 Min backen"],childTip:"Mini-Pizzen",workTip:"Nur f√ºr Kinder"},
                    {name:"Chicken Nuggets",category:"Kinder",price:10,basePortions:2,ingredients:{"H√§hnchen":"300g","Cornflakes":"100g","Ei":"1 St√ºck","Pommes":"400g"},instructions:["H√§hnchen schneiden","In Cornflakes wenden","Backen","Mit Pommes servieren"],childTip:"Ges√ºnder als gekaufte",workTip:"Nur f√ºr Kinder"},
                    // 15 neue Kinder-Rezepte
                    {name:"W√ºrstchen im Schlafrock",category:"Kinder",price:7,basePortions:2,ingredients:{"W√ºrstchen":"8 kleine","Bl√§tterteig":"200g","Ketchup":"100ml","Gurken":"2 St√ºck"},instructions:["W√ºrstchen in Teig wickeln","15 Min backen","Mit Ketchup servieren"],childTip:"Fingerfood",workTip:"Nur f√ºr Kinder"},
                    {name:"Milchreis mit Zimt",category:"Kinder",price:5,basePortions:2,ingredients:{"Milchreis":"200g","Milch":"600ml","Zucker":"50g","Zimt":"1 TL","Apfelmus":"200g"},instructions:["Reis in Milch kochen","S√º√üen","Mit Zimt bestreuen"],childTip:"Comfort Food",workTip:"Nur f√ºr Kinder"},
                    {name:"K√§se-Makkaroni",category:"Kinder",price:7,basePortions:2,ingredients:{"Makkaroni":"250g","K√§sesauce":"300ml","Erbsen":"100g","Brot":"2 Scheiben"},instructions:["Makkaroni kochen","Mit K√§sesauce mischen","Erbsen unterheben"],childTip:"Cremig und mild",workTip:"Nur f√ºr Kinder"},
                    {name:"Fischst√§bchen selbstgemacht",category:"Kinder",price:9,basePortions:2,ingredients:{"Fischfilet":"300g","Paniermehl":"150g","Ei":"2 St√ºck","Kartoffelp√ºree":"400g"},instructions:["Fisch schneiden","Panieren","Backen oder braten","Mit P√ºree servieren"],childTip:"Besser als gekauft",workTip:"Nur f√ºr Kinder"},
                    {name:"Gem√ºse-Muffins",category:"Kinder",price:6,basePortions:2,ingredients:{"Mehl":"200g","Gem√ºse geraspelt":"200g","K√§se":"100g","Eier":"2 St√ºck"},instructions:["Teig mischen","In Muffinform","25 Min backen"],childTip:"Gem√ºse versteckt",workTip:"Nur f√ºr Kinder"},
                    {name:"Nudelauflauf Hawaii",category:"Kinder",price:8,basePortions:2,ingredients:{"Nudeln":"250g","Schinken":"150g","Ananas":"200g","K√§se":"150g"},instructions:["Nudeln kochen","Mit Schinken und Ananas mischen","Mit K√§se √ºberbacken"],childTip:"S√º√ü-herzhaft",workTip:"Nur f√ºr Kinder"},
                    {name:"Kartoffelpuffer",category:"Kinder",price:6,basePortions:2,ingredients:{"Kartoffeln":"500g","Ei":"1 St√ºck","Mehl":"50g","Apfelmus":"200g"},instructions:["Kartoffeln reiben","Teig machen","Puffer braten","Mit Apfelmus"],childTip:"Knusprig",workTip:"Nur f√ºr Kinder"},
                    {name:"Mini-Hamburger",category:"Kinder",price:9,basePortions:2,ingredients:{"Mini-Br√∂tchen":"4 St√ºck","Hackfleisch":"200g","K√§se":"4 Scheiben","Pommes":"300g"},instructions:["Mini-Patties formen","Braten","Burger bauen","Mit Pommes"],childTip:"Kleine H√§nde",workTip:"Nur f√ºr Kinder"},
                    {name:"Grie√übrei",category:"Kinder",price:4,basePortions:2,ingredients:{"Grie√ü":"100g","Milch":"500ml","Zucker":"40g","Beeren":"150g"},instructions:["Milch aufkochen","Grie√ü einr√ºhren","Mit Beeren toppen"],childTip:"Wohlf√ºhlessen",workTip:"Nur f√ºr Kinder"},
                    {name:"Tortellini mit Tomatensauce",category:"Kinder",price:7,basePortions:2,ingredients:{"Tortellini":"300g","Tomatensauce":"200ml","Parmesan":"50g","Basilikum":"5 Bl√§tter"},instructions:["Tortellini kochen","Mit Sauce mischen","K√§se dr√ºber"],childTip:"Schnell und gut",workTip:"Nur f√ºr Kinder"},
                    {name:"H√§hnchen-Wraps",category:"Kinder",price:8,basePortions:2,ingredients:{"Tortillas":"4 kleine","H√§hnchen":"200g","Salat":"100g","K√§se":"100g"},instructions:["H√§hnchen braten","Tortillas belegen","Einrollen"],childTip:"Zum Mitnehmen",workTip:"Nur f√ºr Kinder"},
                    {name:"Eierkuchen mit Schinken",category:"Kinder",price:6,basePortions:2,ingredients:{"Eier":"4 St√ºck","Mehl":"100g","Milch":"200ml","Schinken":"100g"},instructions:["Eierkuchenteig machen","Mit Schinken backen","Einrollen"],childTip:"Herzhaft",workTip:"Nur f√ºr Kinder"},
                    {name:"Reis mit Erbsen",category:"Kinder",price:5,basePortions:2,ingredients:{"Reis":"200g","Erbsen":"150g","Butter":"30g","Salz":"1 Prise"},instructions:["Reis kochen","Erbsen zugeben","Mit Butter verfeinern"],childTip:"Einfach gut",workTip:"Nur f√ºr Kinder"},
                    {name:"Mini-Lasagne",category:"Kinder",price:8,basePortions:2,ingredients:{"Lasagneplatten":"150g","Bolognese":"300ml","Bechamel":"200ml","K√§se":"100g"},instructions:["Kleine Form schichten","30 Min backen"],childTip:"Kinderportionen",workTip:"Nur f√ºr Kinder"},
                    {name:"Sp√§tzle mit Sauce",category:"Kinder",price:6,basePortions:2,ingredients:{"Sp√§tzle":"300g","Bratensauce":"200ml","M√∂hren":"2 St√ºck","Erbsen":"100g"},instructions:["Sp√§tzle kochen","Mit Sauce mischen","Gem√ºse dazu"],childTip:"Schw√§bisch gut",workTip:"Nur f√ºr Kinder"},
                    {name:"Toast Hawaii",category:"Kinder",price:5,basePortions:2,ingredients:{"Toast":"4 Scheiben","Schinken":"4 Scheiben","Ananas":"4 Scheiben","K√§se":"4 Scheiben"},instructions:["Toast belegen","√úberbacken","Hei√ü servieren"],childTip:"Retro-Klassiker",workTip:"Nur f√ºr Kinder"},
                    {name:"Gem√ºsesuppe mit Nudeln",category:"Kinder",price:6,basePortions:2,ingredients:{"Suppengem√ºse":"300g","Nudeln":"100g","Br√ºhe":"800ml","W√ºrstchen":"2 St√ºck"},instructions:["Gem√ºse kochen","Nudeln zugeben","W√ºrstchen in Scheiben"],childTip:"Gesund",workTip:"Nur f√ºr Kinder"},
                    {name:"Arme Ritter",category:"Kinder",price:5,basePortions:2,ingredients:{"Toastbrot":"6 Scheiben","Eier":"2 St√ºck","Milch":"200ml","Zimt-Zucker":"50g"},instructions:["Toast in Eiermilch","In Pfanne braten","Mit Zimt-Zucker"],childTip:"S√º√ües Hauptgericht",workTip:"Nur f√ºr Kinder"},
                    {name:"Nudelsuppe",category:"Kinder",price:4,basePortions:2,ingredients:{"Suppennudeln":"150g","H√ºhnerbr√ºhe":"800ml","M√∂hren":"2 St√ºck","Petersilie":"1 Bund"},instructions:["Br√ºhe kochen","Nudeln und Gem√ºse rein","10 Min k√∂cheln"],childTip:"Bei Erk√§ltung",workTip:"Nur f√ºr Kinder"}
                ]
            };
        }

        // Globale Variablen
        let currentWeekPlan = [];
        let shoppingListData = {};
        let preferences = {};
        let weeksSincePizza = 0;
        let currentWeekStart = null;
        let savedWeeks = [];
        let currentGistId = null;
        let personPortions = {};

        // Funktion-Deklarationen vor dem DOMContentLoaded
        
        // Best√§tigung vor neuem Plan
        function confirmGenerateNewPlan() {
            if (currentWeekPlan.length > 0) {
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'confirm-dialog active';
                confirmDialog.innerHTML = `
                    <h3>‚ö†Ô∏è Neuen Plan generieren?</h3>
                    <p>Der aktuelle Wochenplan geht verloren, wenn er nicht gespeichert wurde.</p>
                    <p><strong>Tipp:</strong> Speichere den aktuellen Plan mit "Woche speichern" bevor du einen neuen generierst.</p>
                    <div class="confirm-actions">
                        <button class="btn btn-secondary" onclick="this.closest('.confirm-dialog').remove()">Abbrechen</button>
                        <button class="btn btn-primary" onclick="this.closest('.confirm-dialog').remove(); generateNewPlan();">Neuen Plan erstellen</button>
                    </div>
                `;
                document.body.appendChild(confirmDialog);
            } else {
                generateNewPlan();
            }
        }

        // Weitere globale Funktionen
        function saveCurrentWeek() {
            if (currentWeekPlan.length === 0) {
                alert('‚ö† Kein Wochenplan zum Speichern vorhanden!');
                return;
            }
            
            const weekData = {
                id: Date.now(),
                weekStart: currentWeekStart.toISOString(),
                savedDate: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                totalCost: document.getElementById('totalCost').textContent,
                summary: getSummaryText(),
                personPortions: personPortions
            };
            
            if (savedWeeks.length >= 10) {
                if (confirm('‚ö†Ô∏è Es sind bereits 10 Wochen gespeichert. Die √§lteste Woche wird √ºberschrieben. Fortfahren?')) {
                    savedWeeks.shift();
                } else {
                    return;
                }
            }
            
            savedWeeks.push(weekData);
            localStorage.setItem('savedWeekPlans', JSON.stringify(savedWeeks));
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ Gespeichert!';
            btn.style.background = '#4CAF50';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }

        function showSavedWeeks() {
            if (savedWeeks.length === 0) {
                alert('üìÇ Keine gespeicherten Wochen vorhanden.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üìÇ Gespeicherte Wochen</h2>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="saved-weeks-list">
                        ${savedWeeks.map((week, index) => {
                            const weekStart = new Date(week.weekStart);
                            const weekEnd = new Date(weekStart);
                            weekEnd.setDate(weekStart.getDate() + 6);
                            const startStr = weekStart.toLocaleDateString('de-CH');
                            const endStr = weekEnd.toLocaleDateString('de-CH');
                            
                            return `
                                <div class="saved-week-item">
                                    <div class="saved-week-info">
                                        <div class="saved-week-date">${startStr} - ${endStr}</div>
                                        <div class="saved-week-summary">${week.summary} ‚Ä¢ ${week.totalCost} CHF</div>
                                    </div>
                                    <div class="saved-week-actions">
                                        <button class="mini-btn mini-btn-load" onclick="loadSavedWeek(${index})">Laden</button>
                                        <button class="mini-btn mini-btn-delete" onclick="deleteSavedWeek(${index})">üóëÔ∏è</button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function exportToPDF() {
            window.print();
        }

        function showGitHubSync() {
            const modal = document.getElementById('githubModal');
            modal.classList.add('active');
        }

        function closeGitHubSync() {
            const modal = document.getElementById('githubModal');
            modal.classList.remove('active');
        }

        function savePreferences() {
            const githubToken = document.getElementById('githubToken').value;
            
            savePortionSettings();
            
            preferences = {
                ...preferences,
                dailyBudget: document.getElementById('dailyBudget').value,
                adultsCount: document.getElementById('adultsCount').value,
                childrenCount: document.getElementById('childrenCount').value,
                vegDays: document.getElementById('vegDays').value,
                pizzaFrequency: document.getElementById('pizzaFrequency').value,
                weeksSincePizza: weeksSincePizza,
                githubToken: githubToken,
                noLamb: document.getElementById('noLamb').checked,
                noPork: document.getElementById('noPork').checked,
                noBeef: document.getElementById('noBeef').checked,
                noDuck: document.getElementById('noDuck').checked,
                noCottageCheese: document.getElementById('noCottageCheese').checked,
                noGorgonzola: document.getElementById('noGorgonzola').checked,
                noFeta: document.getElementById('noFeta').checked,
                noCheese: document.getElementById('noCheese').checked,
                noFish: document.getElementById('noFish').checked,
                noMushrooms: document.getElementById('noMushrooms').checked,
                noNuts: document.getElementById('noNuts').checked,
                noSpicy: document.getElementById('noSpicy').checked,
                noTofu: document.getElementById('noTofu').checked,
                noEggplant: document.getElementById('noEggplant').checked
            };
            
            localStorage.setItem('mealPlannerPrefs', JSON.stringify(preferences));
            
            if (githubToken) {
                localStorage.setItem('githubToken', githubToken);
            }
            
            alert('‚úÖ Einstellungen wurden gespeichert!');
        }

        function switchTab(event, tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function updateBudgetDisplay() {
            const dailyBudget = document.getElementById('dailyBudget').value;
            const weeklyBudget = dailyBudget * 7;
            document.getElementById('budgetDisplay').textContent = `${weeklyBudget} CHF`;
        }

        function updatePersonPortions() {
            const adultsCount = parseInt(document.getElementById('adultsCount').value);
            const childrenCount = parseInt(document.getElementById('childrenCount').value);
            const container = document.getElementById('portionSettings');
            
            container.innerHTML = '';
            
            for (let i = 1; i <= adultsCount; i++) {
                const personDiv = document.createElement('div');
                personDiv.className = 'person-portion';
                personDiv.innerHTML = `
                    <label>Erwachsener ${i}:</label>
                    <input type="number" id="adult${i}Portion" value="${personPortions[`adult${i}`] || 1.0}" 
                           min="0.5" max="2.0" step="0.1" onchange="savePortionSettings()">
                `;
                container.appendChild(personDiv);
            }
            
            for (let i = 1; i <= childrenCount; i++) {
                const personDiv = document.createElement('div');
                personDiv.className = 'person-portion';
                personDiv.innerHTML = `
                    <label>Kind ${i}:</label>
                    <input type="number" id="child${i}Portion" value="${personPortions[`child${i}`] || 0.5}" 
                           min="0.2" max="1.0" step="0.1" onchange="savePortionSettings()">
                `;
                container.appendChild(personDiv);
            }
            
            updateBudgetDisplay();
        }

        function savePortionSettings() {
            const adultsCount = parseInt(document.getElementById('adultsCount').value);
            const childrenCount = parseInt(document.getElementById('childrenCount').value);
            
            personPortions = {};
            
            for (let i = 1; i <= adultsCount; i++) {
                const input = document.getElementById(`adult${i}Portion`);
                if (input) {
                    personPortions[`adult${i}`] = parseFloat(input.value);
                }
            }
            
            for (let i = 1; i <= childrenCount; i++) {
                const input = document.getElementById(`child${i}Portion`);
                if (input) {
                    personPortions[`child${i}`] = parseFloat(input.value);
                }
            }
            
            preferences.personPortions = personPortions;
            localStorage.setItem('mealPlannerPrefs', JSON.stringify(preferences));
        }

        function swapRecipe(dayIndex, mealType) {
            const dayPlan = currentWeekPlan[dayIndex];
            let availableRecipes = [];
            let currentRecipe = null;
            
            if (mealType === 'dinner') {
                currentRecipe = dayPlan.dinner;
                
                const usedRecipes = currentWeekPlan
                    .filter((_, idx) => idx !== dayIndex)
                    .map(dp => dp.dinner.name);
                
                if (currentRecipe.category === 'Fleisch') {
                    availableRecipes = recipes.meat.filter(r => 
                        r.name !== currentRecipe.name && 
                        !usedRecipes.includes(r.name) && 
                        filterRecipe(r)
                    );
                    if (availableRecipes.length === 0) {
                        availableRecipes = recipes.meat.filter(r => 
                            r.name !== currentRecipe.name && filterRecipe(r)
                        );
                    }
                } else if (currentRecipe.category === 'Vegetarisch') {
                    availableRecipes = recipes.vegetarian.filter(r => 
                        r.name !== currentRecipe.name && 
                        !usedRecipes.includes(r.name) && 
                        filterRecipe(r)
                    );
                    if (availableRecipes.length === 0) {
                        availableRecipes = recipes.vegetarian.filter(r => 
                            r.name !== currentRecipe.name && filterRecipe(r)
                        );
                    }
                }
            } else if (mealType === 'kidsLunch') {
                currentRecipe = dayPlan.kidsLunch;
                availableRecipes = recipes.kids.filter(r => r.name !== currentRecipe.name && filterRecipe(r));
            }
            
            if (availableRecipes.length > 0) {
                const newRecipe = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                
                removeFromShoppingList(currentRecipe);
                
                if (mealType === 'dinner') {
                    currentWeekPlan[dayIndex].dinner = newRecipe;
                } else {
                    currentWeekPlan[dayIndex].kidsLunch = newRecipe;
                }
                
                addToShoppingList(newRecipe, dayIndex);
                
                displayWeekOverview();
                displayShoppingList();
                displayRecipes();
                
                const dayCards = document.querySelectorAll('.day-card');
                dayCards[dayIndex].style.animation = 'pulse 0.5s';
                setTimeout(() => {
                    dayCards[dayIndex].style.animation = '';
                }, 500);
                
                autoSaveToGitHub();
            } else {
                alert('‚ö†Ô∏è Keine alternativen Rezepte mit den aktuellen Filtereinstellungen verf√ºgbar.');
            }
        }

        function loadSavedWeek(index) {
            const week = savedWeeks[index];
            
            if (currentWeekPlan.length > 0) {
                if (!confirm('‚ö†Ô∏è Der aktuelle Wochenplan wird √ºberschrieben. Fortfahren?')) {
                    return;
                }
            }
            
            currentWeekPlan = week.weekPlan;
            shoppingListData = week.shoppingList;
            currentWeekStart = new Date(week.weekStart);
            
            if (week.personPortions) {
                personPortions = week.personPortions;
                preferences.personPortions = personPortions;
                updatePersonPortions();
            }
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const startStr = currentWeekStart.toLocaleDateString('de-CH', options);
            const endStr = weekEnd.toLocaleDateString('de-CH', options);
            document.getElementById('weekDateDisplay').textContent = `Woche vom ${startStr} bis ${endStr}`;
            
            displayWeekOverview();
            displayShoppingList();
            displayRecipes();
            
            document.querySelector('.modal').remove();
            
            alert('‚úÖ Wochenplan wurde geladen!');
        }

        function deleteSavedWeek(index) {
            if (confirm('üóëÔ∏è Diese gespeicherte Woche wirklich l√∂schen?')) {
                savedWeeks.splice(index, 1);
                localStorage.setItem('savedWeekPlans', JSON.stringify(savedWeeks));
                
                document.querySelector('.modal').remove();
                showSavedWeeks();
            }
        }

        async function saveToGitHub() {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            const gistName = document.getElementById('gistName').value || `Wochenplan ${new Date().toLocaleDateString('de-CH')}`;
            
            if (!token) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            if (currentWeekPlan.length === 0) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Kein Wochenplan zum Speichern vorhanden!</div>';
                return;
            }
            
            const data = {
                version: '3.0',
                timestamp: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                preferences: preferences,
                weeksSincePizza: weeksSincePizza,
                weekStart: currentWeekStart.toISOString(),
                totalCost: document.getElementById('totalCost').textContent,
                personPortions: personPortions
            };
            
            const gistData = {
                description: gistName,
                public: false,
                files: {
                    'wochenplan.json': {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };
            
            try {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-info">üì§ Speichere auf GitHub...</div>';
                
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(gistData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentGistId = result.id;
                    localStorage.setItem('currentGistId', currentGistId);
                    localStorage.setItem('lastSyncDate', new Date().toISOString());
                    
                    document.getElementById('saveStatus').innerHTML = 
                        `<div class="status-success">
                            ‚úÖ Erfolgreich gespeichert!<br>
                            Gist ID: <code>${result.id}</code><br>
                            <a href="${result.html_url}" target="_blank" style="color: #0366d6;">Auf GitHub ansehen ‚Üí</a>
                        </div>`;
                } else {
                    throw new Error(`GitHub API Fehler: ${response.status}`);
                }
            } catch (error) {
                document.getElementById('saveStatus').innerHTML = 
                    `<div class="status-error">‚ùå Fehler: ${error.message}</div>`;
            }
        }

        async function updateExistingGist() {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            if (!token) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            if (!currentGistId) {
                const gistId = prompt('Bitte Gist-ID eingeben:');
                if (!gistId) return;
                currentGistId = gistId;
                localStorage.setItem('currentGistId', currentGistId);
            }
            
            const data = {
                version: '3.0',
                timestamp: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                preferences: preferences,
                weeksSincePizza: weeksSincePizza,
                weekStart: currentWeekStart.toISOString(),
                totalCost: document.getElementById('totalCost').textContent,
                personPortions: personPortions
            };
            
            const gistData = {
                files: {
                    'wochenplan.json': {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };
            
            try {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-info">üîÑ Aktualisiere Gist...</div>';
                
                const response = await fetch(`https://api.github.com/gists/${currentGistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(gistData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    localStorage.setItem('lastSyncDate', new Date().toISOString());
                    
                    document.getElementById('saveStatus').innerHTML = 
                        '<div class="status-success">' +
                        '‚úÖ Erfolgreich aktualisiert!<br>' +
                        '<a href="' + result.html_url + '" target="_blank" style="color: #0366d6;">Auf GitHub ansehen ‚Üí</a>' +
                        '</div>';
                } else {
                    throw new Error('GitHub API Fehler: ' + response.status);
                }
            } catch (error) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ùå Fehler: ' + error.message + '</div>';
            }
        }

        async function loadGists() {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            if (!token) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            try {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-info">üìã Lade Gists...</div>';
                
                const response = await fetch('https://api.github.com/gists', {
                    headers: {
                        'Authorization': 'token ' + token,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const gists = await response.json();
                    const mealPlanGists = gists.filter(gist => 
                        gist.files && gist.files['wochenplan.json']
                    );
                    
                    if (mealPlanGists.length === 0) {
                        document.getElementById('loadStatus').innerHTML = 
                            '<div class="status-info">Keine gespeicherten Wochenpl√§ne gefunden.</div>';
                        return;
                    }
                    
                    const gistList = document.getElementById('gistList');
                    let gistHTML = '';
                    mealPlanGists.forEach(gist => {
                        const date = new Date(gist.updated_at);
                        const dateStr = date.toLocaleDateString('de-CH');
                        const timeStr = date.toLocaleTimeString('de-CH', {hour: '2-digit', minute: '2-digit'});
                        
                        gistHTML += '<div class="gist-item" onclick="loadGistById(\'' + gist.id + '\')">' +
                            '<div class="gist-title">' + (gist.description || 'Wochenplan') + '</div>' +
                            '<div class="gist-date">' + dateStr + ' ' + timeStr + '</div>' +
                            '</div>';
                    });
                    gistList.innerHTML = gistHTML;
                    
                    gistList.style.display = 'block';
                    document.getElementById('loadStatus').innerHTML = '';
                } else {
                    throw new Error('GitHub API Fehler: ' + response.status);
                }
            } catch (error) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ùå Fehler: ' + error.message + '</div>';
            }
        }

        async function loadGistById(gistId) {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            try {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-info">üì• Lade Wochenplan...</div>';
                
                const response = await fetch('https://api.github.com/gists/' + gistId, {
                    headers: {
                        'Authorization': 'token ' + token,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const gist = await response.json();
                    const content = gist.files['wochenplan.json'].content;
                    const data = JSON.parse(content);
                    
                    importWeekPlan(data);
                    currentGistId = gistId;
                    localStorage.setItem('currentGistId', currentGistId);
                    localStorage.setItem('lastSyncDate', gist.updated_at);
                    
                    document.getElementById('loadStatus').innerHTML = 
                        '<div class="status-success">‚úÖ Wochenplan erfolgreich geladen!</div>';
                    
                    setTimeout(() => {
                        closeGitHubSync();
                    }, 2000);
                } else {
                    throw new Error('GitHub API Fehler: ' + response.status);
                }
            } catch (error) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ùå Fehler: ' + error.message + '</div>';
            }
        }

        async function loadFromGitHub() {
            const input = document.getElementById('gistId').value.trim();
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            if (!input) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte Gist-ID oder URL eingeben!</div>';
                return;
            }
            
            if (!token) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            let gistId = input;
            if (input.includes('gist.github.com')) {
                const matches = input.match(/([a-f0-9]{32})/);
                if (matches) {
                    gistId = matches[1];
                }
            }
            
            loadGistById(gistId);
        }

        // Rest der Funktionen
        function loadRecipeStats() {
            const meatCount = recipes.meat ? recipes.meat.length : 0;
            const vegCount = recipes.vegetarian ? recipes.vegetarian.length : 0;
            const kidsCount = recipes.kids ? recipes.kids.length : 0;
            const total = meatCount + vegCount + kidsCount;
            
            document.getElementById('totalRecipes').textContent = total;
            document.getElementById('meatCount').textContent = meatCount;
            document.getElementById('vegCount').textContent = vegCount;
            document.getElementById('kidsCount').textContent = kidsCount;
        }

        function updateRecipeStats() {
            loadRecipeStats();
        }

        function updatePizzaCountdown() {
            const pizzaFreq = document.getElementById('pizzaFrequency').value;
            if (pizzaFreq === '0') {
                document.getElementById('pizzaCountdown').textContent = 'deaktiviert';
            } else if (pizzaFreq === '3') {
                const nextPizza = Math.max(1, 3 - weeksSincePizza);
                document.getElementById('pizzaCountdown').textContent = `${nextPizza}`;
            } else {
                const nextPizza = Math.max(1, parseInt(pizzaFreq) - weeksSincePizza);
                document.getElementById('pizzaCountdown').textContent = `${nextPizza}`;
            }
        }

        function calculateCurrentWeekDates() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            let daysToLastFriday = (dayOfWeek + 2) % 7;
            if (dayOfWeek >= 5 || dayOfWeek === 0) {
                daysToLastFriday = (dayOfWeek === 5) ? 0 : (dayOfWeek === 6) ? 1 : 2;
            }
            
            currentWeekStart = new Date(today);
            currentWeekStart.setDate(today.getDate() - daysToLastFriday);
            currentWeekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const startStr = currentWeekStart.toLocaleDateString('de-CH', options);
            const endStr = weekEnd.toLocaleDateString('de-CH', options);
            
            document.getElementById('weekDateDisplay').textContent = `Woche vom ${startStr} bis ${endStr}`;
        }

        function loadPreferences() {
            const saved = localStorage.getItem('mealPlannerPrefs');
            if (saved) {
                preferences = JSON.parse(saved);
                
                if (preferences.dailyBudget) document.getElementById('dailyBudget').value = preferences.dailyBudget;
                if (preferences.vegDays !== undefined) document.getElementById('vegDays').value = preferences.vegDays;
                if (preferences.adultsCount) document.getElementById('adultsCount').value = preferences.adultsCount;
                if (preferences.childrenCount) document.getElementById('childrenCount').value = preferences.childrenCount;
                if (preferences.weeksSincePizza !== undefined) {
                    weeksSincePizza = preferences.weeksSincePizza;
                }
                if (preferences.pizzaFrequency !== undefined) document.getElementById('pizzaFrequency').value = preferences.pizzaFrequency;
                if (preferences.githubToken) document.getElementById('githubToken').value = preferences.githubToken;
                
                if (preferences.personPortions) {
                    personPortions = preferences.personPortions;
                }
                
                if (preferences.noLamb !== undefined) document.getElementById('noLamb').checked = preferences.noLamb;
                if (preferences.noPork !== undefined) document.getElementById('noPork').checked = preferences.noPork;
                if (preferences.noBeef !== undefined) document.getElementById('noBeef').checked = preferences.noBeef;
                if (preferences.noDuck !== undefined) document.getElementById('noDuck').checked = preferences.noDuck;
                if (preferences.noCottageCheese !== undefined) document.getElementById('noCottageCheese').checked = preferences.noCottageCheese;
                if (preferences.noGorgonzola !== undefined) document.getElementById('noGorgonzola').checked = preferences.noGorgonzola;
                if (preferences.noFeta !== undefined) document.getElementById('noFeta').checked = preferences.noFeta;
                if (preferences.noCheese !== undefined) document.getElementById('noCheese').checked = preferences.noCheese;
                if (preferences.noFish !== undefined) document.getElementById('noFish').checked = preferences.noFish;
                if (preferences.noMushrooms !== undefined) document.getElementById('noMushrooms').checked = preferences.noMushrooms;
                if (preferences.noNuts !== undefined) document.getElementById('noNuts').checked = preferences.noNuts;
                if (preferences.noSpicy !== undefined) document.getElementById('noSpicy').checked = preferences.noSpicy;
                if (preferences.noTofu !== undefined) document.getElementById('noTofu').checked = preferences.noTofu;
                if (preferences.noEggplant !== undefined) document.getElementById('noEggplant').checked = preferences.noEggplant;
            }
            
            const token = localStorage.getItem('githubToken');
            if (token) {
                document.getElementById('githubToken').value = token;
            }
            
            currentGistId = localStorage.getItem('currentGistId');
            
            updateBudgetDisplay();
        }

        function loadSavedWeeks() {
            const saved = localStorage.getItem('savedWeekPlans');
            if (saved) {
                savedWeeks = JSON.parse(saved);
            }
        }

        function getSummaryText() {
            const meatCount = currentWeekPlan.filter(d => d.dinner.category === 'Fleisch').length;
            const vegCount = currentWeekPlan.filter(d => d.dinner.category === 'Vegetarisch').length;
            const pizzaCount = currentWeekPlan.filter(d => d.dinner.special === 'pizza-weekend').length;
            
            let summary = `${meatCount}x Fleisch, ${vegCount}x Vegetarisch`;
            if (pizzaCount > 0) {
                summary += `, ${pizzaCount}x Pizza`;
            }
            return summary;
        }

        function calculateTotalPortionFactor() {
            let total = 0;
            for (const [key, value] of Object.entries(personPortions)) {
                total += value;
            }
            return total || 4;
        }

        function calculateIngredientAmount(baseAmount, dayIndex) {
            const day = currentWeekPlan[dayIndex].day;
            const isLeftoverDay = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag'].includes(day);
            
            const basePortions = 4;
            const currentPortions = calculateTotalPortionFactor();
            
            let factor = currentPortions / basePortions;
            
            if (isLeftoverDay) {
                factor *= 1.25;
            }
            
            const numMatch = baseAmount.match(/(\d+(?:\.\d+)?)/);
            if (numMatch) {
                const baseNum = parseFloat(numMatch[1]);
                const newNum = Math.round(baseNum * factor * 10) / 10;
                return baseAmount.replace(numMatch[1], newNum.toString());
            }
            
            return baseAmount;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function distributeVegDays(totalDays, vegCount) {
            if (vegCount === 0) return [];
            if (vegCount >= totalDays) return Array.from({length: totalDays}, (_, i) => i);
            
            const positions = [];
            const spacing = Math.floor(totalDays / vegCount);
            
            for (let i = 0; i < vegCount; i++) {
                let pos = i * spacing + Math.floor(Math.random() * Math.max(1, spacing - 1));
                if (pos >= totalDays) pos = totalDays - 1;
                if (!positions.includes(pos)) {
                    positions.push(pos);
                }
            }
            
            return positions;
        }

        function filterRecipe(recipe) {
            const prefs = preferences;
            const ingredients = Object.keys(recipe.ingredients).join(' ').toLowerCase();
            const name = recipe.name.toLowerCase();
            
            if (prefs.noLamb && (name.includes('lamm') || ingredients.includes('lamm'))) return false;
            if (prefs.noPork && (name.includes('schwein') || ingredients.includes('schwein') || 
                name.includes('speck') || ingredients.includes('speck') || 
                name.includes('schinken') || ingredients.includes('schinken'))) return false;
            if (prefs.noBeef && (name.includes('rind') || ingredients.includes('rind') || 
                name.includes('kalb') || ingredients.includes('kalb'))) return false;
            if (prefs.noDuck && (name.includes('ente') || ingredients.includes('ente'))) return false;
            
            if (prefs.noCottageCheese && (name.includes('h√ºttenk√§se') || ingredients.includes('h√ºttenk√§se'))) return false;
            if (prefs.noGorgonzola && (name.includes('gorgonzola') || ingredients.includes('gorgonzola'))) return false;
            if (prefs.noFeta && (name.includes('feta') || ingredients.includes('feta'))) return false;
            
            if (prefs.noFish && (name.includes('fisch') || ingredients.includes('fisch'))) return false;
            if (prefs.noMushrooms && (name.includes('pilz') || ingredients.includes('pilz') || 
                name.includes('champignon') || ingredients.includes('champignon'))) return false;
            if (prefs.noNuts && (name.includes('nuss') || ingredients.includes('nuss') || 
                name.includes('waln√ºsse') || ingredients.includes('waln√ºsse'))) return false;
            if (prefs.noSpicy && (name.includes('chili') || ingredients.includes('chili') || 
                name.includes('scharf') || recipe.childTip.includes('scharf'))) return false;
            if (prefs.noTofu && (name.includes('tofu') || ingredients.includes('tofu'))) return false;
            if (prefs.noEggplant && (name.includes('aubergine') || ingredients.includes('aubergine'))) return false;
            
            return true;
        }

        function generateNewPlan() {
            document.getElementById('loadingOverview').classList.add('active');
            
            setTimeout(() => {
                const vegDays = parseInt(document.getElementById('vegDays').value);
                const pizzaFreq = document.getElementById('pizzaFrequency').value;
                const days = ['Freitag', 'Samstag', 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag'];
                
                let isPizzaWeekend = false;
                if (pizzaFreq !== '0') {
                    weeksSincePizza++;
                    
                    if (pizzaFreq === '3') {
                        isPizzaWeekend = weeksSincePizza >= 2 && (weeksSincePizza >= 3 || Math.random() > 0.5);
                    } else if (pizzaFreq === '4') {
                        isPizzaWeekend = weeksSincePizza >= 3 && (weeksSincePizza >= 4 || Math.random() > 0.5);
                    } else {
                        isPizzaWeekend = weeksSincePizza >= parseInt(pizzaFreq);
                    }
                    
                    if (isPizzaWeekend) {
                        weeksSincePizza = 0;
                        setTimeout(() => {
                            document.getElementById('pizzaIndicator').style.display = 'block';
                            alert('üçï PIZZA-WOCHENENDE! üçï\n\nDiese Woche gibt es Freitag und Samstag Pizza!\n\nGenie√üt euer entspanntes Wochenende!');
                        }, 1000);
                    } else {
                        document.getElementById('pizzaIndicator').style.display = 'none';
                    }
                } else {
                    document.getElementById('pizzaIndicator').style.display = 'none';
                }
                
                const filteredMeatRecipes = shuffleArray(recipes.meat.filter(r => filterRecipe(r)));
                const filteredVegRecipes = shuffleArray(recipes.vegetarian.filter(r => filterRecipe(r)));
                const filteredKidsRecipes = shuffleArray(recipes.kids.filter(r => filterRecipe(r)));
                
                if (filteredMeatRecipes.length < 4 || filteredVegRecipes.length < 3) {
                    alert('‚ö†Ô∏è Warnung: Mit den aktuellen Filtereinstellungen sind nicht genug Rezepte verf√ºgbar. Bitte reduziere die Ausschl√ºsse in den Einstellungen.');
                }
                
                const pizzaFriday = {
                    name: "üçï Pizza-Freitag (Selbstgemacht)",
                    category: "Pizza-Weekend",
                    price: 7,
                    basePortions: 4,
                    ingredients: {
                        "Pizzamehl (f√ºr 2 Tage)": "1kg",
                        "San Marzano Tomaten": "1 Dose",
                        "Galbani Mozzarella Cucina": "300g",
                        "Belag nach Wahl": "Salami oder Thunfisch",
                        "Oliven√∂l": "2 EL",
                        "Hefe": "1 W√ºrfel",
                        "Salz": "1 TL"
                    },
                    instructions: [
                        "Teig f√ºr 2 Tage vorbereiten (1kg Mehl)",
                        "24 Stunden im K√ºhlschrank gehen lassen",
                        "Teig portionieren und ausrollen",
                        "Mit San Marzano Tomatensauce bestreichen",
                        "Galbani Mozzarella und Belag verteilen",
                        "Bei 250¬∞C ca. 10-12 Min backen",
                        "Restlichen Teig f√ºr morgen aufbewahren"
                    ],
                    childTip: "Kinder k√∂nnen beim Belegen helfen",
                    workTip: "Reste kalt zum Mitnehmen",
                    special: "pizza-weekend"
                };
                
                const pizzaSaturday = {
                    name: "üçï Pizza-Samstag (Tag 2)",
                    category: "Pizza-Weekend",
                    price: 7,
                    basePortions: 4,
                    ingredients: {
                        "Teig vom Vortag": "bereits vorbereitet",
                        "Restliche San Marzano Sauce": "vom Vortag",
                        "Galbani Mozzarella Cucina": "300g",
                        "Belag Variation": "z.B. Schinken, Pilze, Gem√ºse",
                        "Oregano": "nach Geschmack"
                    },
                    instructions: [
                        "Teig vom Vortag verwenden",
                        "Nochmal 30 Min bei Raumtemperatur ruhen lassen",
                        "Ausrollen und belegen",
                        "Heute andere Bel√§ge ausprobieren",
                        "Bei 250¬∞C ca. 10-12 Min backen",
                        "Gem√ºtlicher Pizza-Samstag!"
                    ],
                    childTip: "Kinder k√∂nnen eigene Mini-Pizzen machen",
                    workTip: "Perfektes Wochenend-Essen",
                    special: "pizza-weekend"
                };
                
                currentWeekPlan = [];
                shoppingListData = {};
                
                const vegDayPositions = distributeVegDays(7, vegDays);
                
                let meatIndex = 0;
                let vegIndex = 0;
                let kidsIndex = 0;
                let usedRecipes = [];
                
                days.forEach((day, index) => {
                    let recipe;
                    
                    if (isPizzaWeekend && day === 'Freitag') {
                        recipe = pizzaFriday;
                    } else if (isPizzaWeekend && day === 'Samstag') {
                        recipe = pizzaSaturday;
                    } else if (vegDayPositions.includes(index)) {
                        let availableVegRecipes = filteredVegRecipes.filter(r => !usedRecipes.includes(r.name));
                        if (availableVegRecipes.length === 0) {
                            availableVegRecipes = filteredVegRecipes;
                            usedRecipes = [];
                        }
                        recipe = availableVegRecipes[vegIndex++ % availableVegRecipes.length];
                        usedRecipes.push(recipe.name);
                    } else {
                        let availableMeatRecipes = filteredMeatRecipes.filter(r => !usedRecipes.includes(r.name));
                        if (availableMeatRecipes.length === 0) {
                            availableMeatRecipes = filteredMeatRecipes;
                            usedRecipes = [];
                        }
                        recipe = availableMeatRecipes[meatIndex++ % availableMeatRecipes.length];
                        usedRecipes.push(recipe.name);
                    }
                    
                    const dayPlan = {
                        day: day,
                        dinner: recipe,
                        kidsLunch: null,
                        isLeftoverDay: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag'].includes(day)
                    };
                    
                    if (day === 'Dienstag' || day === 'Donnerstag') {
                        dayPlan.kidsLunch = filteredKidsRecipes[kidsIndex++ % filteredKidsRecipes.length];
                    }
                    
                    currentWeekPlan.push(dayPlan);
                    
                    addToShoppingList(recipe, index);
                    if (dayPlan.kidsLunch) {
                        addToShoppingList(dayPlan.kidsLunch, index);
                    }
                });
                
                preferences.weeksSincePizza = weeksSincePizza;
                localStorage.setItem('mealPlannerPrefs', JSON.stringify(preferences));
                
                updatePizzaCountdown();
                displayWeekOverview();
                displayShoppingList();
                displayRecipes();
                
                document.getElementById('loadingOverview').classList.remove('active');
                
                autoSaveToGitHub();
            }, 800);
        }

        async function autoSaveToGitHub() {
            const token = localStorage.getItem('githubToken');
            if (!token || currentWeekPlan.length === 0) return;
            
            const data = {
                version: '3.0',
                timestamp: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                preferences: preferences,
                weeksSincePizza: weeksSincePizza,
                weekStart: currentWeekStart.toISOString(),
                totalCost: document.getElementById('totalCost').textContent,
                personPortions: personPortions
            };
            
            const gistData = {
                files: {
                    'wochenplan.json': {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };
            
            try {
                if (currentGistId) {
                    await fetch(`https://api.github.com/gists/${currentGistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                } else {
                    gistData.description = `Wochenplan ${new Date().toLocaleDateString('de-CH')}`;
                    gistData.public = false;
                    
                    const response = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        currentGistId = result.id;
                        localStorage.setItem('currentGistId', currentGistId);
                    }
                }
                
                localStorage.setItem('lastSyncDate', new Date().toISOString());
            } catch (error) {
                console.error('Auto-Save Fehler:', error);
            }
        }

        function addToShoppingList(recipe, dayIndex) {
            for (const [ingredient, amount] of Object.entries(recipe.ingredients)) {
                const adjustedAmount = calculateIngredientAmount(amount, dayIndex);
                
                if (!shoppingListData[ingredient]) {
                    shoppingListData[ingredient] = adjustedAmount;
                } else {
                    const existingNum = parseFloat(shoppingListData[ingredient].match(/(\d+(?:\.\d+)?)/)?.[1] || 0);
                    const newNum = parseFloat(adjustedAmount.match(/(\d+(?:\.\d+)?)/)?.[1] || 0);
                    
                    if (existingNum && newNum) {
                        const unit = adjustedAmount.replace(/[\d.]+/, '').trim();
                        const total = existingNum + newNum;
                        shoppingListData[ingredient] = `${total}${unit}`;
                    } else {
                        shoppingListData[ingredient] += `, ${adjustedAmount}`;
                    }
                }
            }
        }

        function removeFromShoppingList(recipe) {
            rebuildShoppingList();
        }
        
        function rebuildShoppingList() {
            shoppingListData = {};
            currentWeekPlan.forEach((dayPlan, index) => {
                addToShoppingList(dayPlan.dinner, index);
                if (dayPlan.kidsLunch) {
                    addToShoppingList(dayPlan.kidsLunch, index);
                }
            });
        }

        function displayWeekOverview() {
            const container = document.getElementById('weekOverview');
            container.innerHTML = '';
            let totalCost = 0;
            
            currentWeekPlan.forEach((dayPlan, index) => {
                let dayCost = dayPlan.dinner.price;
                if (dayPlan.kidsLunch) {
                    dayCost += dayPlan.kidsLunch.price;
                }
                totalCost += dayCost;
                
                const dayDate = new Date(currentWeekStart);
                dayDate.setDate(currentWeekStart.getDate() + index);
                const dateStr = dayDate.toLocaleDateString('de-CH', { day: '2-digit', month: '2-digit' });
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (dayPlan.dinner.special === 'pizza-weekend') {
                    dayCard.className += ' pizza-day';
                } else if (dayPlan.isLeftoverDay) {
                    dayCard.className += ' with-leftover';
                }
                
                const portionInfo = dayPlan.isLeftoverDay ? 
                    `<div class="portion-info">üì¶ Mit Extra-Portion f√ºr n√§chsten Mittag (+25%)</div>` : 
                    `<div class="portion-info">üçΩÔ∏è Normale Portion (nur Abendessen)</div>`;
                
                dayCard.innerHTML = `
                    ${dayPlan.isLeftoverDay && dayPlan.dinner.special !== 'pizza-weekend' ? 
                        `<span class="leftover-badge">+25%</span>` : ''}
                    ${dayPlan.dinner.special !== 'pizza-weekend' ? 
                        `<button class="swap-btn" onclick="swapRecipe(${index}, 'dinner')" title="Rezept tauschen">üîÑ</button>` : ''}
                    <div class="day-header">
                        <span class="day-name">${dayPlan.day} <small style="color:#999;">${dateStr}</small></span>
                        <span class="price-tag">${dayCost} CHF</span>
                    </div>
                    <div class="meal-info">
                        <div class="meal-name">üçΩÔ∏è Abendessen: ${dayPlan.dinner.name}</div>
                        <div class="meal-details">${dayPlan.dinner.category} ‚Ä¢ ${dayPlan.dinner.workTip}</div>
                        ${portionInfo}
                    </div>
                    ${dayPlan.kidsLunch ? `
                        <div class="meal-info" style="position:relative;">
                            <button class="swap-btn" onclick="swapRecipe(${index}, 'kidsLunch')" title="Kinder-Rezept tauschen" style="position:absolute; right:-5px; top:-5px; width:30px; height:30px; font-size:14px;">üîÑ</button>
                            <div class="meal-name">üë∂ Kinder-Mittag: ${dayPlan.kidsLunch.name}</div>
                            <div class="meal-details">Speziell f√ºr die Kleinen</div>
                        </div>
                    ` : ''}
                `;
                container.appendChild(dayCard);
            });
            
            document.getElementById('totalCost').textContent = totalCost.toFixed(2);
        }

        function displayShoppingList() {
            const container = document.getElementById('shoppingList');
            container.innerHTML = '';
            
            const categories = {
                'ü•© Fleisch & Gefl√ºgel': [],
                'ü•ï Gem√ºse & Obst': [],
                'üßÄ Milchprodukte': [],
                'üçù Nudeln, Reis & Beilagen': [],
                'ü•´ Konserven & Haltbares': [],
                'üßÇ Gew√ºrze & √ñle': []
            };
            
            for (const [ingredient, amount] of Object.entries(shoppingListData)) {
                const lower = ingredient.toLowerCase();
                
                if (lower.includes('fleisch') || lower.includes('h√§hnchen') || 
                    lower.includes('schwein') || lower.includes('rind') || 
                    lower.includes('hack') || lower.includes('schnitzel') ||
                    lower.includes('lamm') || lower.includes('kalb') ||
                    lower.includes('ente') || lower.includes('pute') ||
                    lower.includes('speck') || lower.includes('schinken') ||
                    lower.includes('w√ºrstchen') || lower.includes('salami')) {
                    categories['ü•© Fleisch & Gefl√ºgel'].push({ingredient, amount});
                } else if (lower.includes('milch') || lower.includes('k√§se') || 
                           lower.includes('sahne') || lower.includes('butter') ||
                           lower.includes('joghurt') || lower.includes('mozzarella') ||
                           lower.includes('ricotta') || lower.includes('feta') ||
                           lower.includes('emmentaler') || lower.includes('parmesan')) {
                    categories['üßÄ Milchprodukte'].push({ingredient, amount});
                } else if (lower.includes('nudel') || lower.includes('reis') || 
                           lower.includes('spaghetti') || lower.includes('penne') ||
                           lower.includes('kartoffel') || lower.includes('sp√§tzle') ||
                           lower.includes('gnocchi') || lower.includes('couscous') ||
                           lower.includes('lasagne') || lower.includes('tortellini')) {
                    categories['üçù Nudeln, Reis & Beilagen'].push({ingredient, amount});
                } else if (lower.includes('dose') || lower.includes('bohnen') ||
                           lower.includes('kichererbsen') || lower.includes('mais')) {
                    categories['ü•´ Konserven & Haltbares'].push({ingredient, amount});
                } else if (lower.includes('salz') || lower.includes('pfeffer') ||
                           lower.includes('√∂l') || lower.includes('gew√ºrz') ||
                           lower.includes('curry') || lower.includes('paprika')) {
                    categories['üßÇ Gew√ºrze & √ñle'].push({ingredient, amount});
                } else {
                    categories['ü•ï Gem√ºse & Obst'].push({ingredient, amount});
                }
            }
            
            for (const [category, items] of Object.entries(categories)) {
                if (items.length === 0) continue;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'shopping-category';
                categoryDiv.innerHTML = `<h3>${category}</h3>`;
                
                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'shopping-item';
                    itemDiv.innerHTML = `
                        <input type="checkbox">
                        <span>${item.ingredient}: ${item.amount}</span>
                    `;
                    categoryDiv.appendChild(itemDiv);
                });
                
                container.appendChild(categoryDiv);
            }
        }

        function displayRecipes() {
            const container = document.getElementById('recipesList');
            container.innerHTML = '';
            
            const totalPortions = calculateTotalPortionFactor();
            
            currentWeekPlan.forEach((dayPlan, index) => {
                const portionMultiplier = dayPlan.isLeftoverDay ? 1.25 : 1.0;
                const actualPortions = Math.round(totalPortions * portionMultiplier * 10) / 10;
                
                const recipeDiv = document.createElement('div');
                recipeDiv.className = 'recipe-details';
                recipeDiv.innerHTML = `
                    <h3>üçΩÔ∏è ${dayPlan.day} - ${dayPlan.dinner.name}</h3>
                    <div class="ingredients-list">
                        <h4>Zutaten (f√ºr ${actualPortions} Portionen):</h4>
                        <ul>
                            ${Object.entries(dayPlan.dinner.ingredients).map(([ing, amount]) => {
                                const adjustedAmount = calculateIngredientAmount(amount, index);
                                return `<li>${ing}: ${adjustedAmount}</li>`;
                            }).join('')}
                        </ul>
                    </div>
                    <div class="instructions">
                        <h4>Zubereitung:</h4>
                        <ol>
                            ${dayPlan.dinner.instructions.map(step => 
                                `<li>${step}</li>`
                            ).join('')}
                        </ol>
                    </div>
                    <div class="tips-box">
                        <h4>üí° Tipps:</h4>
                        <p><strong>F√ºr Kinder:</strong> ${dayPlan.dinner.childTip}</p>
                        <p><strong>F√ºrs B√ºro:</strong> ${dayPlan.dinner.workTip}</p>
                        ${dayPlan.isLeftoverDay ? 
                            `<p><strong>üì¶ Reste-Tipp:</strong> Extra Portion f√ºr morgen Mittag vorbereiten!</p>` : ''}
                    </div>
                `;
                container.appendChild(recipeDiv);
                
                if (dayPlan.kidsLunch) {
                    const kidsPortions = Object.entries(personPortions)
                        .filter(([key]) => key.startsWith('child'))
                        .reduce((sum, [_, value]) => sum + value, 0) || 1;
                    
                    const kidsDiv = document.createElement('div');
                    kidsDiv.className = 'recipe-details';
                    kidsDiv.innerHTML = `
                        <h3>üë∂ ${dayPlan.day} Mittag - ${dayPlan.kidsLunch.name}</h3>
                        <div class="ingredients-list">
                            <h4>Zutaten (f√ºr ${kidsPortions} Kinder-Portionen):</h4>
                            <ul>
                                ${Object.entries(dayPlan.kidsLunch.ingredients).map(([ing, amount]) => {
                                    const baseKidsPortions = 2;
                                    const factor = kidsPortions / baseKidsPortions;
                                    const numMatch = amount.match(/(\d+(?:\.\d+)?)/);
                                    if (numMatch) {
                                        const baseNum = parseFloat(numMatch[1]);
                                        const newNum = Math.round(baseNum * factor * 10) / 10;
                                        const adjustedAmount = amount.replace(numMatch[1], newNum.toString());
                                        return `<li>${ing}: ${adjustedAmount}</li>`;
                                    }
                                    return `<li>${ing}: ${amount}</li>`;
                                }).join('')}
                            </ul>
                        </div>
                        <div class="instructions">
                            <h4>Zubereitung:</h4>
                            <ol>
                                ${dayPlan.kidsLunch.instructions.map(step => 
                                    `<li>${step}</li>`
                                ).join('')}
                            </ol>
                        </div>
                        <div class="tips-box">
                            <h4>üí° Tipp:</h4>
                            <p>${dayPlan.kidsLunch.childTip}</p>
                        </div>
                    `;
                    container.appendChild(kidsDiv);
                }
            });
        }

        function importWeekPlan(data) {
            if (!data.weekPlan || !data.version) {
                throw new Error('Ung√ºltiges Datenformat');
            }
            
            currentWeekPlan = data.weekPlan;
            shoppingListData = data.shoppingList || {};
            
            if (data.preferences) {
                preferences = { ...preferences, ...data.preferences };
                if (data.weeksSincePizza !== undefined) {
                    weeksSincePizza = data.weeksSincePizza;
                }
            }
            
            if (data.personPortions) {
                personPortions = data.personPortions;
                updatePersonPortions();
            }
            
            if (data.weekStart) {
                currentWeekStart = new Date(data.weekStart);
                const weekEnd = new Date(currentWeekStart);
                weekEnd.setDate(currentWeekStart.getDate() + 6);
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                const startStr = currentWeekStart.toLocaleDateString('de-CH', options);
                const endStr = weekEnd.toLocaleDateString('de-CH', options);
                document.getElementById('weekDateDisplay').textContent = `Woche vom ${startStr} bis ${endStr}`;
            }
            
            updatePizzaCountdown();
            displayWeekOverview();
            displayShoppingList();
            displayRecipes();
            
            const hasPizza = currentWeekPlan.some(day => day.dinner.special === 'pizza-weekend');
            document.getElementById('pizzaIndicator').style.display = hasPizza ? 'block' : 'none';
        }

        async function autoSyncOnStartup() {
            const token = localStorage.getItem('githubToken');
            const gistId = localStorage.getItem('currentGistId');
            
            if (token && gistId) {
                const syncBar = document.getElementById('syncStatusBar');
                const syncText = document.getElementById('syncStatusText');
                
                syncBar.style.display = 'flex';
                syncText.textContent = 'üîÑ Synchronisiere mit GitHub...';
                
                try {
                    const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const gist = await response.json();
                        const content = gist.files['wochenplan.json'].content;
                        const data = JSON.parse(content);
                        
                        const gistDate = new Date(gist.updated_at);
                        const localDate = new Date(localStorage.getItem('lastSyncDate') || 0);
                        
                        if (gistDate > localDate) {
                            importWeekPlan(data);
                            localStorage.setItem('lastSyncDate', gist.updated_at);
                            
                            syncBar.classList.add('synced');
                            syncText.textContent = '‚úÖ Erfolgreich synchronisiert';
                            
                            setTimeout(() => {
                                syncBar.style.display = 'none';
                            }, 3000);
                        } else {
                            syncBar.classList.add('synced');
                            syncText.textContent = '‚úÖ Bereits aktuell';
                            
                            setTimeout(() => {
                                syncBar.style.display = 'none';
                            }, 2000);
                        }
                    }
                } catch (error) {
                    console.error('Auto-Sync Fehler:', error);
                    syncText.textContent = '‚ö†Ô∏è Sync fehlgeschlagen - Offline-Modus';
                    
                    setTimeout(() => {
                        syncBar.style.display = 'none';
                    }, 3000);
                }
            }
        }

        // Initialisierung beim Laden
        window.addEventListener('DOMContentLoaded', function() {
            loadRecipes();
            loadPreferences();
            loadSavedWeeks();
            updateRecipeStats();
            updatePersonPortions();
            calculateCurrentWeekDates();
            updatePizzaCountdown();
            generateNewPlan();
            autoSyncOnStartup();
        });

        window.onclick = function(event) {
            const githubModal = document.getElementById('githubModal');
            if (event.target === githubModal) {
                closeGitHubSync();
            }
        }
    </script>
</body>
</html>
