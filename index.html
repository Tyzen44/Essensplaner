<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è Familien-Wochenessensplaner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #764ba2;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .week-date {
            color: #764ba2;
            font-weight: bold;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .pizza-indicator {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .main-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(118,75,162,0.3);
        }

        .btn-secondary {
            background: white;
            color: #764ba2;
            border: 2px solid #764ba2;
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .btn-github {
            background: linear-gradient(135deg, #24292e 0%, #0366d6 100%);
            color: white;
        }

        .btn-github:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(3,102,214,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #f8f8f8;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .week-overview {
            display: grid;
            gap: 15px;
        }

        .day-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #764ba2;
            transition: all 0.3s;
            position: relative;
        }

        .day-card.pizza-day {
            background: linear-gradient(135deg, #fff5f5 0%, #ffeaa7 100%);
            border-left: 5px solid #ff6b6b;
        }
        
        .day-card .swap-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .day-card .swap-btn:hover {
            background: #764ba2;
            transform: rotate(180deg);
        }

        .day-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #764ba2;
        }

        .price-tag {
            background: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }

        .meal-info {
            margin: 10px 0;
        }

        .meal-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .meal-details {
            color: #666;
            font-size: 0.9em;
        }

        .portions-info {
            background: #e3f2fd;
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.9em;
            color: #1976D2;
        }

        .shopping-list {
            columns: 2;
            column-gap: 30px;
        }

        .shopping-category {
            break-inside: avoid;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .shopping-category h3 {
            color: #764ba2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shopping-item {
            display: flex;
            align-items: center;
            padding: 5px 0;
        }

        .shopping-item input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .recipe-details {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .recipe-details h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .ingredients-list {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .ingredients-list ul {
            list-style-type: none;
            padding-left: 0;
        }

        .ingredients-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .ingredients-list li:last-child {
            border-bottom: none;
        }

        .instructions {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 10px;
            line-height: 1.8;
        }

        .tips-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .tips-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-group {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
        }

        .setting-group h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 10px;
            color: #666;
        }

        .setting-group input[type="number"],
        .setting-group select,
        .setting-group input[type="password"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }

        .setting-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .portion-settings {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .portion-settings h4 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .person-portion {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 5px;
        }

        .person-portion label {
            flex: 1;
            margin: 0;
        }

        .person-portion input {
            width: 80px !important;
        }

        .filter-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .budget-display {
            font-size: 1.2em;
            color: #4CAF50;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: #f0fff4;
            border-radius: 10px;
            margin: 20px 0;
        }

        .stats-box {
            background: #e8f4f8;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-box h3 {
            color: #2196F3;
            margin-bottom: 10px;
        }

        .saved-weeks-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .saved-week-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .saved-week-info {
            flex: 1;
        }

        .saved-week-date {
            font-weight: bold;
            color: #764ba2;
            font-size: 1.1em;
        }

        .saved-week-summary {
            font-size: 0.95em;
            color: #666;
            margin-top: 5px;
        }

        .saved-week-actions {
            display: flex;
            gap: 8px;
        }

        .mini-btn {
            padding: 8px 15px;
            font-size: 0.95em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .mini-btn-load {
            background: #4CAF50;
            color: white;
        }

        .mini-btn-load:hover {
            background: #45a049;
            transform: translateY(-1px);
        }

        .mini-btn-delete {
            background: #f44336;
            color: white;
        }

        .mini-btn-delete:hover {
            background: #da190b;
            transform: translateY(-1px);
        }

        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 450px;
            display: none;
        }

        .confirm-dialog.active {
            display: block;
        }

        .confirm-dialog h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .confirm-dialog p {
            margin-bottom: 15px;
            color: #666;
            line-height: 1.5;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #764ba2;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #333;
        }

        .github-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .github-section h3 {
            color: #24292e;
            margin-bottom: 15px;
        }

        .github-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
        }

        .github-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .github-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .github-btn-primary {
            background: #24292e;
            color: white;
        }

        .github-btn-primary:hover {
            background: #0366d6;
            transform: translateY(-2px);
        }

        .github-btn-secondary {
            background: white;
            color: #24292e;
            border: 2px solid #24292e;
        }

        .github-btn-secondary:hover {
            background: #f6f8fa;
        }

        .status-message {
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            color: #4CAF50;
            background: #f0fff4;
        }

        .status-error {
            color: #f44336;
            background: #ffebee;
        }

        .status-info {
            color: #2196F3;
            background: #e3f2fd;
        }

        .gist-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
        }

        .gist-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s;
        }

        .gist-item:hover {
            background: #f6f8fa;
        }

        .gist-item:last-child {
            border-bottom: none;
        }

        .gist-title {
            font-weight: bold;
            color: #24292e;
        }

        .gist-date {
            font-size: 0.9em;
            color: #666;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #764ba2;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .sync-status {
            background: #e3f2fd;
            color: #1976D2;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
        }

        .sync-status.synced {
            background: #e8f5e9;
            color: #388E3C;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .shopping-list {
                columns: 1;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .filter-group {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            .btn, .tabs, .main-controls, .swap-btn {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
                box-shadow: none;
                border: 1px solid #ddd;
                margin-bottom: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Familien-Wochenessensplaner</h1>
            <p>Intelligente Wochenplanung mit individueller Portionsanpassung</p>
            <p>Budget: <span id="budgetDisplay">175 CHF</span> pro Woche (25 CHF/Tag)</p>
            <p class="week-date" id="weekDateDisplay">Woche vom ... bis ...</p>
            <div id="pizzaIndicator" style="display:none;">
                <span class="pizza-indicator">üçï Pizza-Wochenende! üçï</span>
            </div>
            <div id="syncStatusBar" class="sync-status" style="display: none;">
                <span id="syncStatusText">Synchronisiere...</span>
            </div>
        </div>

        <div class="stats-box">
            <h3>üìö Rezept-Datenbank</h3>
            <p><strong id="totalRecipes">0</strong> Rezepte verf√ºgbar | <strong id="meatCount">0</strong> Fleisch | <strong id="vegCount">0</strong> Vegetarisch | <strong id="kidsCount">0</strong> Kinder</p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                N√§chstes Pizza-Wochenende in <strong id="pizzaCountdown">...</strong> Woche(n)
            </p>
        </div>

        <div class="main-controls">
            <button class="btn btn-primary" onclick="confirmGenerateNewPlan()">
                üé≤ Neuen Plan generieren
            </button>
            <button class="btn btn-secondary" onclick="saveCurrentWeek()">
                üíæ Woche speichern
            </button>
            <button class="btn btn-secondary" onclick="showSavedWeeks()">
                üìÇ Gespeicherte Wochen
            </button>
            <button class="btn btn-secondary" onclick="exportToPDF()">
                üìÑ Als PDF exportieren
            </button>
            <button class="btn btn-github" onclick="showGitHubSync()">
                <svg style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;" fill="white" viewBox="0 0 16 16">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub Sync
            </button>
            <button class="btn btn-secondary" onclick="savePreferences()">
                ‚öôÔ∏è Einstellungen speichern
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(event, 'overview')">üìÖ Wochen√ºbersicht</button>
            <button class="tab" onclick="switchTab(event, 'shopping')">üõí Einkaufsliste</button>
            <button class="tab" onclick="switchTab(event, 'recipes')">üìñ Rezepte</button>
            <button class="tab" onclick="switchTab(event, 'settings')">‚öôÔ∏è Einstellungen</button>
        </div>

        <div id="overview" class="tab-content active">
            <div class="loading" id="loadingOverview">
                <div class="spinner"></div>
                <p>Generiere Wochenplan...</p>
            </div>
            <div class="week-overview" id="weekOverview"></div>
            <div class="budget-display">
                Gesamtkosten der Woche: <span id="totalCost">0</span> CHF
            </div>
        </div>

        <div id="shopping" class="tab-content">
            <h2>üõí Einkaufsliste</h2>
            <div class="shopping-list" id="shoppingList"></div>
        </div>

        <div id="recipes" class="tab-content">
            <h2>üìñ Detaillierte Rezepte</h2>
            <div id="recipesList"></div>
        </div>

        <div id="settings" class="tab-content">
            <h2>‚öôÔ∏è Einstellungen</h2>
            <div class="settings-grid">
                <div class="setting-group">
                    <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie</h3>
                    <label>
                        Anzahl Erwachsene:
                        <input type="number" id="adultsCount" value="2" min="1" max="6" onchange="updatePortionSettings()">
                    </label>
                    <label>
                        Anzahl Kinder:
                        <input type="number" id="childrenCount" value="2" min="0" max="6" onchange="updatePortionSettings()">
                    </label>
                    
                    <div class="portion-settings">
                        <h4>Individuelle Portionsgr√∂√üen</h4>
                        <div id="portionSettingsContainer"></div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3>üí∞ Budget</h3>
                    <label>
                        Tagesbudget (CHF):
                        <input type="number" id="dailyBudget" value="25" min="10" max="50" onchange="updateBudgetDisplay()">
                    </label>
                </div>
                
                <div class="setting-group">
                    <h3>ü•ó Ern√§hrung</h3>
                    <label>
                        Vegetarische Tage pro Woche:
                        <input type="number" id="vegDays" value="3" min="0" max="7">
                    </label>
                    <label>
                        Pizza-Wochenende alle:
                        <select id="pizzaFrequency">
                            <option value="2">2 Wochen</option>
                            <option value="3" selected>2-3 Wochen (Zufall)</option>
                            <option value="4">3-4 Wochen</option>
                            <option value="0">Nie</option>
                        </select>
                    </label>
                </div>

                <div class="setting-group">
                    <h3>üö´ Ausschl√ºsse - Fleisch</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="noLamb"> Kein Lamm
                        </label>
                        <label>
                            <input type="checkbox" id="noPork"> Kein Schwein
                        </label>
                        <label>
                            <input type="checkbox" id="noBeef"> Kein Rind
                        </label>
                        <label>
                            <input type="checkbox" id="noDuck"> Keine Ente
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>üßÄ Ausschl√ºsse - Milchprodukte</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="noCottageCheese"> Kein H√ºttenk√§se
                        </label>
                        <label>
                            <input type="checkbox" id="noGorgonzola"> Kein Gorgonzola
                        </label>
                        <label>
                            <input type="checkbox" id="noFeta"> Kein Feta
                        </label>
                        <label>
                            <input type="checkbox" id="noCheese"> Kein nicht-√ºberbackener K√§se
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>ü•ò Weitere Ausschl√ºsse</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="noFish"> Keine Fischgerichte
                        </label>
                        <label>
                            <input type="checkbox" id="noMushrooms"> Keine Pilze
                        </label>
                        <label>
                            <input type="checkbox" id="noNuts"> Keine N√ºsse
                        </label>
                        <label>
                            <input type="checkbox" id="noSpicy"> Nicht scharf
                        </label>
                        <label>
                            <input type="checkbox" id="noTofu"> Kein Tofu
                        </label>
                        <label>
                            <input type="checkbox" id="noEggplant"> Keine Aubergine
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>üîë GitHub Token</h3>
                    <label>
                        GitHub Personal Access Token:
                        <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                    </label>
                    <p style="font-size: 0.9em; color: #666; margin-top: 5px;">
                        F√ºr GitHub Sync. Token erstellen: 
                        <a href="https://github.com/settings/tokens/new" target="_blank" style="color: #0366d6;">
                            GitHub Settings ‚Üí Tokens
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHub Sync Modal -->
    <div id="githubModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîÑ GitHub Synchronisation</h2>
                <button class="close-modal" onclick="closeGitHubSync()">√ó</button>
            </div>
            
            <div class="github-section">
                <h3>üì§ Wochenplan auf GitHub speichern</h3>
                <p>Speichere deinen aktuellen Wochenplan als Gist auf GitHub:</p>
                <input type="text" class="github-input" id="gistName" placeholder="Name f√ºr den Gist (optional)">
                <div class="github-actions">
                    <button class="github-btn github-btn-primary" onclick="saveToGitHub()">
                        üì§ Als Gist speichern
                    </button>
                    <button class="github-btn github-btn-secondary" onclick="updateExistingGist()">
                        üîÑ Bestehenden Gist aktualisieren
                    </button>
                </div>
                <div id="saveStatus"></div>
            </div>
            
            <div class="github-section">
                <h3>üì• Wochenplan von GitHub laden</h3>
                <p>Lade einen gespeicherten Wochenplan von GitHub:</p>
                <button class="github-btn github-btn-primary" onclick="loadGists()">
                    üìã Meine Gists anzeigen
                </button>
                <div id="gistList" class="gist-list" style="display:none;"></div>
                
                <p style="margin-top: 15px;">Oder gib eine Gist-ID direkt ein:</p>
                <input type="text" class="github-input" id="gistId" placeholder="Gist ID oder URL">
                <button class="github-btn github-btn-secondary" onclick="loadFromGitHub()">
                    üì• Von Gist laden
                </button>
                <div id="loadStatus"></div>
            </div>

            <div class="github-section">
                <h3>‚ÑπÔ∏è Anleitung</h3>
                <ol style="color: #666; font-size: 0.95em; line-height: 1.8;">
                    <li>Erstelle einen GitHub Personal Access Token mit "gist" Berechtigung</li>
                    <li>F√ºge den Token in den Einstellungen ein</li>
                    <li>Speichere deine Wochenpl√§ne als private Gists</li>
                    <li>Teile Gist-URLs mit Familie/Freunden zum gemeinsamen Nutzen</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Erweiterte Rezept-Datenbank (alle Rezepte basieren auf 1 Person)
        let recipes = {};
        
        // Rezepte laden - Alle Mengen pro Person!
        function loadRecipes() {
            recipes = {
                meat: [
                    // Bestehende Rezepte (angepasst auf 1 Person)
                    {name:"Spaghetti Carbonara",category:"Fleisch",price:5,ingredients:{"Spaghetti":"125g","Speck/Pancetta":"50g","Eier":"1 St√ºck","Parmesan":"40g","Knoblauch":"0.5 Zehen","Schwarzer Pfeffer":"nach Geschmack"},instructions:["Wasser f√ºr Nudeln aufsetzen und salzen","Speck in kleine W√ºrfel schneiden und knusprig braten","Spaghetti al dente kochen","Eier mit Parmesan verquirlen","Nudeln zum Speck geben, vom Herd nehmen","Ei-K√§se-Mischung unterr√ºhren"],childTip:"F√ºr Kinder weniger Pfeffer verwenden",workTip:"L√§sst sich gut erw√§rmen"},
                    {name:"H√§hnchenbrust mit R√∂sti",category:"Fleisch",price:6,ingredients:{"H√§hnchenbrust":"150g","Kartoffeln":"200g","Gr√ºne Bohnen":"100g","Butter":"15g","Zwiebel":"0.25 St√ºck"},instructions:["Kartoffeln raspeln und ausdr√ºcken","H√§hnchen w√ºrzen und braten","R√∂sti goldbraun braten","Bohnen bissfest kochen","Alles zusammen anrichten"],childTip:"H√§hnchen in kleine St√ºcke schneiden",workTip:"R√∂sti werden beim Erw√§rmen wieder knusprig"},
                    {name:"Rindergulasch mit Sp√§tzle",category:"Fleisch",price:7,ingredients:{"Rindergulasch":"175g","Sp√§tzle":"125g","Zwiebeln":"0.75 gro√üe","Paprika":"0.5 St√ºck","Tomatenmark":"1 TL","Paprikapulver":"0.5 EL"},instructions:["Fleisch scharf anbraten","Zwiebeln und Paprika zugeben","Mit Fond abl√∂schen","1,5 Std k√∂cheln lassen","Sp√§tzle kochen","Mit Sp√§tzle servieren"],childTip:"Weniger Paprika f√ºr Kinder",workTip:"Wird beim Erw√§rmen noch besser"},
                    {name:"Schweinemedaillons mit Champignonsauce",category:"Fleisch",price:6.5,ingredients:{"Schweinefilet":"150g","Champignons":"100g","Sahne":"60ml","Kartoffeln":"250g","Brokkoli":"125g"},instructions:["Medaillons braten","Champignons anbraten","Mit Sahne abl√∂schen","Kartoffeln kochen","Brokkoli d√§mpfen","Zusammen servieren"],childTip:"Sauce separat servieren",workTip:"Fleisch und Sauce getrennt erw√§rmen"},
                    {name:"Hackfleisch-Kartoffel-Auflauf",category:"Fleisch",price:5,ingredients:{"Hackfleisch":"125g","Kartoffeln":"250g","Zwiebeln":"0.5 St√ºck","K√§se":"50g","Milch":"75ml"},instructions:["Kartoffeln in Scheiben schneiden","Hackfleisch anbraten","Schichten und √ºberbacken","45 Min bei 180¬∞C backen"],childTip:"Perfekt f√ºr Kinder",workTip:"Portionsweise einfrieren m√∂glich"},
                    
                    // Neue Rezepte (35 weitere)
                    {name:"H√§hnchen-Curry",category:"Fleisch",price:6,ingredients:{"H√§hnchenbrust":"150g","Kokosmilch":"100ml","Currypaste":"0.5 EL","Reis":"100g","Gem√ºse":"100g"},instructions:["H√§hnchen anbraten","Currypaste einr√ºhren","Mit Kokosmilch abl√∂schen","Gem√ºse zugeben","Mit Reis servieren"],childTip:"Sehr milde Currypaste verwenden",workTip:"Curry schmeckt aufgew√§rmt noch besser"},
                    {name:"Bolognese mit Penne",category:"Fleisch",price:5,ingredients:{"Rinderhack":"125g","Penne":"125g","Dosentomaten":"200g","Zwiebeln":"0.5 St√ºck","M√∂hren":"0.5 St√ºck"},instructions:["Gem√ºse w√ºrfeln und anschwitzen","Hackfleisch kr√ºmelig braten","Tomaten zugeben","2 Stunden k√∂cheln","Penne kochen","Mit Parmesan servieren"],childTip:"Gem√ºse sehr fein hacken",workTip:"Sauce einfrieren, Nudeln frisch"},
                    {name:"Gyros mit Tzatziki",category:"Fleisch",price:6.5,ingredients:{"Schweinefleisch":"175g","Pita":"1.5 St√ºck","Joghurt":"75g","Gurke":"0.25 St√ºck","Pommes":"125g"},instructions:["Fleisch marinieren und braten","Tzatziki zubereiten","Pommes backen","Pita erw√§rmen","Alles zusammen servieren"],childTip:"Weniger Knoblauch",workTip:"Komponenten getrennt transportieren"},
                    {name:"Chili con Carne",category:"Fleisch",price:5.5,ingredients:{"Rinderhack":"150g","Kidneybohnen":"0.5 Dose","Mais":"0.25 Dose","Paprika":"0.5 St√ºck","Reis":"100g"},instructions:["Hackfleisch anbraten","Gem√ºse zugeben","Bohnen und Mais einr√ºhren","1 Stunde k√∂cheln","Mit Reis servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Perfekt zum Einfrieren"},
                    {name:"Schnitzel mit Kartoffelsalat",category:"Fleisch",price:6,ingredients:{"Schnitzel":"150g","Paniermehl":"50g","Kartoffeln":"250g","Mayonnaise":"40g","Gurken":"1 kleine"},instructions:["Kartoffelsalat vorbereiten","Schnitzel panieren","Goldbraun braten","Zusammen servieren"],childTip:"Schnitzel in Streifen schneiden",workTip:"Kalt auch lecker"},
                    {name:"Lammkoteletts mit Rosmarinkartoffeln",category:"Fleisch",price:8,ingredients:{"Lammkoteletts":"150g","Kartoffeln":"200g","Rosmarin":"1 Zweig","Knoblauch":"1 Zehe","Gr√ºner Salat":"50g"},instructions:["Kartoffeln w√ºrfeln und w√ºrzen","Mit Rosmarin im Ofen backen","Lammkoteletts kurz braten","Mit Salat servieren"],childTip:"Fleisch sehr zart",workTip:"Kartoffeln aufw√§rmen"},
                    {name:"Rinderfilet mit gr√ºnem Spargel",category:"Fleisch",price:9,ingredients:{"Rinderfilet":"150g","Gr√ºner Spargel":"150g","Kartoffelp√ºree":"200g","Rotweinso√üe":"50ml"},instructions:["Filet scharf anbraten","Spargel blanchieren","Kartoffelp√ºree zubereiten","Mit Sauce servieren"],childTip:"Fleisch in Streifen",workTip:"Edel und lecker"},
                    {name:"Pulled Pork Burger",category:"Fleisch",price:7,ingredients:{"Schweineschulter":"200g","Burgerbr√∂tchen":"1 St√ºck","Coleslaw":"50g","BBQ-Sauce":"30ml"},instructions:["Fleisch 4 Std schmoren","Fleisch zupfen","Mit Sauce mischen","Im Br√∂tchen servieren"],childTip:"Weniger BBQ-Sauce",workTip:"Fleisch einfrieren"},
                    {name:"Entenbrust mit Rotkohl",category:"Fleisch",price:8,ingredients:{"Entenbrust":"150g","Rotkohl":"150g","Kl√∂√üe":"2 St√ºck","Preiselbeeren":"30g"},instructions:["Entenbrust einschneiden","Langsam braten","Rotkohl schmoren","Mit Kl√∂√üen servieren"],childTip:"Haut knusprig machen",workTip:"Festtagsessen"},
                    {name:"Kalbsschnitzel Wiener Art",category:"Fleisch",price:8,ingredients:{"Kalbsschnitzel":"150g","Semmelbr√∂sel":"50g","Zitrone":"0.25 St√ºck","Petersilienkartoffeln":"200g"},instructions:["Schnitzel klopfen","Panieren und braten","Kartoffeln kochen","Mit Zitrone servieren"],childTip:"D√ºnn klopfen",workTip:"Klassiker"},
                    {name:"H√§hnchen-Sat√©-Spie√üe",category:"Fleisch",price:6,ingredients:{"H√§hnchenbrust":"150g","Erdnusssauce":"50ml","Reis":"100g","Gurkensalat":"50g"},instructions:["H√§hnchen marinieren","Auf Spie√üe stecken","Grillen oder braten","Mit Sauce servieren"],childTip:"Mild w√ºrzen",workTip:"Party-Hit"},
                    {name:"Rinderrouladen",category:"Fleisch",price:7,ingredients:{"Rinderschnitzel":"150g","Speck":"20g","Gew√ºrzgurken":"1 St√ºck","Senf":"1 TL","Rotkohl":"100g"},instructions:["Rouladen f√ºllen","Mit Zahnstochern fixieren","Anbraten und schmoren","Mit Rotkohl servieren"],childTip:"Traditionell gut",workTip:"Sonntags-Klassiker"},
                    {name:"Putenschnitzel Hawaii",category:"Fleisch",price:6,ingredients:{"Putenschnitzel":"150g","Ananas":"1 Scheibe","K√§se":"30g","Reis":"100g"},instructions:["Schnitzel braten","Mit Ananas belegen","K√§se drauf, √ºberbacken","Mit Reis servieren"],childTip:"Kinder lieben es",workTip:"Retro-Klassiker"},
                    {name:"Hackbraten mit Kartoffelbrei",category:"Fleisch",price:5,ingredients:{"Hackfleisch gemischt":"150g","Ei":"0.25 St√ºck","Zwiebel":"0.5 St√ºck","Kartoffeln":"250g"},instructions:["Hackbraten formen","Im Ofen backen","Kartoffelbrei zubereiten","Zusammen servieren"],childTip:"Mit Ketchup",workTip:"Comfort Food"},
                    {name:"Lammcurry",category:"Fleisch",price:7,ingredients:{"Lammfleisch":"150g","Joghurt":"50ml","Curry-Gew√ºrze":"1 EL","Naan-Brot":"1 St√ºck"},instructions:["Lamm marinieren","Langsam schmoren","Gew√ºrze r√∂sten","Mit Naan servieren"],childTip:"Sehr mild",workTip:"Exotisch lecker"},
                    {name:"H√§hnchenschenkel mit Ofengem√ºse",category:"Fleisch",price:5,ingredients:{"H√§hnchenschenkel":"1 St√ºck","Kartoffeln":"150g","Paprika":"0.5 St√ºck","Zucchini":"0.5 St√ºck"},instructions:["Alles w√ºrzen","Auf Blech verteilen","45 Min backen","Hei√ü servieren"],childTip:"Einfach und gut",workTip:"Alles aus einem Topf"},
                    {name:"Schweinebraten mit Kn√∂deln",category:"Fleisch",price:6,ingredients:{"Schweinebraten":"150g","Kn√∂del":"2 St√ºck","Sauerkraut":"100g","Dunkle Sauce":"50ml"},instructions:["Braten w√ºrzen","2 Std im Ofen","Kn√∂del kochen","Mit Kraut servieren"],childTip:"Bayrischer Klassiker",workTip:"Deftig gut"},
                    {name:"Rindfleisch-Tacos",category:"Fleisch",price:6,ingredients:{"Rinderhack":"125g","Taco-Shells":"2 St√ºck","Salat":"30g","K√§se":"30g","Salsa":"30ml"},instructions:["Hackfleisch w√ºrzig braten","Tacos erw√§rmen","F√ºllen und garnieren","Sofort servieren"],childTip:"Spa√ü beim Essen",workTip:"Mexikanisch"},
                    {name:"Putenbrust mit Pilzrahm",category:"Fleisch",price:6,ingredients:{"Putenbrust":"150g","Mischpilze":"100g","Sahne":"50ml","Nudeln":"125g"},instructions:["Pute in Streifen","Pilze anbraten","Sahnesauce machen","Mit Nudeln servieren"],childTip:"Cremig mild",workTip:"Herbstgericht"},
                    {name:"K√∂nigsberger Klopse",category:"Fleisch",price:5,ingredients:{"Hackfleisch":"125g","Kapern":"1 EL","Wei√üe Sauce":"100ml","Kartoffeln":"200g"},instructions:["Klopse formen","In Br√ºhe kochen","Sauce zubereiten","Mit Kartoffeln servieren"],childTip:"Tradition pur",workTip:"Norddeutscher Klassiker"},
                    {name:"H√§hnchen-Fajitas",category:"Fleisch",price:6,ingredients:{"H√§hnchenbrust":"150g","Tortilla":"2 St√ºck","Paprika":"0.5 St√ºck","Zwiebel":"0.5 St√ºck"},instructions:["H√§hnchen in Streifen","Mit Gem√ºse braten","In Tortillas f√ºllen","Mit Toppings servieren"],childTip:"Interaktives Essen",workTip:"Tex-Mex"},
                    {name:"Lammkeule mit Bohnen",category:"Fleisch",price:8,ingredients:{"Lammkeule":"150g","Wei√üe Bohnen":"100g","Tomaten":"100g","Rosmarin":"1 Zweig"},instructions:["Lamm anbraten","Mit Bohnen schmoren","Tomaten zugeben","Langsam garen"],childTip:"Mediterraner Genuss",workTip:"Festessen"},
                    {name:"Wiener W√ºrstchen mit Linseneintopf",category:"Fleisch",price:4,ingredients:{"Wiener W√ºrstchen":"2 St√ºck","Linsen":"100g","Suppengem√ºse":"50g","Speck":"20g"},instructions:["Linsen kochen","Gem√ºse d√ºnsten","W√ºrstchen erw√§rmen","Zusammen servieren"],childTip:"W√§rmt von innen",workTip:"Deftiger Eintopf"},
                    {name:"Cordon Bleu",category:"Fleisch",price:7,ingredients:{"Kalbsschnitzel":"150g","Schinken":"30g","K√§se":"30g","Pommes":"150g"},instructions:["Schnitzel f√ºllen","Panieren","Goldbraun braten","Mit Pommes servieren"],childTip:"K√§se schmilzt sch√∂n",workTip:"Restaurant-Klassiker"},
                    {name:"Rindersteak mit Kr√§uterbutter",category:"Fleisch",price:8,ingredients:{"Rindersteak":"150g","Kr√§uterbutter":"30g","Ofenkartoffel":"1 gro√üe","Blattsalat":"50g"},instructions:["Steak auf Punkt braten","Kr√§uterbutter zubereiten","Kartoffel backen","Mit Salat servieren"],childTip:"Medium f√ºr Kinder",workTip:"Steakhouse-Feeling"},
                    {name:"H√§hnchen Teriyaki",category:"Fleisch",price:6,ingredients:{"H√§hnchenbrust":"150g","Teriyaki-Sauce":"40ml","Reis":"100g","Brokkoli":"100g"},instructions:["H√§hnchen marinieren","In Sauce braten","Reis kochen","Mit Brokkoli servieren"],childTip:"S√º√ü-salzig lecker",workTip:"Japanisch inspiriert"},
                    {name:"Schweinefilet im Speckmantel",category:"Fleisch",price:7,ingredients:{"Schweinefilet":"150g","Bacon":"40g","Gr√ºne Bohnen":"100g","Kartoffelgratin":"150g"},instructions:["Filet mit Speck umwickeln","Im Ofen garen","Bohnen blanchieren","Mit Gratin servieren"],childTip:"Saftig und zart",workTip:"Sonntagsbraten"},
                    {name:"Gulaschsuppe",category:"Fleisch",price:5,ingredients:{"Rindergulasch":"100g","Kartoffeln":"100g","Paprika":"0.5 St√ºck","Brot":"2 Scheiben"},instructions:["Fleisch anbraten","Gem√ºse zugeben","Als Suppe kochen","Mit Brot servieren"],childTip:"W√§rmende Suppe",workTip:"Eintopf-Klassiker"},
                    {name:"H√§hnchen-Nuggets selbstgemacht",category:"Fleisch",price:5,ingredients:{"H√§hnchenbrust":"150g","Cornflakes":"40g","Ei":"0.5 St√ºck","S√º√ükartoffelpommes":"150g"},instructions:["H√§hnchen w√ºrfeln","In Cornflakes wenden","Im Ofen backen","Mit Pommes servieren"],childTip:"Kinder-Favorit",workTip:"Ges√ºnder als gekauft"},
                    {name:"Rindergeschnetzeltes Stroganoff",category:"Fleisch",price:7,ingredients:{"Rinderfilet":"150g","Champignons":"75g","Saure Sahne":"50ml","Reis":"100g"},instructions:["Fleisch in Streifen","Kurz anbraten","Sauce zubereiten","Mit Reis servieren"],childTip:"Cremig mild",workTip:"Russischer Klassiker"},
                    {name:"Bratwurst mit Sauerkraut",category:"Fleisch",price:4,ingredients:{"Bratwurst":"150g","Sauerkraut":"150g","Kartoffelp√ºree":"200g","Senf":"1 EL"},instructions:["Bratwurst braten","Sauerkraut erw√§rmen","P√ºree zubereiten","Mit Senf servieren"],childTip:"Deutscher Klassiker",workTip:"Deftig gut"},
                    {name:"Putenschnitzel J√§ger Art",category:"Fleisch",price:6,ingredients:{"Putenschnitzel":"150g","Champignons":"100g","J√§gersauce":"75ml","Sp√§tzle":"125g"},instructions:["Schnitzel braten","Pilzsauce kochen","Sp√§tzle zubereiten","Zusammen servieren"],childTip:"Waldpilz-Geschmack",workTip:"Traditionell"},
                    {name:"Lammspie√üe griechisch",category:"Fleisch",price:7,ingredients:{"Lammfleisch":"150g","Tzatziki":"50g","Fladenbrot":"1 St√ºck","Griechischer Salat":"100g"},instructions:["Lamm marinieren","Auf Spie√üe stecken","Grillen","Mit Beilagen servieren"],childTip:"Mediterraner Genuss",workTip:"Urlaubsfeeling"},
                    {name:"H√§hnchen-Wraps",category:"Fleisch",price:5,ingredients:{"H√§hnchenbrust":"125g","Wrap":"1 gro√üer","Salat":"30g","Joghurt-Dressing":"30ml"},instructions:["H√§hnchen braten","Wrap f√ºllen","Einrollen","Kalt oder warm servieren"],childTip:"Praktisch zum Essen",workTip:"Ideal zum Mitnehmen"},
                    {name:"Kalbsleber Berliner Art",category:"Fleisch",price:6,ingredients:{"Kalbsleber":"150g","√Ñpfel":"0.5 St√ºck","Zwiebeln":"0.5 St√ºck","Kartoffelp√ºree":"200g"},instructions:["Leber kurz braten","√Ñpfel und Zwiebeln r√∂sten","P√ºree zubereiten","Zusammen servieren"],childTip:"Eisenreich",workTip:"Traditionsgericht"}
                ],
                vegetarian: [
                    // Bestehende Rezepte (angepasst auf 1 Person)
                    {name:"Gem√ºse-Lasagne",category:"Vegetarisch",price:4,ingredients:{"Lasagneplatten":"60g","Zucchini":"0.5 St√ºck","Aubergine":"0.25 St√ºck","Tomaten":"200g","Mozzarella":"60g"},instructions:["Gem√ºse in Scheiben schneiden","Anbraten und w√ºrzen","Lasagne schichten","45 Min backen"],childTip:"Viel K√§se macht es lecker",workTip:"Perfekt zum Aufw√§rmen"},
                    {name:"K√§sesp√§tzle",category:"Vegetarisch",price:3.5,ingredients:{"Sp√§tzle":"150g","Emmentaler":"75g","Zwiebeln":"0.75 gro√üe","Butter":"15g","Salat":"0.25 Kopf"},instructions:["Sp√§tzle kochen","Zwiebeln r√∂sten","Mit K√§se schichten","√úberbacken","Mit Salat servieren"],childTip:"Kinder-Lieblingsgericht",workTip:"Mit Milch aufw√§rmen"},
                    {name:"Gem√ºse-Curry",category:"Vegetarisch",price:4,ingredients:{"Kichererbsen":"0.5 Dose","Kokosmilch":"100ml","Gem√ºse":"150g","Currypaste":"0.5 EL","Reis":"100g"},instructions:["Gem√ºse w√ºrfeln","Currypaste anr√∂sten","Gem√ºse zugeben","Mit Kokosmilch abl√∂schen","Mit Reis servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Wird aufgew√§rmt aromatischer"},
                    {name:"Pizza Margherita",category:"Vegetarisch",price:3,ingredients:{"Pizzateig":"125g","Tomatensauce":"50ml","Mozzarella":"60g","Basilikum":"0.25 Bund","Oliven√∂l":"1 TL"},instructions:["Teig ausrollen","Mit Sauce bestreichen","Mozzarella verteilen","15 Min bei 220¬∞C backen","Mit Basilikum garnieren"],childTip:"Der Klassiker",workTip:"Kalt als Pizza-Schnitte"},
                    {name:"Risotto mit Pilzen",category:"Vegetarisch",price:4.5,ingredients:{"Risottoreis":"100g","Pilze":"100g","Wei√üwein":"50ml","Parmesan":"40g","Br√ºhe":"375ml"},instructions:["Pilze anbraten","Reis anschwitzen","Nach und nach Br√ºhe zugeben","St√§ndig r√ºhren","Mit Parmesan verfeinern"],childTip:"Weniger Wei√üwein",workTip:"Mit Br√ºhe aufw√§rmen"},
                    
                    // Neue vegetarische Rezepte (25 weitere)
                    {name:"Spinat-Ricotta-Cannelloni",category:"Vegetarisch",price:4,ingredients:{"Cannelloni":"75g","Spinat":"100g","Ricotta":"60g","Tomatensauce":"100ml","Parmesan":"30g"},instructions:["Spinat blanchieren","Mit Ricotta mischen","Cannelloni f√ºllen","Mit Sauce √ºberbacken"],childTip:"Verstecktes Gem√ºse",workTip:"Vorbereiten und backen"},
                    {name:"Pad Thai vegetarisch",category:"Vegetarisch",price:4,ingredients:{"Reisnudeln":"100g","Tofu":"75g","Erdn√ºsse":"20g","Sojasprossen":"30g","Tamarinde":"1 EL"},instructions:["Nudeln einweichen","Tofu anbraten","Sauce mischen","Alles vermengen"],childTip:"Ohne Erdn√ºsse f√ºr Kinder",workTip:"Asiatisch lecker"},
                    {name:"Gnocchi mit Salbei-Butter",category:"Vegetarisch",price:3.5,ingredients:{"Gnocchi":"150g","Butter":"30g","Salbei":"8 Bl√§tter","Parmesan":"30g"},instructions:["Gnocchi kochen","Butter br√§unen","Salbei frittieren","Alles vermengen"],childTip:"Einfach und gut",workTip:"Schnelles Essen"},
                    {name:"Shakshuka",category:"Vegetarisch",price:3,ingredients:{"Tomaten":"200g","Eier":"2 St√ºck","Paprika":"0.5 St√ºck","Feta":"30g","Brot":"2 Scheiben"},instructions:["Gem√ºse schmoren","Mulden formen","Eier einschlagen","Zugedeckt garen"],childTip:"Fr√ºhst√ºck mal anders",workTip:"Orientalisch"},
                    {name:"Quinoa-Bowl",category:"Vegetarisch",price:4.5,ingredients:{"Quinoa":"80g","Avocado":"0.5 St√ºck","Kichererbsen":"50g","Tahini":"1 EL","Gem√ºse":"100g"},instructions:["Quinoa kochen","Gem√ºse r√∂sten","Bowl arrangieren","Mit Tahini toppen"],childTip:"Superfood",workTip:"Gesund und s√§ttigend"},
                    {name:"Moussaka vegetarisch",category:"Vegetarisch",price:4,ingredients:{"Aubergine":"0.5 St√ºck","Kartoffeln":"150g","Linsen":"50g","B√©chamel":"100ml","K√§se":"30g"},instructions:["Schichten vorbereiten","Linsen kochen","Alles schichten","Im Ofen backen"],childTip:"Griechischer Auflauf",workTip:"Macht satt"},
                    {name:"Falafel mit Hummus",category:"Vegetarisch",price:3.5,ingredients:{"Kichererbsen":"100g","Petersilie":"0.25 Bund","Hummus":"50g","Pita":"1 St√ºck"},instructions:["Kichererbsen p√ºrieren","B√§llchen formen","Frittieren","Mit Hummus servieren"],childTip:"Knusprig au√üen",workTip:"Orientalisch"},
                    {name:"Ravioli mit Tomatensauce",category:"Vegetarisch",price:3.5,ingredients:{"Ravioli":"125g","Tomatensauce":"100ml","Basilikum":"5 Bl√§tter","Parmesan":"30g"},instructions:["Ravioli kochen","Sauce erhitzen","Zusammen servieren","Mit K√§se bestreuen"],childTip:"Pasta-Klassiker",workTip:"Schnell gemacht"},
                    {name:"Buddha Bowl",category:"Vegetarisch",price:4,ingredients:{"S√º√ükartoffel":"100g","Brokkoli":"75g","Quinoa":"60g","Tahini-Dressing":"30ml"},instructions:["Gem√ºse r√∂sten","Quinoa kochen","Bowl arrangieren","Dressing dar√ºber"],childTip:"Bunt und gesund",workTip:"Instagram-w√ºrdig"},
                    {name:"Caprese-Auflauf",category:"Vegetarisch",price:4,ingredients:{"Tomaten":"150g","Mozzarella":"75g","Basilikum":"0.25 Bund","Ciabatta":"2 Scheiben"},instructions:["Tomaten schichten","Mozzarella dazu","√úberbacken","Mit Brot servieren"],childTip:"Italien pur",workTip:"Sommerlich leicht"},
                    {name:"Pilz-Stroganoff",category:"Vegetarisch",price:3.5,ingredients:{"Champignons":"150g","Saure Sahne":"50ml","Reis":"100g","Petersilie":"1 EL"},instructions:["Pilze anbraten","Sauce zubereiten","Reis kochen","Zusammen servieren"],childTip:"Cremig mild",workTip:"Comfort Food"},
                    {name:"Zucchini-Puffer",category:"Vegetarisch",price:3,ingredients:{"Zucchini":"200g","Ei":"1 St√ºck","Mehl":"30g","Joghurt-Dip":"50g"},instructions:["Zucchini raspeln","Teig machen","Puffer braten","Mit Dip servieren"],childTip:"Gem√ºse versteckt",workTip:"Leicht und lecker"},
                    {name:"Tortellini in Sahnesauce",category:"Vegetarisch",price:4,ingredients:{"Tortellini":"125g","Sahne":"75ml","Erbsen":"50g","Parmesan":"30g"},instructions:["Tortellini kochen","Sahnesauce machen","Erbsen zugeben","Mit K√§se servieren"],childTip:"Cremig gut",workTip:"Kinder-Hit"},
                    {name:"Ratatouille",category:"Vegetarisch",price:3.5,ingredients:{"Zucchini":"0.5 St√ºck","Aubergine":"0.25 St√ºck","Paprika":"0.5 St√ºck","Tomaten":"100g","Baguette":"3 Scheiben"},instructions:["Gem√ºse schneiden","Schichten legen","Im Ofen garen","Mit Brot servieren"],childTip:"Franz√∂sisch",workTip:"Gesund"},
                    {name:"Spinat-Gorgonzola-Pasta",category:"Vegetarisch",price:4,ingredients:{"Pasta":"125g","Spinat":"75g","Gorgonzola":"40g","Waln√ºsse":"20g"},instructions:["Pasta kochen","Spinat d√ºnsten","Sauce machen","Alles mischen"],childTip:"F√ºr K√§se-Fans",workTip:"Schnell fertig"},
                    {name:"Gem√ºse-Tempura",category:"Vegetarisch",price:3.5,ingredients:{"Gem√ºse gemischt":"150g","Tempurateig":"50g","Sojasauce":"20ml","Reis":"100g"},instructions:["Teig anr√ºhren","Gem√ºse eintauchen","Frittieren","Mit Reis servieren"],childTip:"Knusprig",workTip:"Japanisch"},
                    {name:"K√ºrbis-Risotto",category:"Vegetarisch",price:4,ingredients:{"K√ºrbis":"150g","Risottoreis":"100g","Wei√üwein":"50ml","Parmesan":"30g"},instructions:["K√ºrbis w√ºrfeln","Risotto kochen","K√ºrbis einr√ºhren","Mit K√§se servieren"],childTip:"Herbstlich",workTip:"Orange und lecker"},
                    {name:"Halloumi-Burger",category:"Vegetarisch",price:4.5,ingredients:{"Halloumi":"100g","Burgerbr√∂tchen":"1 St√ºck","Hummus":"30g","Salat":"30g"},instructions:["Halloumi grillen","Br√∂tchen toasten","Burger bauen","Sofort servieren"],childTip:"Quietschk√§se",workTip:"Vegetarischer Burger"},
                    {name:"Penne all'Arrabbiata",category:"Vegetarisch",price:3,ingredients:{"Penne":"125g","Tomaten":"150g","Chili":"0.5 St√ºck","Knoblauch":"1 Zehe"},instructions:["Sauce kochen","Scharf w√ºrzen","Penne kochen","Zusammen servieren"],childTip:"Ohne Chili f√ºr Kinder",workTip:"Feurig"},
                    {name:"B√§rlauch-Sp√§tzle",category:"Vegetarisch",price:3.5,ingredients:{"Sp√§tzle":"150g","B√§rlauch":"30g","Sahne":"50ml","Parmesan":"30g"},instructions:["Sp√§tzle kochen","B√§rlauch hacken","Sauce machen","Alles mischen"],childTip:"Fr√ºhlingsgericht",workTip:"Saisonal"},
                    {name:"Linsen-Dal",category:"Vegetarisch",price:3,ingredients:{"Rote Linsen":"100g","Kokosmilch":"75ml","Curry-Gew√ºrze":"1 EL","Naan":"1 St√ºck"},instructions:["Linsen kochen","Gew√ºrze r√∂sten","Cremig r√ºhren","Mit Naan servieren"],childTip:"Indisch mild",workTip:"Proteinreich"},
                    {name:"Gnocchi-Auflauf",category:"Vegetarisch",price:3.5,ingredients:{"Gnocchi":"150g","Tomatensauce":"100ml","Mozzarella":"60g","Basilikum":"5 Bl√§tter"},instructions:["Gnocchi anbraten","Mit Sauce mischen","K√§se drauf","√úberbacken"],childTip:"K√§se zieht F√§den",workTip:"Ofengericht"},
                    {name:"S√º√ükartoffel-Curry",category:"Vegetarisch",price:3.5,ingredients:{"S√º√ükartoffel":"150g","Kokosmilch":"100ml","Spinat":"50g","Reis":"100g"},instructions:["Kartoffeln w√ºrfeln","Curry kochen","Spinat zugeben","Mit Reis servieren"],childTip:"S√º√ü und mild",workTip:"Vegan m√∂glich"},
                    {name:"Pilz-Quiche",category:"Vegetarisch",price:4,ingredients:{"M√ºrbeteig":"100g","Champignons":"100g","Eier":"1 St√ºck","Sahne":"50ml","K√§se":"30g"},instructions:["Teig ausrollen","Pilze and√ºnsten","Guss machen","Backen"],childTip:"Franz√∂sisch",workTip:"Auch kalt gut"},
                    {name:"Tomaten-Mozzarella-Tarte",category:"Vegetarisch",price:4,ingredients:{"Bl√§tterteig":"100g","Tomaten":"150g","Mozzarella":"75g","Pesto":"20g"},instructions:["Teig ausrollen","Belegen","Backen","Hei√ü servieren"],childTip:"Sommerlich",workTip:"Party-Hit"},
                    {name:"Gem√ºse-Couscous",category:"Vegetarisch",price:3,ingredients:{"Couscous":"100g","Gem√ºse":"150g","Rosinen":"20g","Minze":"5 Bl√§tter"},instructions:["Couscous quellen","Gem√ºse r√∂sten","Alles mischen","Lauwarm servieren"],childTip:"Orientalisch",workTip:"Salat-Alternative"},
                    {name:"Kartoffel-Lauch-Gratin",category:"Vegetarisch",price:3,ingredients:{"Kartoffeln":"200g","Lauch":"75g","Sahne":"75ml","K√§se":"40g"},instructions:["Schichten legen","Sahne dar√ºber","Mit K√§se bedecken","Goldbraun backen"],childTip:"Schmelzender K√§se",workTip:"Beilage oder Hauptgang"},
                    {name:"Tagliatelle mit Zitronen-Butter",category:"Vegetarisch",price:3,ingredients:{"Tagliatelle":"125g","Butter":"30g","Zitrone":"0.5 St√ºck","Parmesan":"30g"},instructions:["Pasta kochen","Butter schmelzen","Zitrone zugeben","Mit K√§se servieren"],childTip:"Frisch und leicht",workTip:"Sommerlich"},
                    {name:"Auberginen-Parmigiana",category:"Vegetarisch",price:4,ingredients:{"Aubergine":"0.5 St√ºck","Tomatensauce":"100ml","Mozzarella":"60g","Parmesan":"30g"},instructions:["Auberginen braten","Schichten legen","K√§se dar√ºber","√úberbacken"],childTip:"Italienischer Auflauf",workTip:"Vorbereiten m√∂glich"},
                    {name:"Brokkoli-K√§se-Suppe",category:"Vegetarisch",price:3,ingredients:{"Brokkoli":"150g","Cheddar":"50g","Sahne":"50ml","Brot":"2 Scheiben"},instructions:["Brokkoli kochen","P√ºrieren","K√§se einr√ºhren","Mit Brot servieren"],childTip:"Gr√ºn und cremig",workTip:"W√§rmend"}
                ],
                kids: [
                    // Bestehende Rezepte (angepasst auf 1 Kind)
                    {name:"Mini-Frikadellen",category:"Kinder",price:2,ingredients:{"Hackfleisch":"60g","Ei":"0.25 St√ºck","Semmelbr√∂sel":"1 EL","Kartoffelbrei":"125g"},instructions:["Hackfleisch mischen","Kleine Frikadellen formen","Braten","Mit Kartoffelbrei servieren"],childTip:"Sehr mild w√ºrzen",workTip:"Nur f√ºr Kinder"},
                    {name:"Pfannkuchen",category:"Kinder",price:1.5,ingredients:{"Mehl":"50g","Milch":"100ml","Eier":"0.75 St√ºck","Apfelmus":"100g"},instructions:["Teig anr√ºhren","D√ºnne Pfannkuchen backen","Mit Apfelmus servieren"],childTip:"Der Klassiker",workTip:"Nur f√ºr Kinder"},
                    {name:"Nudeln mit Butter",category:"Kinder",price:1.5,ingredients:{"Nudeln":"50g","Butter":"15g","Parmesan":"15g","Erbsen":"25g"},instructions:["Nudeln kochen","Mit Butter mischen","Parmesan dr√ºber"],childTip:"Einfach und beliebt",workTip:"Nur f√ºr Kinder"},
                    {name:"Pizza-Schnecken",category:"Kinder",price:2,ingredients:{"Pizzateig":"0.25 Rolle","Tomatensauce":"40ml","Salami":"25g","K√§se":"40g"},instructions:["Teig belegen","Aufrollen","In Scheiben schneiden","20 Min backen"],childTip:"Mini-Pizzen",workTip:"Nur f√ºr Kinder"},
                    {name:"Chicken Nuggets",category:"Kinder",price:2.5,ingredients:{"H√§hnchen":"75g","Cornflakes":"25g","Ei":"0.25 St√ºck","Pommes":"100g"},instructions:["H√§hnchen schneiden","In Cornflakes wenden","Backen","Mit Pommes servieren"],childTip:"Ges√ºnder als gekaufte",workTip:"Nur f√ºr Kinder"},
                    
                    // Neue Kinder-Rezepte (15 weitere)
                    {name:"Spaghetti mit Tomatensauce",category:"Kinder",price:1.5,ingredients:{"Spaghetti":"50g","Tomatensauce":"75ml","Parmesan":"15g"},instructions:["Spaghetti kochen","Sauce erw√§rmen","Zusammen servieren"],childTip:"Kinder-Klassiker",workTip:"Nur f√ºr Kinder"},
                    {name:"Fischst√§bchen mit P√ºree",category:"Kinder",price:2,ingredients:{"Fischst√§bchen":"3 St√ºck","Kartoffelp√ºree":"125g","Erbsen":"30g"},instructions:["Fischst√§bchen backen","P√ºree zubereiten","Mit Erbsen servieren"],childTip:"Knusprig",workTip:"Nur f√ºr Kinder"},
                    {name:"W√ºrstchen im Schlafrock",category:"Kinder",price:2,ingredients:{"Wiener":"2 kleine","Bl√§tterteig":"50g","Ketchup":"20ml"},instructions:["W√ºrstchen einwickeln","Goldbraun backen","Mit Ketchup servieren"],childTip:"Party-Hit",workTip:"Nur f√ºr Kinder"},
                    {name:"K√§se-Sandwich",category:"Kinder",price:1.5,ingredients:{"Toast":"2 Scheiben","K√§se":"30g","Butter":"10g","Gurke":"3 Scheiben"},instructions:["Toast buttern","K√§se drauf","Toasten","Warm servieren"],childTip:"Schnell gemacht",workTip:"Nur f√ºr Kinder"},
                    {name:"Mini-Hamburger",category:"Kinder",price:2.5,ingredients:{"Hackfleisch":"60g","Mini-Br√∂tchen":"1 St√ºck","K√§se":"15g","Ketchup":"15ml"},instructions:["Mini-Patty formen","Braten","Burger bauen","Servieren"],childTip:"Wie bei McDonald's",workTip:"Nur f√ºr Kinder"},
                    {name:"Eierkuchen mit Marmelade",category:"Kinder",price:1.5,ingredients:{"Mehl":"50g","Milch":"100ml","Ei":"0.75 St√ºck","Marmelade":"30g"},instructions:["Teig machen","D√ºnn backen","Mit Marmelade f√ºllen","Einrollen"],childTip:"S√º√ü und lecker",workTip:"Nur f√ºr Kinder"},
                    {name:"Kartoffelpuffer",category:"Kinder",price:1.5,ingredients:{"Kartoffeln":"150g","Ei":"0.25 St√ºck","Apfelmus":"50g"},instructions:["Kartoffeln reiben","Puffer formen","Goldbraun braten","Mit Apfelmus"],childTip:"Reibekuchen",workTip:"Nur f√ºr Kinder"},
                    {name:"Milchreis",category:"Kinder",price:1.5,ingredients:{"Milchreis":"40g","Milch":"150ml","Zucker":"1 TL","Zimt":"Prise"},instructions:["Reis kochen","S√º√üen","Mit Zimt bestreuen","Warm servieren"],childTip:"Comfort Food",workTip:"Nur f√ºr Kinder"},
                    {name:"Gem√ºse-Sticks mit Dip",category:"Kinder",price:1.5,ingredients:{"M√∂hren":"50g","Gurke":"50g","Paprika":"50g","Frischk√§se-Dip":"40g"},instructions:["Gem√ºse schneiden","Dip anr√ºhren","Zusammen servieren"],childTip:"Gesunder Snack",workTip:"Nur f√ºr Kinder"},
                    {name:"Nudelauflauf",category:"Kinder",price:2,ingredients:{"Nudeln":"50g","Schinken":"30g","K√§se":"30g","Sahne":"40ml"},instructions:["Nudeln kochen","Alles mischen","√úberbacken","Hei√ü servieren"],childTip:"K√§se-Liebe",workTip:"Nur f√ºr Kinder"},
                    {name:"French Toast",category:"Kinder",price:1.5,ingredients:{"Toast":"2 Scheiben","Ei":"0.5 St√ºck","Milch":"30ml","Ahornsirup":"20ml"},instructions:["Toast in Ei-Milch","In Pfanne braten","Mit Sirup servieren"],childTip:"Amerikanisch",workTip:"Nur f√ºr Kinder"},
                    {name:"Tomatensuppe mit Reis",category:"Kinder",price:1.5,ingredients:{"Tomatensuppe":"150ml","Reis":"30g","Croutons":"20g"},instructions:["Suppe erw√§rmen","Reis kochen","Zusammen servieren"],childTip:"Klassiker",workTip:"Nur f√ºr Kinder"},
                    {name:"K√§sespie√üe",category:"Kinder",price:2,ingredients:{"K√§sew√ºrfel":"40g","Weintrauben":"30g","Salzstangen":"10 St√ºck"},instructions:["Alles aufspie√üen","H√ºbsch anrichten","Servieren"],childTip:"Fingerfood",workTip:"Nur f√ºr Kinder"},
                    {name:"Mini-Quiche",category:"Kinder",price:2,ingredients:{"M√ºrbeteig":"50g","Ei":"0.5 St√ºck","Schinken":"20g","K√§se":"20g"},instructions:["F√∂rmchen auslegen","F√ºllung machen","Backen","Warm servieren"],childTip:"Klein und fein",workTip:"Nur f√ºr Kinder"},
                    {name:"Grie√übrei",category:"Kinder",price:1.5,ingredients:{"Grie√ü":"30g","Milch":"150ml","Zucker":"1 TL","Beeren":"30g"},instructions:["Grie√ü einr√ºhren","Kochen","S√º√üen","Mit Beeren toppen"],childTip:"Wohlf√ºhlessen",workTip:"Nur f√ºr Kinder"},
                    {name:"Mozzarella-Sticks",category:"Kinder",price:2,ingredients:{"Mozzarella":"60g","Paniermehl":"30g","Ei":"0.25 St√ºck","Tomatensauce":"40ml"},instructions:["Mozzarella panieren","Frittieren","Mit Sauce servieren"],childTip:"K√§se-Sticks",workTip:"Nur f√ºr Kinder"},
                    {name:"Bananenpfannkuchen",category:"Kinder",price:1.5,ingredients:{"Banane":"0.5 St√ºck","Ei":"0.5 St√ºck","Mehl":"20g","Honig":"15ml"},instructions:["Banane zerdr√ºcken","Teig machen","Kleine Pfannkuchen backen","Mit Honig servieren"],childTip:"Gesund und s√º√ü",workTip:"Nur f√ºr Kinder"},
                    {name:"Tortellini mit Butter",category:"Kinder",price:2,ingredients:{"Tortellini":"60g","Butter":"15g","Parmesan":"15g"},instructions:["Tortellini kochen","Mit Butter schwenken","K√§se dr√ºber"],childTip:"Einfach gut",workTip:"Nur f√ºr Kinder"},
                    {name:"Gem√ºse-Muffins",category:"Kinder",price:1.5,ingredients:{"Mehl":"40g","Ei":"0.5 St√ºck","Zucchini":"30g","K√§se":"20g"},instructions:["Teig mischen","In F√∂rmchen f√ºllen","Backen","Warm servieren"],childTip:"Verstecktes Gem√ºse",workTip:"Nur f√ºr Kinder"},
                    {name:"Apfel-Zimt-Porridge",category:"Kinder",price:1.5,ingredients:{"Haferflocken":"30g","Milch":"100ml","Apfel":"0.5 St√ºck","Zimt":"Prise"},instructions:["Haferflocken kochen","Apfel reiben","Einr√ºhren","Mit Zimt servieren"],childTip:"Gesundes Fr√ºhst√ºck",workTip:"Nur f√ºr Kinder"}
                ]
            };
        }

        // Globale Variablen
        let currentWeekPlan = [];
        let shoppingListData = {};
        let preferences = {};
        let weeksSincePizza = 0;
        let currentWeekStart = null;
        let savedWeeks = [];
        let currentGistId = null;
        let personPortions = [];

        // Initialisierung beim Laden
        window.addEventListener('DOMContentLoaded', function() {
            const requiredElements = ['githubModal', 'weekOverview', 'shoppingList', 'recipesList'];
            let allElementsFound = true;
            
            requiredElements.forEach(id => {
                if (!document.getElementById(id)) {
                    console.error(`Element mit ID '${id}' nicht gefunden!`);
                    allElementsFound = false;
                }
            });
            
            if (!allElementsFound) {
                console.warn('Einige Elemente fehlen - App k√∂nnte nicht vollst√§ndig funktionieren');
            }
            
            loadRecipes();
            loadPreferences();
            loadSavedWeeks();
            updateRecipeStats();
            calculateCurrentWeekDates();
            updatePizzaCountdown();
            
            // Stelle sicher, dass personPortions initialisiert wird wenn leer
            if (!personPortions || personPortions.length === 0) {
                const adultsCount = parseInt(document.getElementById('adultsCount').value) || 2;
                const childrenCount = parseInt(document.getElementById('childrenCount').value) || 2;
                
                personPortions = [];
                // Standard: 2 Erwachsene
                for (let i = 0; i < adultsCount; i++) {
                    personPortions.push({
                        type: 'adult',
                        name: `Erwachsener ${i + 1}`,
                        factor: i === 0 ? 1.2 : 0.8
                    });
                }
                // Standard: 2 Kinder
                for (let i = 0; i < childrenCount; i++) {
                    personPortions.push({
                        type: 'child',
                        name: `Kind ${i + 1}`,
                        factor: 0.5
                    });
                }
            }
            
            updatePortionSettings();
            generateNewPlan();
            
            autoSyncOnStartup();
        });

        // Portionseinstellungen aktualisieren
        function updatePortionSettings() {
            const adultsCount = parseInt(document.getElementById('adultsCount').value);
            const childrenCount = parseInt(document.getElementById('childrenCount').value);
            const container = document.getElementById('portionSettingsContainer');
            
            // Lade gespeicherte Portionen oder setze Defaults
            if (!personPortions.length || personPortions.length !== adultsCount + childrenCount) {
                personPortions = [];
                for (let i = 0; i < adultsCount; i++) {
                    personPortions.push({
                        type: 'adult',
                        name: `Erwachsener ${i + 1}`,
                        factor: i === 0 ? 1.2 : 0.8 // Default: erster Erwachsener 1.2, andere 0.8
                    });
                }
                for (let i = 0; i < childrenCount; i++) {
                    personPortions.push({
                        type: 'child',
                        name: `Kind ${i + 1}`,
                        factor: 0.5
                    });
                }
            }
            
            // UI erstellen
            let html = '';
            personPortions.forEach((person, index) => {
                html += `
                    <div class="person-portion">
                        <label>${person.name}:</label>
                        <input type="number" 
                               id="portion_${index}" 
                               value="${person.factor}" 
                               min="0.1" 
                               max="2.0" 
                               step="0.1"
                               onchange="updatePersonPortion(${index}, this.value)">
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateBudgetDisplay();
        }

        // Person-Portion aktualisieren
        function updatePersonPortion(index, value) {
            personPortions[index].factor = parseFloat(value);
            // Bei √Ñnderung die Einkaufsliste neu berechnen
            if (currentWeekPlan.length > 0) {
                rebuildShoppingList();
                displayShoppingList();
            }
        }

        // Berechne Portionen f√ºr einen Tag
        function calculateDayPortions(dayIndex) {
            const days = ['Freitag', 'Samstag', 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag'];
            const dayName = days[dayIndex];
            
            // Sonntag bis Donnerstag: Abendessen + 1 Portion f√ºrs Mittagessen am n√§chsten Tag
            // Freitag und Samstag: Nur Abendessen
            let totalFactor = 0;
            
            personPortions.forEach(person => {
                totalFactor += person.factor;
            });
            
            // F√ºge extra Portion f√ºr n√§chsten Tag hinzu (au√üer Freitag und Samstag)
            if (dayName !== 'Freitag' && dayName !== 'Samstag') {
                totalFactor += 1.0; // Eine zus√§tzliche normale Portion f√ºrs Mittagessen am n√§chsten Tag
            }
            
            return totalFactor;
        }

        // Mengen multiplizieren
        function multiplyIngredients(ingredients, factor) {
            const multiplied = {};
            for (const [ingredient, amount] of Object.entries(ingredients)) {
                // Parse die Menge und multipliziere sie
                const parsedAmount = parseIngredientAmount(amount);
                const multipliedAmount = multiplyAmount(parsedAmount, factor);
                multiplied[ingredient] = multipliedAmount;
            }
            return multiplied;
        }

        // Hilfsfunktion zum Parsen von Mengenangaben
        function parseIngredientAmount(amount) {
            // Einfache Implementierung - kann erweitert werden
            const match = amount.match(/^([\d.]+)\s*(.*)$/);
            if (match) {
                return {
                    value: parseFloat(match[1]),
                    unit: match[2]
                };
            }
            return { value: 1, unit: amount };
        }

        // Hilfsfunktion zum Multiplizieren von Mengen
        function multiplyAmount(parsed, factor) {
            if (parsed.unit === 'nach Geschmack' || parsed.unit.includes('optional')) {
                return parsed.unit;
            }
            
            const multiplied = parsed.value * factor;
            // Runde auf sinnvolle Werte
            let rounded;
            if (multiplied < 1) {
                rounded = Math.round(multiplied * 10) / 10; // Eine Nachkommastelle
            } else if (multiplied < 10) {
                rounded = Math.round(multiplied * 2) / 2; // Halbe Schritte
            } else {
                rounded = Math.round(multiplied / 5) * 5; // 5er Schritte
            }
            
            return `${rounded}${parsed.unit ? ' ' + parsed.unit : ''}`;
        }

        // Auto-Sync beim Start
        async function autoSyncOnStartup() {
            const token = localStorage.getItem('githubToken');
            const gistId = localStorage.getItem('currentGistId');
            
            if (token && gistId) {
                const syncBar = document.getElementById('syncStatusBar');
                const syncText = document.getElementById('syncStatusText');
                
                syncBar.style.display = 'flex';
                syncText.textContent = 'üîÑ Synchronisiere mit GitHub...';
                
                try {
                    const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const gist = await response.json();
                        const content = gist.files['wochenplan.json'].content;
                        const data = JSON.parse(content);
                        
                        const gistDate = new Date(gist.updated_at);
                        const localDate = new Date(localStorage.getItem('lastSyncDate') || 0);
                        
                        if (gistDate > localDate) {
                            importWeekPlan(data);
                            localStorage.setItem('lastSyncDate', gist.updated_at);
                            
                            syncBar.classList.add('synced');
                            syncText.textContent = '‚úÖ Erfolgreich synchronisiert';
                            
                            setTimeout(() => {
                                syncBar.style.display = 'none';
                            }, 3000);
                        } else {
                            syncBar.classList.add('synced');
                            syncText.textContent = '‚úÖ Bereits aktuell';
                            
                            setTimeout(() => {
                                syncBar.style.display = 'none';
                            }, 2000);
                        }
                    }
                } catch (error) {
                    console.error('Auto-Sync Fehler:', error);
                    syncText.textContent = '‚ö†Ô∏è Sync fehlgeschlagen - Offline-Modus';
                    
                    setTimeout(() => {
                        syncBar.style.display = 'none';
                    }, 3000);
                }
            }
        }

        // Rezept-Statistiken aktualisieren
        function updateRecipeStats() {
            const meatCount = recipes.meat ? recipes.meat.length : 0;
            const vegCount = recipes.vegetarian ? recipes.vegetarian.length : 0;
            const kidsCount = recipes.kids ? recipes.kids.length : 0;
            const total = meatCount + vegCount + kidsCount;
            
            document.getElementById('totalRecipes').textContent = total;
            document.getElementById('meatCount').textContent = meatCount;
            document.getElementById('vegCount').textContent = vegCount;
            document.getElementById('kidsCount').textContent = kidsCount;
        }

        // Pizza Countdown aktualisieren
        function updatePizzaCountdown() {
            const pizzaFreq = document.getElementById('pizzaFrequency').value;
            if (pizzaFreq === '0') {
                document.getElementById('pizzaCountdown').textContent = 'deaktiviert';
            } else if (pizzaFreq === '3') {
                const nextPizza = Math.max(1, 3 - weeksSincePizza);
                document.getElementById('pizzaCountdown').textContent = `${nextPizza}`;
            } else {
                const nextPizza = Math.max(1, parseInt(pizzaFreq) - weeksSincePizza);
                document.getElementById('pizzaCountdown').textContent = `${nextPizza}`;
            }
        }

        // Tab-Wechsel Funktion
        function switchTab(event, tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Wochendatum berechnen
        function calculateCurrentWeekDates() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            let daysToLastFriday = (dayOfWeek + 2) % 7;
            if (dayOfWeek >= 5 || dayOfWeek === 0) {
                daysToLastFriday = (dayOfWeek === 5) ? 0 : (dayOfWeek === 6) ? 1 : 2;
            }
            
            currentWeekStart = new Date(today);
            currentWeekStart.setDate(today.getDate() - daysToLastFriday);
            currentWeekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const startStr = currentWeekStart.toLocaleDateString('de-CH', options);
            const endStr = weekEnd.toLocaleDateString('de-CH', options);
            
            document.getElementById('weekDateDisplay').textContent = `Woche vom ${startStr} bis ${endStr}`;
        }

        // Pr√§ferenzen laden
        function loadPreferences() {
            const saved = localStorage.getItem('mealPlannerPrefs');
            if (saved) {
                preferences = JSON.parse(saved);
                
                if (preferences.dailyBudget) document.getElementById('dailyBudget').value = preferences.dailyBudget;
                if (preferences.vegDays !== undefined) document.getElementById('vegDays').value = preferences.vegDays;
                if (preferences.adultsCount) document.getElementById('adultsCount').value = preferences.adultsCount;
                if (preferences.childrenCount) document.getElementById('childrenCount').value = preferences.childrenCount;
                if (preferences.weeksSincePizza !== undefined) {
                    weeksSincePizza = preferences.weeksSincePizza;
                }
                if (preferences.pizzaFrequency !== undefined) document.getElementById('pizzaFrequency').value = preferences.pizzaFrequency;
                if (preferences.githubToken) document.getElementById('githubToken').value = preferences.githubToken;
                if (preferences.personPortions) personPortions = preferences.personPortions;
                
                // Lade Filtereinstellungen
                if (preferences.noLamb !== undefined) document.getElementById('noLamb').checked = preferences.noLamb;
                if (preferences.noPork !== undefined) document.getElementById('noPork').checked = preferences.noPork;
                if (preferences.noBeef !== undefined) document.getElementById('noBeef').checked = preferences.noBeef;
                if (preferences.noDuck !== undefined) document.getElementById('noDuck').checked = preferences.noDuck;
                if (preferences.noCottageCheese !== undefined) document.getElementById('noCottageCheese').checked = preferences.noCottageCheese;
                if (preferences.noGorgonzola !== undefined) document.getElementById('noGorgonzola').checked = preferences.noGorgonzola;
                if (preferences.noFeta !== undefined) document.getElementById('noFeta').checked = preferences.noFeta;
                if (preferences.noCheese !== undefined) document.getElementById('noCheese').checked = preferences.noCheese;
                if (preferences.noFish !== undefined) document.getElementById('noFish').checked = preferences.noFish;
                if (preferences.noMushrooms !== undefined) document.getElementById('noMushrooms').checked = preferences.noMushrooms;
                if (preferences.noNuts !== undefined) document.getElementById('noNuts').checked = preferences.noNuts;
                if (preferences.noSpicy !== undefined) document.getElementById('noSpicy').checked = preferences.noSpicy;
                if (preferences.noTofu !== undefined) document.getElementById('noTofu').checked = preferences.noTofu;
                if (preferences.noEggplant !== undefined) document.getElementById('noEggplant').checked = preferences.noEggplant;
            }
            
            const token = localStorage.getItem('githubToken');
            if (token) {
                document.getElementById('githubToken').value = token;
            }
            
            currentGistId = localStorage.getItem('currentGistId');
            
            updateBudgetDisplay();
        }

        // Gespeicherte Wochen laden
        function loadSavedWeeks() {
            const saved = localStorage.getItem('savedWeekPlans');
            if (saved) {
                savedWeeks = JSON.parse(saved);
            }
        }

        // Aktuelle Woche speichern
        function saveCurrentWeek() {
            if (currentWeekPlan.length === 0) {
                alert('‚ö† Kein Wochenplan zum Speichern vorhanden!');
                return;
            }
            
            const weekData = {
                id: Date.now(),
                weekStart: currentWeekStart.toISOString(),
                savedDate: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                totalCost: document.getElementById('totalCost').textContent,
                summary: getSummaryText(),
                personPortions: personPortions
            };
            
            if (savedWeeks.length >= 10) {
                if (confirm('‚ö†Ô∏è Es sind bereits 10 Wochen gespeichert. Die √§lteste Woche wird √ºberschrieben. Fortfahren?')) {
                    savedWeeks.shift();
                } else {
                    return;
                }
            }
            
            savedWeeks.push(weekData);
            localStorage.setItem('savedWeekPlans', JSON.stringify(savedWeeks));
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ Gespeichert!';
            btn.style.background = '#4CAF50';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }

        // Zusammenfassung erstellen
        function getSummaryText() {
            const meatCount = currentWeekPlan.filter(d => d.dinner.category === 'Fleisch').length;
            const vegCount = currentWeekPlan.filter(d => d.dinner.category === 'Vegetarisch').length;
            const pizzaCount = currentWeekPlan.filter(d => d.dinner.special === 'pizza-weekend').length;
            
            let summary = `${meatCount}x Fleisch, ${vegCount}x Vegetarisch`;
            if (pizzaCount > 0) {
                summary += `, ${pizzaCount}x Pizza`;
            }
            return summary;
        }

        // Gespeicherte Wochen anzeigen
        function showSavedWeeks() {
            if (savedWeeks.length === 0) {
                alert('üìÇ Keine gespeicherten Wochen vorhanden.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üìÇ Gespeicherte Wochen</h2>
                        <button class="close-modal" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="saved-weeks-list">
                        ${savedWeeks.map((week, index) => {
                            const weekStart = new Date(week.weekStart);
                            const weekEnd = new Date(weekStart);
                            weekEnd.setDate(weekStart.getDate() + 6);
                            const startStr = weekStart.toLocaleDateString('de-CH');
                            const endStr = weekEnd.toLocaleDateString('de-CH');
                            
                            return `
                                <div class="saved-week-item">
                                    <div class="saved-week-info">
                                        <div class="saved-week-date">${startStr} - ${endStr}</div>
                                        <div class="saved-week-summary">${week.summary} ‚Ä¢ ${week.totalCost} CHF</div>
                                    </div>
                                    <div class="saved-week-actions">
                                        <button class="mini-btn mini-btn-load" onclick="loadSavedWeek(${index})">Laden</button>
                                        <button class="mini-btn mini-btn-delete" onclick="deleteSavedWeek(${index})">üóëÔ∏è</button>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Gespeicherte Woche laden
        function loadSavedWeek(index) {
            const week = savedWeeks[index];
            
            if (currentWeekPlan.length > 0) {
                if (!confirm('‚ö†Ô∏è Der aktuelle Wochenplan wird √ºberschrieben. Fortfahren?')) {
                    return;
                }
            }
            
            currentWeekPlan = week.weekPlan;
            shoppingListData = week.shoppingList;
            currentWeekStart = new Date(week.weekStart);
            if (week.personPortions) {
                personPortions = week.personPortions;
                updatePortionSettings();
            }
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 6);
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const startStr = currentWeekStart.toLocaleDateString('de-CH', options);
            const endStr = weekEnd.toLocaleDateString('de-CH', options);
            document.getElementById('weekDateDisplay').textContent = `Woche vom ${startStr} bis ${endStr}`;
            
            displayWeekOverview();
            displayShoppingList();
            displayRecipes();
            
            document.querySelector('.modal').remove();
            
            alert('‚úÖ Wochenplan wurde geladen!');
        }

        // Gespeicherte Woche l√∂schen
        function deleteSavedWeek(index) {
            if (confirm('üóëÔ∏è Diese gespeicherte Woche wirklich l√∂schen?')) {
                savedWeeks.splice(index, 1);
                localStorage.setItem('savedWeekPlans', JSON.stringify(savedWeeks));
                
                document.querySelector('.modal').remove();
                showSavedWeeks();
            }
        }

        // Best√§tigung vor neuem Plan
        function confirmGenerateNewPlan() {
            if (currentWeekPlan.length > 0) {
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'confirm-dialog active';
                confirmDialog.innerHTML = `
                    <h3>‚ö†Ô∏è Neuen Plan generieren?</h3>
                    <p>Der aktuelle Wochenplan geht verloren, wenn er nicht gespeichert wurde.</p>
                    <p><strong>Tipp:</strong> Speichere den aktuellen Plan mit "Woche speichern" bevor du einen neuen generierst.</p>
                    <div class="confirm-actions">
                        <button class="btn btn-secondary" onclick="this.closest('.confirm-dialog').remove()">Abbrechen</button>
                        <button class="btn btn-primary" onclick="this.closest('.confirm-dialog').remove(); generateNewPlan();">Neuen Plan erstellen</button>
                    </div>
                `;
                document.body.appendChild(confirmDialog);
            } else {
                generateNewPlan();
            }
        }

        // Pr√§ferenzen speichern
        function savePreferences() {
            const githubToken = document.getElementById('githubToken').value;
            
            preferences = {
                dailyBudget: document.getElementById('dailyBudget').value,
                adultsCount: document.getElementById('adultsCount').value,
                childrenCount: document.getElementById('childrenCount').value,
                vegDays: document.getElementById('vegDays').value,
                pizzaFrequency: document.getElementById('pizzaFrequency').value,
                weeksSincePizza: weeksSincePizza,
                githubToken: githubToken,
                personPortions: personPortions,
                // Speichere alle Filter
                noLamb: document.getElementById('noLamb').checked,
                noPork: document.getElementById('noPork').checked,
                noBeef: document.getElementById('noBeef').checked,
                noDuck: document.getElementById('noDuck').checked,
                noCottageCheese: document.getElementById('noCottageCheese').checked,
                noGorgonzola: document.getElementById('noGorgonzola').checked,
                noFeta: document.getElementById('noFeta').checked,
                noCheese: document.getElementById('noCheese').checked,
                noFish: document.getElementById('noFish').checked,
                noMushrooms: document.getElementById('noMushrooms').checked,
                noNuts: document.getElementById('noNuts').checked,
                noSpicy: document.getElementById('noSpicy').checked,
                noTofu: document.getElementById('noTofu').checked,
                noEggplant: document.getElementById('noEggplant').checked
            };
            
            localStorage.setItem('mealPlannerPrefs', JSON.stringify(preferences));
            
            if (githubToken) {
                localStorage.setItem('githubToken', githubToken);
            }
            
            alert('‚úÖ Einstellungen wurden gespeichert!');
        }

        // Budget-Anzeige aktualisieren
        function updateBudgetDisplay() {
            const dailyBudget = document.getElementById('dailyBudget').value;
            const weeklyBudget = dailyBudget * 7;
            document.getElementById('budgetDisplay').textContent = `${weeklyBudget} CHF`;
        }

        // Hilfsfunktion: Array mischen
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Vegetarische Tage verteilen
        function distributeVegDays(totalDays, vegCount) {
            if (vegCount === 0) return [];
            if (vegCount >= totalDays) return Array.from({length: totalDays}, (_, i) => i);
            
            const positions = [];
            const spacing = Math.floor(totalDays / vegCount);
            
            for (let i = 0; i < vegCount; i++) {
                let pos = i * spacing + Math.floor(Math.random() * Math.max(1, spacing - 1));
                if (pos >= totalDays) pos = totalDays - 1;
                if (!positions.includes(pos)) {
                    positions.push(pos);
                }
            }
            
            return positions;
        }

        // Rezept filtern basierend auf Pr√§ferenzen
        function filterRecipe(recipe) {
            const prefs = preferences;
            const ingredients = Object.keys(recipe.ingredients).join(' ').toLowerCase();
            const name = recipe.name.toLowerCase();
            
            // Fleisch-Filter
            if (prefs.noLamb && (name.includes('lamm') || ingredients.includes('lamm'))) return false;
            if (prefs.noPork && (name.includes('schwein') || ingredients.includes('schwein') || 
                name.includes('speck') || ingredients.includes('speck') || 
                name.includes('schinken') || ingredients.includes('schinken'))) return false;
            if (prefs.noBeef && (name.includes('rind') || ingredients.includes('rind') || 
                name.includes('kalb') || ingredients.includes('kalb'))) return false;
            if (prefs.noDuck && (name.includes('ente') || ingredients.includes('ente'))) return false;
            
            // Milchprodukte-Filter
            if (prefs.noCottageCheese && (name.includes('h√ºttenk√§se') || ingredients.includes('h√ºttenk√§se'))) return false;
            if (prefs.noGorgonzola && (name.includes('gorgonzola') || ingredients.includes('gorgonzola'))) return false;
            if (prefs.noFeta && (name.includes('feta') || ingredients.includes('feta'))) return false;
            
            // Weitere Filter
            if (prefs.noFish && (name.includes('fisch') || ingredients.includes('fisch'))) return false;
            if (prefs.noMushrooms && (name.includes('pilz') || ingredients.includes('pilz') || 
                name.includes('champignon') || ingredients.includes('champignon'))) return false;
            if (prefs.noNuts && (name.includes('nuss') || ingredients.includes('nuss') || 
                name.includes('waln√ºsse') || ingredients.includes('waln√ºsse'))) return false;
            if (prefs.noSpicy && (name.includes('chili') || ingredients.includes('chili') || 
                name.includes('scharf') || recipe.childTip.includes('scharf'))) return false;
            if (prefs.noTofu && (name.includes('tofu') || ingredients.includes('tofu'))) return false;
            if (prefs.noEggplant && (name.includes('aubergine') || ingredients.includes('aubergine'))) return false;
            
            return true;
        }

        // Neuen Wochenplan generieren
        function generateNewPlan() {
            document.getElementById('loadingOverview').classList.add('active');
            
            setTimeout(() => {
                const vegDays = parseInt(document.getElementById('vegDays').value);
                const pizzaFreq = document.getElementById('pizzaFrequency').value;
                const days = ['Freitag', 'Samstag', 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag'];
                
                // Pizza-Wochenende Logik
                let isPizzaWeekend = false;
                if (pizzaFreq !== '0') {
                    weeksSincePizza++;
                    
                    if (pizzaFreq === '3') {
                        isPizzaWeekend = weeksSincePizza >= 2 && (weeksSincePizza >= 3 || Math.random() > 0.5);
                    } else if (pizzaFreq === '4') {
                        isPizzaWeekend = weeksSincePizza >= 3 && (weeksSincePizza >= 4 || Math.random() > 0.5);
                    } else {
                        isPizzaWeekend = weeksSincePizza >= parseInt(pizzaFreq);
                    }
                    
                    if (isPizzaWeekend) {
                        weeksSincePizza = 0;
                        setTimeout(() => {
                            document.getElementById('pizzaIndicator').style.display = 'block';
                            alert('üçï PIZZA-WOCHENENDE! üçï\n\nDiese Woche gibt es Freitag und Samstag Pizza!\n\nGenie√üt euer entspanntes Wochenende!');
                        }, 1000);
                    } else {
                        document.getElementById('pizzaIndicator').style.display = 'none';
                    }
                } else {
                    document.getElementById('pizzaIndicator').style.display = 'none';
                }
                
                // Rezepte filtern
                const filteredMeatRecipes = shuffleArray(recipes.meat.filter(r => filterRecipe(r)));
                const filteredVegRecipes = shuffleArray(recipes.vegetarian.filter(r => filterRecipe(r)));
                const filteredKidsRecipes = shuffleArray(recipes.kids.filter(r => filterRecipe(r)));
                
                // Pr√ºfen ob genug Rezepte vorhanden
                if (filteredMeatRecipes.length < 4 || filteredVegRecipes.length < 3) {
                    alert('‚ö†Ô∏è Warnung: Mit den aktuellen Filtereinstellungen sind nicht genug Rezepte verf√ºgbar. Bitte reduziere die Ausschl√ºsse in den Einstellungen.');
                }
                
                // Pizza-Rezepte definieren (pro Person)
                const pizzaFriday = {
                    name: "üçï Pizza-Freitag (Selbstgemacht)",
                    category: "Pizza-Weekend",
                    price: 2,
                    ingredients: {
                        "Pizzamehl (f√ºr 2 Tage)": "250g",
                        "San Marzano Tomaten": "0.25 Dose",
                        "Galbani Mozzarella Cucina": "75g",
                        "Belag nach Wahl": "50g",
                        "Oliven√∂l": "0.5 EL",
                        "Hefe": "0.25 W√ºrfel",
                        "Salz": "0.25 TL"
                    },
                    instructions: [
                        "Teig f√ºr 2 Tage vorbereiten",
                        "24 Stunden im K√ºhlschrank gehen lassen",
                        "Teig portionieren und ausrollen",
                        "Mit San Marzano Tomatensauce bestreichen",
                        "Galbani Mozzarella und Belag verteilen",
                        "Bei 250¬∞C ca. 10-12 Min backen",
                        "Restlichen Teig f√ºr morgen aufbewahren"
                    ],
                    childTip: "Kinder k√∂nnen beim Belegen helfen",
                    workTip: "Reste kalt zum Mitnehmen",
                    special: "pizza-weekend"
                };
                
                const pizzaSaturday = {
                    name: "üçï Pizza-Samstag (Tag 2)",
                    category: "Pizza-Weekend",
                    price: 2,
                    ingredients: {
                        "Teig vom Vortag": "bereits vorbereitet",
                        "Restliche San Marzano Sauce": "vom Vortag",
                        "Galbani Mozzarella Cucina": "75g",
                        "Belag Variation": "50g",
                        "Oregano": "nach Geschmack"
                    },
                    instructions: [
                        "Teig vom Vortag verwenden",
                        "Nochmal 30 Min bei Raumtemperatur ruhen lassen",
                        "Ausrollen und belegen",
                        "Heute andere Bel√§ge ausprobieren",
                        "Bei 250¬∞C ca. 10-12 Min backen",
                        "Gem√ºtlicher Pizza-Samstag!"
                    ],
                    childTip: "Kinder k√∂nnen eigene Mini-Pizzen machen",
                    workTip: "Perfektes Wochenend-Essen",
                    special: "pizza-weekend"
                };
                
                currentWeekPlan = [];
                shoppingListData = {};
                
                const vegDayPositions = distributeVegDays(7, vegDays);
                
                let meatIndex = 0;
                let vegIndex = 0;
                let kidsIndex = 0;
                
                days.forEach((day, index) => {
                    let recipe;
                    
                    // Pizza-Wochenende √ºberschreibt normale Planung
                    if (isPizzaWeekend && day === 'Freitag') {
                        recipe = pizzaFriday;
                    } else if (isPizzaWeekend && day === 'Samstag') {
                        recipe = pizzaSaturday;
                    } else if (vegDayPositions.includes(index)) {
                        recipe = filteredVegRecipes[vegIndex++ % filteredVegRecipes.length];
                    } else {
                        recipe = filteredMeatRecipes[meatIndex++ % filteredMeatRecipes.length];
                    }
                    
                    const dayPlan = {
                        day: day,
                        dinner: recipe,
                        kidsLunch: null,
                        dayPortions: calculateDayPortions(index)
                    };
                    
                    if (day === 'Dienstag' || day === 'Donnerstag') {
                        dayPlan.kidsLunch = filteredKidsRecipes[kidsIndex++ % filteredKidsRecipes.length];
                    }
                    
                    currentWeekPlan.push(dayPlan);
                    
                    // F√ºge zur Einkaufsliste hinzu mit berechneten Mengen
                    addToShoppingList(recipe, dayPlan.dayPortions);
                    if (dayPlan.kidsLunch) {
                        // Kinder-Mittagessen basiert auf Anzahl der Kinder
                        const kidsPortions = personPortions.filter(p => p.type === 'child')
                            .reduce((sum, child) => sum + child.factor, 0);
                        addToShoppingList(dayPlan.kidsLunch, kidsPortions);
                    }
                });
                
                // Speichere Pizza-Counter
                preferences.weeksSincePizza = weeksSincePizza;
                localStorage.setItem('mealPlannerPrefs', JSON.stringify(preferences));
                
                updatePizzaCountdown();
                displayWeekOverview();
                displayShoppingList();
                displayRecipes();
                
                document.getElementById('loadingOverview').classList.remove('active');
                
                autoSaveToGitHub();
            }, 800);
        }

        // Auto-Save zu GitHub
        async function autoSaveToGitHub() {
            const token = localStorage.getItem('githubToken');
            if (!token || currentWeekPlan.length === 0) return;
            
            const data = {
                version: '3.0',
                timestamp: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                preferences: preferences,
                weeksSincePizza: weeksSincePizza,
                weekStart: currentWeekStart.toISOString(),
                totalCost: document.getElementById('totalCost').textContent,
                personPortions: personPortions
            };
            
            const gistData = {
                files: {
                    'wochenplan.json': {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };
            
            try {
                if (currentGistId) {
                    await fetch(`https://api.github.com/gists/${currentGistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                } else {
                    gistData.description = `Wochenplan ${new Date().toLocaleDateString('de-CH')}`;
                    gistData.public = false;
                    
                    const response = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        currentGistId = result.id;
                        localStorage.setItem('currentGistId', currentGistId);
                    }
                }
                
                localStorage.setItem('lastSyncDate', new Date().toISOString());
            } catch (error) {
                console.error('Auto-Save Fehler:', error);
            }
        }

        // Zur Einkaufsliste hinzuf√ºgen mit Portionsberechnung
        function addToShoppingList(recipe, portionFactor) {
            const multipliedIngredients = multiplyIngredients(recipe.ingredients, portionFactor);
            
            for (const [ingredient, amount] of Object.entries(multipliedIngredients)) {
                if (!shoppingListData[ingredient]) {
                    shoppingListData[ingredient] = amount;
                } else {
                    // Versuche Mengen zu kombinieren
                    shoppingListData[ingredient] = combineAmounts(shoppingListData[ingredient], amount);
                }
            }
        }

        // Mengen kombinieren
        function combineAmounts(existing, additional) {
            // Wenn eine der Mengen keine Zahl enth√§lt, einfach mit Komma trennen
            if (!existing.match(/[\d.]+/) || !additional.match(/[\d.]+/)) {
                return `${existing}, ${additional}`;
            }
            
            const existingParsed = parseIngredientAmount(existing);
            const additionalParsed = parseIngredientAmount(additional);
            
            // Wenn die Einheiten unterschiedlich sind, mit Komma trennen
            if (existingParsed.unit !== additionalParsed.unit) {
                return `${existing}, ${additional}`;
            }
            
            // Gleiche Einheiten - addieren
            const sum = existingParsed.value + additionalParsed.value;
            const rounded = sum < 1 ? Math.round(sum * 10) / 10 : 
                           sum < 10 ? Math.round(sum * 2) / 2 : 
                           Math.round(sum / 5) * 5;
            
            return `${rounded}${existingParsed.unit ? ' ' + existingParsed.unit : ''}`;
        }

        // Aus Einkaufsliste entfernen
        function removeFromShoppingList(recipe) {
            rebuildShoppingList();
        }
        
        // Einkaufsliste neu aufbauen
        function rebuildShoppingList() {
            shoppingListData = {};
            currentWeekPlan.forEach(dayPlan => {
                addToShoppingList(dayPlan.dinner, dayPlan.dayPortions);
                if (dayPlan.kidsLunch) {
                    const kidsPortions = personPortions.filter(p => p.type === 'child')
                        .reduce((sum, child) => sum + child.factor, 0);
                    addToShoppingList(dayPlan.kidsLunch, kidsPortions);
                }
            });
            displayShoppingList();
        }

        // Wochen√ºbersicht anzeigen
        function displayWeekOverview() {
            const container = document.getElementById('weekOverview');
            container.innerHTML = '';
            let totalCost = 0;
            
            currentWeekPlan.forEach((dayPlan, index) => {
                const portionFactor = dayPlan.dayPortions || calculateDayPortions(index);
                let dayCost = dayPlan.dinner.price * portionFactor;
                
                if (dayPlan.kidsLunch) {
                    const kidsPortions = personPortions.filter(p => p.type === 'child')
                        .reduce((sum, child) => sum + child.factor, 0);
                    dayCost += dayPlan.kidsLunch.price * kidsPortions;
                }
                totalCost += dayCost;
                
                const dayDate = new Date(currentWeekStart);
                dayDate.setDate(currentWeekStart.getDate() + index);
                const dateStr = dayDate.toLocaleDateString('de-CH', { day: '2-digit', month: '2-digit' });
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (dayPlan.dinner.special === 'pizza-weekend') {
                    dayCard.className += ' pizza-day';
                }
                
                // Berechne die Anzahl der Portionen f√ºr die Anzeige
                const portionText = dayPlan.day !== 'Freitag' && dayPlan.day !== 'Samstag' 
                    ? `${portionFactor.toFixed(1)} Portionen (inkl. Mittagessen morgen)`
                    : `${portionFactor.toFixed(1)} Portionen`;
                
                dayCard.innerHTML = `
                    ${dayPlan.dinner.special !== 'pizza-weekend' ? 
                        `<button class="swap-btn" onclick="swapRecipe(${index}, 'dinner')" title="Rezept tauschen">üîÑ</button>` : ''}
                    <div class="day-header">
                        <span class="day-name">${dayPlan.day} <small style="color:#999;">${dateStr}</small></span>
                        <span class="price-tag">${dayCost.toFixed(2)} CHF</span>
                    </div>
                    <div class="meal-info">
                        <div class="meal-name">üçΩÔ∏è Abendessen: ${dayPlan.dinner.name}</div>
                        <div class="meal-details">${dayPlan.dinner.category} ‚Ä¢ ${dayPlan.dinner.workTip}</div>
                        <div class="portions-info">üìä ${portionText}</div>
                    </div>
                    ${dayPlan.kidsLunch ? `
                        <div class="meal-info" style="position:relative;">
                            <button class="swap-btn" onclick="swapRecipe(${index}, 'kidsLunch')" title="Kinder-Rezept tauschen" style="position:absolute; right:-5px; top:-5px; width:30px; height:30px; font-size:14px;">üîÑ</button>
                            <div class="meal-name">üë∂ Kinder-Mittag: ${dayPlan.kidsLunch.name}</div>
                            <div class="meal-details">Speziell f√ºr die Kleinen</div>
                        </div>
                    ` : ''}
                `;
                container.appendChild(dayCard);
            });
            
            document.getElementById('totalCost').textContent = totalCost.toFixed(2);
        }
        
        // Einzelnes Rezept austauschen
        function swapRecipe(dayIndex, mealType) {
            const dayPlan = currentWeekPlan[dayIndex];
            let availableRecipes = [];
            let currentRecipe = null;
            
            if (mealType === 'dinner') {
                currentRecipe = dayPlan.dinner;
                if (currentRecipe.category === 'Fleisch') {
                    availableRecipes = recipes.meat.filter(r => r.name !== currentRecipe.name && filterRecipe(r));
                } else if (currentRecipe.category === 'Vegetarisch') {
                    availableRecipes = recipes.vegetarian.filter(r => r.name !== currentRecipe.name && filterRecipe(r));
                }
            } else if (mealType === 'kidsLunch') {
                currentRecipe = dayPlan.kidsLunch;
                availableRecipes = recipes.kids.filter(r => r.name !== currentRecipe.name && filterRecipe(r));
            }
            
            if (availableRecipes.length > 0) {
                const newRecipe = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
                
                if (mealType === 'dinner') {
                    currentWeekPlan[dayIndex].dinner = newRecipe;
                } else {
                    currentWeekPlan[dayIndex].kidsLunch = newRecipe;
                }
                
                rebuildShoppingList();
                displayWeekOverview();
                displayRecipes();
                
                const dayCards = document.querySelectorAll('.day-card');
                dayCards[dayIndex].style.animation = 'pulse 0.5s';
                setTimeout(() => {
                    dayCards[dayIndex].style.animation = '';
                }, 500);
                
                autoSaveToGitHub();
            } else {
                alert('‚ö†Ô∏è Keine alternativen Rezepte mit den aktuellen Filtereinstellungen verf√ºgbar.');
            }
        }

        // Einkaufsliste anzeigen
        function displayShoppingList() {
            const container = document.getElementById('shoppingList');
            container.innerHTML = '';
            
            const categories = {
                'ü•© Fleisch & Gefl√ºgel': [],
                'ü•ï Gem√ºse & Obst': [],
                'üßÄ Milchprodukte': [],
                'üçù Nudeln, Reis & Beilagen': [],
                'ü•´ Konserven & Haltbares': [],
                'üßÇ Gew√ºrze & √ñle': []
            };
            
            for (const [ingredient, amount] of Object.entries(shoppingListData)) {
                const lower = ingredient.toLowerCase();
                
                if (lower.includes('fleisch') || lower.includes('h√§hnchen') || 
                    lower.includes('schwein') || lower.includes('rind') || 
                    lower.includes('hack') || lower.includes('schnitzel') ||
                    lower.includes('lamm') || lower.includes('kalb') ||
                    lower.includes('ente') || lower.includes('pute') ||
                    lower.includes('wurst') || lower.includes('speck')) {
                    categories['ü•© Fleisch & Gefl√ºgel'].push({ingredient, amount});
                } else if (lower.includes('milch') || lower.includes('k√§se') || 
                           lower.includes('sahne') || lower.includes('butter') ||
                           lower.includes('joghurt') || lower.includes('mozzarella') ||
                           lower.includes('ricotta') || lower.includes('feta') ||
                           lower.includes('emmentaler') || lower.includes('parmesan')) {
                    categories['üßÄ Milchprodukte'].push({ingredient, amount});
                } else if (lower.includes('nudel') || lower.includes('reis') || 
                           lower.includes('spaghetti') || lower.includes('penne') ||
                           lower.includes('kartoffel') || lower.includes('sp√§tzle') ||
                           lower.includes('gnocchi') || lower.includes('couscous')) {
                    categories['üçù Nudeln, Reis & Beilagen'].push({ingredient, amount});
                } else if (lower.includes('dose') || lower.includes('bohnen')) {
                    categories['ü•´ Konserven & Haltbares'].push({ingredient, amount});
                } else if (lower.includes('salz') || lower.includes('pfeffer') ||
                           lower.includes('√∂l') || lower.includes('gew√ºrz')) {
                    categories['üßÇ Gew√ºrze & √ñle'].push({ingredient, amount});
                } else {
                    categories['ü•ï Gem√ºse & Obst'].push({ingredient, amount});
                }
            }
            
            for (const [category, items] of Object.entries(categories)) {
                if (items.length === 0) continue;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'shopping-category';
                categoryDiv.innerHTML = `<h3>${category}</h3>`;
                
                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'shopping-item';
                    itemDiv.innerHTML = `
                        <input type="checkbox">
                        <span>${item.ingredient}: ${item.amount}</span>
                    `;
                    categoryDiv.appendChild(itemDiv);
                });
                
                container.appendChild(categoryDiv);
            }
        }

        // Rezepte anzeigen mit angepassten Mengen
        function displayRecipes() {
            const container = document.getElementById('recipesList');
            container.innerHTML = '';
            
            currentWeekPlan.forEach((dayPlan, index) => {
                const portionFactor = dayPlan.dayPortions || calculateDayPortions(index);
                const multipliedIngredients = multiplyIngredients(dayPlan.dinner.ingredients, portionFactor);
                
                const recipeDiv = document.createElement('div');
                recipeDiv.className = 'recipe-details';
                recipeDiv.innerHTML = `
                    <h3>üçΩÔ∏è ${dayPlan.day} - ${dayPlan.dinner.name}</h3>
                    <p style="color: #666; margin-bottom: 10px;">F√ºr ${portionFactor.toFixed(1)} Portionen</p>
                    <div class="ingredients-list">
                        <h4>Zutaten:</h4>
                        <ul>
                            ${Object.entries(multipliedIngredients).map(([ing, amount]) => 
                                `<li>${ing}: ${amount}</li>`
                            ).join('')}
                        </ul>
                    </div>
                    <div class="instructions">
                        <h4>Zubereitung:</h4>
                        <ol>
                            ${dayPlan.dinner.instructions.map(step => 
                                `<li>${step}</li>`
                            ).join('')}
                        </ol>
                    </div>
                    <div class="tips-box">
                        <h4>üí° Tipps:</h4>
                        <p><strong>F√ºr Kinder:</strong> ${dayPlan.dinner.childTip}</p>
                        <p><strong>F√ºrs B√ºro:</strong> ${dayPlan.dinner.workTip}</p>
                    </div>
                `;
                container.appendChild(recipeDiv);
                
                if (dayPlan.kidsLunch) {
                    const kidsPortions = personPortions.filter(p => p.type === 'child')
                        .reduce((sum, child) => sum + child.factor, 0);
                    const kidsIngredients = multiplyIngredients(dayPlan.kidsLunch.ingredients, kidsPortions);
                    
                    const kidsDiv = document.createElement('div');
                    kidsDiv.className = 'recipe-details';
                    kidsDiv.innerHTML = `
                        <h3>üë∂ ${dayPlan.day} Mittag - ${dayPlan.kidsLunch.name}</h3>
                        <p style="color: #666; margin-bottom: 10px;">F√ºr ${kidsPortions.toFixed(1)} Kinder-Portionen</p>
                        <div class="ingredients-list">
                            <h4>Zutaten:</h4>
                            <ul>
                                ${Object.entries(kidsIngredients).map(([ing, amount]) => 
                                    `<li>${ing}: ${amount}</li>`
                                ).join('')}
                            </ul>
                        </div>
                        <div class="instructions">
                            <h4>Zubereitung:</h4>
                            <ol>
                                ${dayPlan.kidsLunch.instructions.map(step => 
                                    `<li>${step}</li>`
                                ).join('')}
                            </ol>
                        </div>
                        <div class="tips-box">
                            <h4>üí° Tipp:</h4>
                            <p>${dayPlan.kidsLunch.childTip}</p>
                        </div>
                    `;
                    container.appendChild(kidsDiv);
                }
            });
        }

        // PDF Export
        function exportToPDF() {
            window.print();
        }

        // GitHub Sync Funktionen
        function showGitHubSync() {
            const modal = document.getElementById('githubModal');
            modal.classList.add('active');
        }
        
        function closeGitHubSync() {
            const modal = document.getElementById('githubModal');
            modal.classList.remove('active');
        }
        
        async function saveToGitHub() {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            const gistName = document.getElementById('gistName').value || `Wochenplan ${new Date().toLocaleDateString('de-CH')}`;
            
            if (!token) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            if (currentWeekPlan.length === 0) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Kein Wochenplan zum Speichern vorhanden!</div>';
                return;
            }
            
            const data = {
                version: '3.0',
                timestamp: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                preferences: preferences,
                weeksSincePizza: weeksSincePizza,
                weekStart: currentWeekStart.toISOString(),
                totalCost: document.getElementById('totalCost').textContent,
                personPortions: personPortions
            };
            
            const gistData = {
                description: gistName,
                public: false,
                files: {
                    'wochenplan.json': {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };
            
            try {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-info">üì§ Speichere auf GitHub...</div>';
                
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(gistData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentGistId = result.id;
                    localStorage.setItem('currentGistId', currentGistId);
                    localStorage.setItem('lastSyncDate', new Date().toISOString());
                    
                    document.getElementById('saveStatus').innerHTML = 
                        `<div class="status-success">
                            ‚úÖ Erfolgreich gespeichert!<br>
                            Gist ID: <code>${result.id}</code><br>
                            <a href="${result.html_url}" target="_blank" style="color: #0366d6;">Auf GitHub ansehen ‚Üí</a>
                        </div>`;
                } else {
                    throw new Error(`GitHub API Fehler: ${response.status}`);
                }
            } catch (error) {
                document.getElementById('saveStatus').innerHTML = 
                    `<div class="status-error">‚ùå Fehler: ${error.message}</div>`;
            }
        }
        
        async function updateExistingGist() {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            if (!token) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            if (!currentGistId) {
                const gistId = prompt('Bitte Gist-ID eingeben:');
                if (!gistId) return;
                currentGistId = gistId;
                localStorage.setItem('currentGistId', currentGistId);
            }
            
            const data = {
                version: '3.0',
                timestamp: new Date().toISOString(),
                weekPlan: currentWeekPlan,
                shoppingList: shoppingListData,
                preferences: preferences,
                weeksSincePizza: weeksSincePizza,
                weekStart: currentWeekStart.toISOString(),
                totalCost: document.getElementById('totalCost').textContent,
                personPortions: personPortions
            };
            
            const gistData = {
                files: {
                    'wochenplan.json': {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };
            
            try {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-info">üîÑ Aktualisiere Gist...</div>';
                
                const response = await fetch(`https://api.github.com/gists/${currentGistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(gistData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    localStorage.setItem('lastSyncDate', new Date().toISOString());
                    
                    document.getElementById('saveStatus').innerHTML = 
                        '<div class="status-success">' +
                        '‚úÖ Erfolgreich aktualisiert!<br>' +
                        '<a href="' + result.html_url + '" target="_blank" style="color: #0366d6;">Auf GitHub ansehen ‚Üí</a>' +
                        '</div>';
                } else {
                    throw new Error('GitHub API Fehler: ' + response.status);
                }
            } catch (error) {
                document.getElementById('saveStatus').innerHTML = 
                    '<div class="status-error">‚ùå Fehler: ' + error.message + '</div>';
            }
        }
        
        async function loadGists() {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            if (!token) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            try {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-info">üìã Lade Gists...</div>';
                
                const response = await fetch('https://api.github.com/gists', {
                    headers: {
                        'Authorization': 'token ' + token,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const gists = await response.json();
                    const mealPlanGists = gists.filter(gist => 
                        gist.files && gist.files['wochenplan.json']
                    );
                    
                    if (mealPlanGists.length === 0) {
                        document.getElementById('loadStatus').innerHTML = 
                            '<div class="status-info">Keine gespeicherten Wochenpl√§ne gefunden.</div>';
                        return;
                    }
                    
                    const gistList = document.getElementById('gistList');
                    let gistHTML = '';
                    mealPlanGists.forEach(gist => {
                        const date = new Date(gist.updated_at);
                        const dateStr = date.toLocaleDateString('de-CH');
                        const timeStr = date.toLocaleTimeString('de-CH', {hour: '2-digit', minute: '2-digit'});
                        
                        gistHTML += '<div class="gist-item" onclick="loadGistById(\'' + gist.id + '\')">' +
                            '<div class="gist-title">' + (gist.description || 'Wochenplan') + '</div>' +
                            '<div class="gist-date">' + dateStr + ' ' + timeStr + '</div>' +
                            '</div>';
                    });
                    gistList.innerHTML = gistHTML;
                    
                    gistList.style.display = 'block';
                    document.getElementById('loadStatus').innerHTML = '';
                } else {
                    throw new Error('GitHub API Fehler: ' + response.status);
                }
            } catch (error) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ùå Fehler: ' + error.message + '</div>';
            }
        }
        
        async function loadGistById(gistId) {
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            try {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-info">üì• Lade Wochenplan...</div>';
                
                const response = await fetch('https://api.github.com/gists/' + gistId, {
                    headers: {
                        'Authorization': 'token ' + token,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const gist = await response.json();
                    const content = gist.files['wochenplan.json'].content;
                    const data = JSON.parse(content);
                    
                    importWeekPlan(data);
                    currentGistId = gistId;
                    localStorage.setItem('currentGistId', currentGistId);
                    localStorage.setItem('lastSyncDate', gist.updated_at);
                    
                    document.getElementById('loadStatus').innerHTML = 
                        '<div class="status-success">‚úÖ Wochenplan erfolgreich geladen!</div>';
                    
                    setTimeout(() => {
                        closeGitHubSync();
                    }, 2000);
                } else {
                    throw new Error('GitHub API Fehler: ' + response.status);
                }
            } catch (error) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ùå Fehler: ' + error.message + '</div>';
            }
        }
        
        async function loadFromGitHub() {
            const input = document.getElementById('gistId').value.trim();
            const token = document.getElementById('githubToken').value || localStorage.getItem('githubToken');
            
            if (!input) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte Gist-ID oder URL eingeben!</div>';
                return;
            }
            
            if (!token) {
                document.getElementById('loadStatus').innerHTML = 
                    '<div class="status-error">‚ö†Ô∏è Bitte GitHub Token in den Einstellungen eingeben!</div>';
                return;
            }
            
            let gistId = input;
            if (input.includes('gist.github.com')) {
                const matches = input.match(/([a-f0-9]{32})/);
                if (matches) {
                    gistId = matches[1];
                }
            }
            
            loadGistById(gistId);
        }
        
        function importWeekPlan(data) {
            if (!data.weekPlan || !data.version) {
                throw new Error('Ung√ºltiges Datenformat');
            }
            
            currentWeekPlan = data.weekPlan;
            shoppingListData = data.shoppingList || {};
            
            if (data.preferences) {
                preferences = { ...preferences, ...data.preferences };
                if (data.weeksSincePizza !== undefined) {
                    weeksSincePizza = data.weeksSincePizza;
                }
            }
            
            if (data.personPortions) {
                personPortions = data.personPortions;
                updatePortionSettings();
            }
            
            if (data.weekStart) {
                currentWeekStart = new Date(data.weekStart);
                const weekEnd = new Date(currentWeekStart);
                weekEnd.setDate(currentWeekStart.getDate() + 6);
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                const startStr = currentWeekStart.toLocaleDateString('de-CH', options);
                const endStr = weekEnd.toLocaleDateString('de-CH', options);
                document.getElementById('weekDateDisplay').textContent = `Woche vom ${startStr} bis ${endStr}`;
            }
            
            updatePizzaCountdown();
            displayWeekOverview();
            displayShoppingList();
            displayRecipes();
            
            const hasPizza = currentWeekPlan.some(day => day.dinner.special === 'pizza-weekend');
            document.getElementById('pizzaIndicator').style.display = hasPizza ? 'block' : 'none';
        }
        
        window.onclick = function(event) {
            const githubModal = document.getElementById('githubModal');
            if (event.target === githubModal) {
                closeGitHubSync();
            }
        }
    </script>
</body>
</html>
